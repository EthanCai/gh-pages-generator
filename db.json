{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"source/favicon.ico","path":"favicon.ico","modified":0,"renderable":0},{"_id":"source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":0},{"_id":"source/samples/expvarsample.go","path":"samples/expvarsample.go","modified":0,"renderable":0},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/css/noscript.styl","path":"css/noscript.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/comments-buttons.js","path":"js/comments-buttons.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/comments.js","path":"js/comments.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/config.js","path":"js/config.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/pjax.js","path":"js/pjax.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/schedule.js","path":"js/schedule.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/sidebar.js","path":"js/sidebar.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/addtoany.js","path":"js/third-party/addtoany.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/fancybox.js","path":"js/third-party/fancybox.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/pace.js","path":"js/third-party/pace.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/quicklink.js","path":"js/third-party/quicklink.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/chatra.js","path":"js/third-party/chat/chatra.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/tidio.js","path":"js/third-party/chat/tidio.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","path":"js/third-party/analytics/baidu-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","path":"js/third-party/analytics/google-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","path":"js/third-party/analytics/growingio.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/matomo.js","path":"js/third-party/analytics/matomo.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/changyan.js","path":"js/third-party/comments/changyan.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqus.js","path":"js/third-party/comments/disqus.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","path":"js/third-party/comments/disqusjs.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","path":"js/third-party/comments/gitalk.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/isso.js","path":"js/third-party/comments/isso.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/livere.js","path":"js/third-party/comments/livere.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/utterances.js","path":"js/third-party/comments/utterances.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/math/katex.js","path":"js/third-party/math/katex.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/math/mathjax.js","path":"js/third-party/math/mathjax.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","path":"js/third-party/search/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/search/local-search.js","path":"js/third-party/search/local-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","path":"js/third-party/statistics/firestore.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","path":"js/third-party/statistics/lean-analytics.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","path":"js/third-party/tags/mermaid.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/wavedrom.js","path":"js/third-party/tags/wavedrom.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/pdf.js","path":"js/third-party/tags/pdf.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/404.html","hash":"e71593534c6b530fd2df06be07c8d940b985529c","modified":1745773489541},{"_id":"source/_posts/2016-03-26-product-design-vs-requirement-analysis.md","hash":"92b1a79f1d6d9b7364be70ea186bf65d519b5329","modified":1745773489539},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog.md","hash":"2dba448b1c4895cb9e41654e3c6dc2bb555dd26e","modified":1745773489536},{"_id":"source/_posts/2016-06-23-bad-parts-about-json-serialization-in-Golang.md","hash":"d318da3721ea98d2d00aac1227e62fc3f63f16ba","modified":1745773489541},{"_id":"source/_posts/2017-12-29-error-handling-in-go.md","hash":"d9013bc8df6251775e2a0688a3b0d20c62c87907","modified":1747667235842},{"_id":"source/categories/index.md","hash":"344157c3e9b54d9247f213e085e193030ff66def","modified":1745773489543},{"_id":"source/samples/expvarsample.go","hash":"40e471129b2c9c1599977e73955d9ff19ea6f821","modified":1745773489542},{"_id":"source/tags/index.md","hash":"d32085ddec1214e036e7c7e8dbdb105455cf4332","modified":1745773489542},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog/channel.png","hash":"07fa353dc547212f594f859c2dde0c217eff983b","modified":1745773489538},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog/use_channel.png","hash":"853e9b256bf1db8aee27f55ec881305eb52d1ab6","modified":1745773489537},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog/expvarmon_screen.png","hash":"3cf57a3f5a4de25e898ce566770f123a6efb8eb4","modified":1745773489537},{"_id":"source/.DS_Store","hash":"c048747414aaef389fd25208f019d470677157f2","modified":1745773489535},{"_id":"source/images/avatar.jpg","hash":"c4dd28a263439f83c15ddc069d97642fcf22065f","modified":1745773489535},{"_id":"source/favicon.ico","hash":"1f7d35b787b1751eef2793a2a8c6171dff51820f","modified":1745773489535},{"_id":"source/_posts/2017-12-29-error-handling-in-go/d2a2d12e1a00f819d7fd7af4b536efa2.png","hash":"ae40aa7e6dcc2d443100f55eeebea79c3fa6b305","modified":1745773489536},{"_id":"source/_posts/assets/2017-12-29-error-handling-in-go/d2a2d12e1a00f819d7fd7af4b536efa2.png","hash":"ae40aa7e6dcc2d443100f55eeebea79c3fa6b305","modified":1745773489540},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog/2016-04-21_07-12-40.png","hash":"328e623a575da9a88b9a2cbb058d787e520ece1b","modified":1745773489539},{"_id":"themes/next/.gitattributes","hash":"ec43734985e1cafd53d88ded3020103f7416123c","modified":1745773489614},{"_id":"themes/next/LICENSE.md","hash":"68fc9a03d50fd4b5ea97092b05967d1819dea2c4","modified":1745773489543},{"_id":"themes/next/.stylelintrc","hash":"9346cca6a24256a79f433670da634e8329f9a2a9","modified":1745773489601},{"_id":"themes/next/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1745773489595},{"_id":"themes/next/README.md","hash":"692bdee76ce51138cd1c09f684e518b08d50dd4c","modified":1745773489600},{"_id":"themes/next/.gitignore","hash":"417520c4dbbeab9c7e3ab10d944da0886366a0ee","modified":1745773489601},{"_id":"themes/next/_config.yml","hash":"d60c019bb75c3858df899c41f830398de26a6dbc","modified":1745773489602},{"_id":"themes/next/package.json","hash":"eaf826c46804a8da9ec6ddf325c4670a3e3ecfa7","modified":1745773489601},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1745773489595},{"_id":"themes/next/_vendors.yml","hash":"49743c5be6dfff1fb78db0c8042f1b72b596201b","modified":1745773489601},{"_id":"themes/next/.githooks/install.js","hash":"0977cb57c8b91ea166b5bbc481e4ddeaf77e9b18","modified":1745773489544},{"_id":"themes/next/eslint.config.js","hash":"14b5636ce297048ea6835f7db4b1e4cf625a2c79","modified":1745773489614},{"_id":"themes/next/renovate.json","hash":"cb29cc16e61b0b8a6dac34657d76822ae29ad5aa","modified":1745773489547},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"e78ec4eb6ce49a44ec321c49424ee0a0c1846537","modified":1745773489610},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"2296426023773991b0c48c7fffeb790baca59b19","modified":1745773489612},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"330656d93b6c03df9fb1f2f0e3534c971969473b","modified":1745773489612},{"_id":"themes/next/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1745773489614},{"_id":"themes/next/.github/config.yml","hash":"7984e665e9de481a0e0e51fca5668337713f810b","modified":1745773489613},{"_id":"themes/next/.github/release.yml","hash":"112310b81f959747f8eaafc2ca2150e1dcf916d8","modified":1745773489610},{"_id":"themes/next/.githooks/pre-commit","hash":"f473eac1aaaa96c947d67988bbed140bbab1a821","modified":1745773489544},{"_id":"themes/next/.github/label-commenter-config.yml","hash":"22d7dd8661cb2f22ff271ee96e444457814c66fd","modified":1745773489610},{"_id":"themes/next/.github/labeler.yml","hash":"b7f67daa031c535940be82ea96f0fb9db59e1022","modified":1745773489610},{"_id":"themes/next/languages/README.md","hash":"b2567e32805dda79601157351a07e5ca9fe01315","modified":1745773489598},{"_id":"themes/next/languages/bn.yml","hash":"564bed75da6e05b11dce6164508f97a15e2fb6c2","modified":1745773489600},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1745773489593},{"_id":"themes/next/docs/AUTHORS.md","hash":"a648823121563c34a177ae91f5a774b5e29f01a0","modified":1745773489593},{"_id":"themes/next/docs/LICENSE.txt","hash":"f5b14f791b7cfa1d16da981d929152e088a5d1b8","modified":1745773489595},{"_id":"themes/next/languages/ar.yml","hash":"7d0f39e8684284a04bb9808521c87fecda8bd131","modified":1745773489599},{"_id":"themes/next/languages/fa.yml","hash":"f3ffc444599f4ac92d62e9ed00a1490ebc277d70","modified":1745773489598},{"_id":"themes/next/languages/default.yml","hash":"ba0fd79a2b1d8db01a034180556061745965ff05","modified":1745773489596},{"_id":"themes/next/languages/de.yml","hash":"79b37df731c29665dee6cd7c90d278e1edfb6e24","modified":1745773489598},{"_id":"themes/next/languages/eo.yml","hash":"e34bb33ae827bf2f0727088599a73bc64bdad1b0","modified":1745773489599},{"_id":"themes/next/languages/en.yml","hash":"ba0fd79a2b1d8db01a034180556061745965ff05","modified":1745773489598},{"_id":"themes/next/languages/id.yml","hash":"929df147f4f17d638b07de5fe52ca13e2549ab1c","modified":1745773489597},{"_id":"themes/next/languages/it.yml","hash":"16d716ecfd748def2f6486ef5a82d0ab7ceb4890","modified":1745773489598},{"_id":"themes/next/languages/fr.yml","hash":"8ac44e58f71a38b7697a2f7f98a6971ed818cb5b","modified":1745773489599},{"_id":"themes/next/languages/ko.yml","hash":"d345a303310c8a5f4836c3683f3580f861ebd1b4","modified":1745773489597},{"_id":"themes/next/languages/es.yml","hash":"dffc63ef42e1266b88e0acf08994fd17a9908d53","modified":1745773489597},{"_id":"themes/next/languages/ja.yml","hash":"543222bfc516aab6c33e8534f807972ecb8943a9","modified":1745773489598},{"_id":"themes/next/languages/pt.yml","hash":"b62faaa767a45a613dd042b5f1903675eb5a8cf9","modified":1745773489597},{"_id":"themes/next/languages/ru.yml","hash":"c6d8de0ff7d8148d09993257cfd3b7aca755696c","modified":1745773489599},{"_id":"themes/next/languages/pt-BR.yml","hash":"76b8576ce228d540a16b1f0af5af2cce20923194","modified":1745773489596},{"_id":"themes/next/languages/nl.yml","hash":"3cb3687696635ec71b4ca40c5fc43b56acc8843e","modified":1745773489600},{"_id":"themes/next/languages/si.yml","hash":"2d712eedf3f60d04d36c3108cf5a12e2a52e875c","modified":1745773489597},{"_id":"themes/next/languages/th.yml","hash":"6829e998b39f8f143e20b276bb1f62d95a29de58","modified":1745773489596},{"_id":"themes/next/languages/vi.yml","hash":"7ebcba5e1128784195e4681dffc9d34c4e873fec","modified":1745773489600},{"_id":"themes/next/languages/uk.yml","hash":"ff537047b4b4c3ca9a7b64fa7f428a9942751eeb","modified":1745773489595},{"_id":"themes/next/languages/tk.yml","hash":"511726054873f6f8d7ce0d2e803f6731de0ddbe7","modified":1745773489597},{"_id":"themes/next/languages/tr.yml","hash":"a57e4ed089b893a95f5e1ecff17ce625165f4d46","modified":1745773489600},{"_id":"themes/next/languages/zh-CN.yml","hash":"741d7efe0262c9cdc2c648014b55599665d90f6b","modified":1745773489600},{"_id":"themes/next/languages/zh-HK.yml","hash":"8eb6a9f231ce1bfa54cc54418ccf14f01dcc9a31","modified":1745773489599},{"_id":"themes/next/layout/_layout.njk","hash":"b17d44bd7379c23241053a0b7fbd38c9c43cc239","modified":1745773489554},{"_id":"themes/next/languages/zh-TW.yml","hash":"5c0f00cdac3f4727b880dd223f622a535736fa8e","modified":1745773489599},{"_id":"themes/next/layout/category.njk","hash":"c68b7343d0f8145010f93351908cc36ef6212ec1","modified":1745773489548},{"_id":"themes/next/layout/archive.njk","hash":"d759f4d2cf5ddc6875ea250113a00662c1caf6d1","modified":1745773489548},{"_id":"themes/next/layout/post.njk","hash":"0bfce9f133f501a9a4837257e3b862b3bbca15be","modified":1745773489548},{"_id":"themes/next/layout/tag.njk","hash":"9e16ba20c28a7f2c6bc75aa427f48122301a30aa","modified":1745773489547},{"_id":"themes/next/layout/page.njk","hash":"af6d7570621be760536c216a56d74e40a1cceae2","modified":1745773489554},{"_id":"themes/next/test/index.js","hash":"b08b244fb6fa940aa2ea186e699edaaff7825d8f","modified":1745773489544},{"_id":"themes/next/layout/index.njk","hash":"dd63e488ae8cc144335a5958acedf6a16edd7a92","modified":1745773489548},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.yml","hash":"3f19cbf0c2b2fee6bf3788870b842c9ccc1425ca","modified":1745773489613},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.yml","hash":"fbc3062cd4591c8329fab9db72803746f0d11920","modified":1745773489613},{"_id":"themes/next/.github/workflows/codeql.yml","hash":"70a8975c47f4334ebcdd4e543b940346940054d6","modified":1745773489612},{"_id":"themes/next/.github/workflows/labeler.yml","hash":"48e6e1e1406705379112766f4fd8388e1c53b281","modified":1745773489611},{"_id":"themes/next/.github/ISSUE_TEMPLATE/config.yml","hash":"c40ae7903b6cc99f94c9d45ac7ba8c2850bb1309","modified":1745773489613},{"_id":"themes/next/.github/workflows/label-commenter.yml","hash":"44eb8b9706b31a4917cacddde2b3aca4ff82955b","modified":1745773489612},{"_id":"themes/next/.github/ISSUE_TEMPLATE/other.yml","hash":"10eca518b91a19984f6a5a912d41222042f61d63","modified":1745773489613},{"_id":"themes/next/.github/workflows/linter.yml","hash":"1d3d8fe53e9350e35d8349a19f65664789665e54","modified":1745773489611},{"_id":"themes/next/.github/workflows/npm-publish.yml","hash":"9749fe1114727e7e39bc65dd476b4a138f24816b","modified":1745773489611},{"_id":"themes/next/.github/workflows/lock.yml","hash":"275650a678684523f37187d0532f96aa0f49ce00","modified":1745773489612},{"_id":"themes/next/docs/ru/README.md","hash":"b0ba3546bc9e10f8e024e5a5aa2292c5fcb39d61","modified":1745773489593},{"_id":"themes/next/.github/workflows/tester.yml","hash":"9a8c366c8a0bf0e0b92035fedd93e8979adaa560","modified":1745773489611},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"12a6631617695504d5cf2a94b57d87bd331bef6f","modified":1745773489594},{"_id":"themes/next/layout/_macro/post-collapse.njk","hash":"313637fe3569f98fd926e8cd0fcc75d098eb6e6e","modified":1745773489563},{"_id":"themes/next/layout/_macro/post.njk","hash":"ec9bb9c5ede773c02f0c8d8475245a8a437a2b71","modified":1745773489563},{"_id":"themes/next/docs/zh-CN/README.md","hash":"8e9871fd9cdcccfd3441826dde236410200dc8ac","modified":1745773489594},{"_id":"themes/next/layout/_macro/sidebar.njk","hash":"547c62ab14d9e05d2d9116db9048a677fbe1fb6d","modified":1745773489563},{"_id":"themes/next/layout/_partials/comments.njk","hash":"d0c470b0f6690aa217e9ada848c5e2e73fb27c6f","modified":1745773489550},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"a089f7a8368ab0b7d7b9b7ec0ac3767a453435df","modified":1745773489595},{"_id":"themes/next/layout/_partials/languages.njk","hash":"e43f22198cccb5f6e306b1ce0d28d12a4fb891f8","modified":1745773489552},{"_id":"themes/next/layout/_partials/pagination.njk","hash":"bc719473ed5948ab6859449d60b8d36cfc1542b4","modified":1745773489551},{"_id":"themes/next/layout/_scripts/vendors.njk","hash":"7261e24287984853c8ef08cda8bbc80cacf9bd6f","modified":1745773489548},{"_id":"themes/next/layout/_scripts/index.njk","hash":"2a7dfffebad19b67dc9e3b2a6b2986d0630ef930","modified":1745773489548},{"_id":"themes/next/layout/_partials/widgets.njk","hash":"d83fb59f02c5e6630a7770401a05c02f6f07358b","modified":1745773489551},{"_id":"themes/next/layout/_third-party/addtoany.njk","hash":"ef64c6bfb8540cd874701236b9be47db2496e98e","modified":1745773489560},{"_id":"themes/next/layout/_third-party/fancybox.njk","hash":"844559f46e2ff1c8be234d5763703106e2072a7b","modified":1745773489558},{"_id":"themes/next/layout/_third-party/pace.njk","hash":"d7ad5714079f7f65446f880baf14722435ca9061","modified":1745773489556},{"_id":"themes/next/layout/_third-party/quicklink.njk","hash":"0efed71ed530447718c4ea5bbd5fc8695b0b0d5f","modified":1745773489560},{"_id":"themes/next/layout/_third-party/index.njk","hash":"dfd7cdd6ba89f8c3deabc27726c7a350cadafd11","modified":1745773489558},{"_id":"themes/next/scripts/filters/locals.js","hash":"9eb5310664759931287dd28ea39165dfb67f12ed","modified":1745773489604},{"_id":"themes/next/layout/_partials/footer.njk","hash":"fbf8232cacf0df87e88e74860be66c9f86018302","modified":1745773489554},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"872f01cb10e422a648ea505436532e776e92926b","modified":1745773489604},{"_id":"themes/next/scripts/filters/post.js","hash":"fdc8a0af90035e89c3fcb754a0eb189b8951a2bc","modified":1745773489604},{"_id":"themes/next/scripts/helpers/engine.js","hash":"83235f2879567eb8686431c9554a4b99f14ab665","modified":1745773489609},{"_id":"themes/next/scripts/filters/minify.js","hash":"2063aaa1db448ebcf7b0fdbbc54d3991a368bbd3","modified":1745773489604},{"_id":"themes/next/scripts/helpers/font.js","hash":"4c84d45daac86396edf656d2a8abe6e7583491ea","modified":1745773489608},{"_id":"themes/next/scripts/helpers/navigation.js","hash":"78107021101553c3d23e89290f7530b60cf4aa86","modified":1745773489609},{"_id":"themes/next/scripts/events/index.js","hash":"bd9ea82376cd87df611ea3ae077875c7c595a3df","modified":1745773489607},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"4bc2eb87f3fa26981652f517d1ab3f81de2ab89d","modified":1745773489609},{"_id":"themes/next/scripts/helpers/next-paginator.js","hash":"e86c764b546e4fbb87970cabc4135a56f9ef9fe1","modified":1745773489609},{"_id":"themes/next/scripts/tags/button.js","hash":"c6ad2ed544fbb25ecb5d820c36e76302504271b7","modified":1745773489606},{"_id":"themes/next/scripts/helpers/next-vendors.js","hash":"af3946a595f997eb43d9af87428e4898c9acbc82","modified":1745773489609},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"6281d47c1de98eb38f3aa0f6df29bbb19d412173","modified":1745773489609},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"935a311142a409c1896b3ae3f01fe7a9e2db1134","modified":1745773489606},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"92c19d796bdb3320df9caea59bf52df7a95d9da9","modified":1745773489605},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"f57f7e09eb6220f681fa8385082b0960502ce5c4","modified":1745773489606},{"_id":"themes/next/scripts/tags/link-grid.js","hash":"18a483c2d5afd701f6080ffdddf2d1321370336c","modified":1745773489605},{"_id":"themes/next/scripts/tags/label.js","hash":"8a73348186113bae0a51ea2f891c1bb882fab05a","modified":1745773489606},{"_id":"themes/next/scripts/tags/note.js","hash":"7b94ddb46b7d4b0fe815f2fbe4bd375f07f55363","modified":1745773489606},{"_id":"themes/next/scripts/tags/index.js","hash":"1f6aba7820f1fb58b61969485148db21846e1aa9","modified":1745773489606},{"_id":"themes/next/scripts/tags/pdf.js","hash":"344636b6fd7e27e8831c1e194039afc0d61931cd","modified":1745773489605},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"7d7bbc4a9970bd4c5449bc71b94364a8ec61e5d2","modified":1745773489605},{"_id":"themes/next/scripts/tags/video.js","hash":"2ee926448583be8f95af1f2884ae2c9c4830151d","modified":1745773489606},{"_id":"themes/next/scripts/tags/wavedrom.js","hash":"b44dfeeb58b41945d469141787f3dbce4b117d08","modified":1745773489604},{"_id":"themes/next/source/css/_mixins.styl","hash":"e21309d4165ebb6645084eed8dd749846ae981f1","modified":1745773489580},{"_id":"themes/next/scripts/tags/tabs.js","hash":"0eabe51da40b4b13e16419c8fe02452d9a4fef73","modified":1745773489605},{"_id":"themes/next/source/css/main.styl","hash":"921a58577f411cf4eb5cfd66db0a241f8f88578c","modified":1745773489580},{"_id":"themes/next/source/css/noscript.styl","hash":"dadc81256afb127b77eac6763d5ee0ec9c77f0a3","modified":1745773489564},{"_id":"themes/next/source/css/_colors.styl","hash":"ebfe0954e3931431f46f913abe08d0212e06e7c2","modified":1745773489580},{"_id":"themes/next/source/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1745773489584},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1745773489584},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1745773489584},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","hash":"a38c6d92b368bfc42c72ad799ad03f3274957065","modified":1745773489584},{"_id":"themes/next/source/images/logo.svg","hash":"099e11ab995a2c8981427a85476d082609848c77","modified":1745773489585},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1745773489584},{"_id":"themes/next/source/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1745773489586},{"_id":"themes/next/source/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1745773489592},{"_id":"themes/next/source/js/bookmark.js","hash":"9ba4cceafd12c6d5ba8a6b986a046ef8319a7811","modified":1745773489592},{"_id":"themes/next/source/js/next-boot.js","hash":"523bbaeda463e82ab0be428cc0005717038ec63e","modified":1745773489586},{"_id":"themes/next/source/js/motion.js","hash":"6f751f5c9499a39d7c5e1d323db3260342dd9431","modified":1745773489586},{"_id":"themes/next/source/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1745773489585},{"_id":"themes/next/source/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1745773489585},{"_id":"themes/next/source/js/sidebar.js","hash":"2ee359ae48273b01ba1e0768704524e08702c7eb","modified":1745773489585},{"_id":"themes/next/source/js/pjax.js","hash":"694b271819aab37ce473b15db9e6aded971d82e5","modified":1745773489585},{"_id":"themes/next/source/js/utils.js","hash":"345a8158e6c34e19245a07c778f5699c8673f1b1","modified":1745773489586},{"_id":"themes/next/test/helpers/font.js","hash":"a1e7c7f7cff915c137ae8bbebfa032b656cc19e1","modified":1745773489546},{"_id":"themes/next/test/tags/button.js","hash":"17a82f3962472277dc33d99d9590ac0c926e634c","modified":1745773489546},{"_id":"themes/next/test/tags/center-quote.js","hash":"170312d9721897289c8f4bf8285ce1c9a0ba8aed","modified":1745773489545},{"_id":"themes/next/test/helpers/next-url.js","hash":"52497c848a74f5716f3de0d20d7803944e139ceb","modified":1745773489547},{"_id":"themes/next/test/helpers/index.js","hash":"63ba28afed697f7b3574436b1133b8ecc9c0c357","modified":1745773489547},{"_id":"themes/next/test/tags/caniuse.js","hash":"dad9fddae90beef82a7c77420b4063f6c4862d66","modified":1745773489545},{"_id":"themes/next/test/tags/group-pictures.js","hash":"3ca6fc85f078ec1ff3d8df438bfbce438390b815","modified":1745773489546},{"_id":"themes/next/test/tags/mermaid.js","hash":"df5ca57bb57c517b2381580b81f7deda7d2fff65","modified":1745773489545},{"_id":"themes/next/test/tags/link-grid.js","hash":"7f1a1b4189309278164fc5e70ed7cee32609d835","modified":1745773489545},{"_id":"themes/next/test/tags/note.js","hash":"81737656ebb8050fda3af129454d26650d201a0f","modified":1745773489546},{"_id":"themes/next/test/tags/pdf.js","hash":"69be476322e19f25447c8a4ef55e5c96df829fc1","modified":1745773489545},{"_id":"themes/next/test/tags/index.js","hash":"e8779e54f0979b221858f8bb74dd081bb503b910","modified":1745773489545},{"_id":"themes/next/test/tags/label.js","hash":"7a86d6c9e6c9774a375498c024c9c3f15e719ba1","modified":1745773489546},{"_id":"themes/next/test/tags/tabs.js","hash":"6aa68012f7cfd0e7cb1587f74d775b91fc014535","modified":1745773489545},{"_id":"themes/next/test/tags/video.js","hash":"8acc7ddd41975b6dba4263ee99c87c821d64b663","modified":1745773489546},{"_id":"themes/next/layout/_partials/head/head-unique.njk","hash":"93c1d103d9d16581c944c51f3d0638f57c80ee41","modified":1745773489552},{"_id":"themes/next/layout/_partials/header/brand.njk","hash":"dd9c4c03e99dfde0dfb8edefcb2c933f2f560efc","modified":1745773489553},{"_id":"themes/next/layout/_partials/header/index.njk","hash":"650de421a8ce4cf685428ffbe0087ff84cbd1356","modified":1745773489553},{"_id":"themes/next/layout/_partials/header/menu-item.njk","hash":"41a8b0cc16f60fa085cb719d07216d86b6bc4bf8","modified":1745773489553},{"_id":"themes/next/test/validate/index.js","hash":"54d9225b07c7c3313d63da96261b092406e7e225","modified":1745773489544},{"_id":"themes/next/layout/_partials/header/menu.njk","hash":"ee6fc2f111572d3eeab0a2fecbb2d6b3e37ab26b","modified":1745773489553},{"_id":"themes/next/layout/_partials/header/sub-menu.njk","hash":"06480d8ec5f0b87eafd47f082f07968d7282dd5c","modified":1745773489553},{"_id":"themes/next/layout/_partials/post/post-meta.njk","hash":"9fa47e4fb342811da590ee4adc91cf81118c0a39","modified":1745773489551},{"_id":"themes/next/layout/_partials/post/post-followme.njk","hash":"c1e33b4889f75acc490af3c8bde0ec56c518ff41","modified":1745773489551},{"_id":"themes/next/layout/_partials/post/post-copyright.njk","hash":"bfff923526d6800218f08dba6ce0bbf5c17755fd","modified":1745773489550},{"_id":"themes/next/layout/_partials/post/post-related.njk","hash":"e0986db00a0201dd3c60570f964829c84ba5bc68","modified":1745773489550},{"_id":"themes/next/layout/_partials/post/post-reward.njk","hash":"e8b8a7c41e9ec612d0c0c73419529d55d1c16256","modified":1745773489551},{"_id":"themes/next/layout/_partials/search/index.njk","hash":"6ad43135bd3aecf933ffdd750763e27ade36f97c","modified":1745773489552},{"_id":"themes/next/layout/_partials/sidebar/site-overview.njk","hash":"bc5708e38b6070dff0cab6bf9480971017ce4dda","modified":1745773489549},{"_id":"themes/next/layout/_partials/page/breadcrumb.njk","hash":"89825e75cc45e9709fa6ba89883669eedaff6f46","modified":1745773489549},{"_id":"themes/next/layout/_partials/post/post-share.njk","hash":"16696990e4ce65fc8db18c4635082a5d5d06ff07","modified":1745773489551},{"_id":"themes/next/layout/_partials/page/page-header.njk","hash":"7ed4f102a1825195cff8d7995bf9219f323a9034","modified":1745773489549},{"_id":"themes/next/layout/_partials/page/categories.njk","hash":"17156d99941f28a225951ffdcfa9a115e20dc2d2","modified":1745773489549},{"_id":"themes/next/layout/_partials/head/head.njk","hash":"5388b157bba4a40b9312f4a45c6678974ccf0837","modified":1745773489552},{"_id":"themes/next/layout/_partials/page/tags.njk","hash":"a18d1598e36cc72f2b0b24c3cc3c5990dfaa3254","modified":1745773489550},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.njk","hash":"6215309aee028dcb734452beec448c5afb6c63fc","modified":1745773489561},{"_id":"themes/next/layout/_third-party/analytics/cloudflare.njk","hash":"a5b8297c2c383124dd6a56e256ecc0c0dcf489be","modified":1745773489562},{"_id":"themes/next/layout/_partials/page/schedule.njk","hash":"0f4bc8e257da60f77c0c1738607b2bde55810684","modified":1745773489550},{"_id":"themes/next/layout/_third-party/analytics/growingio.njk","hash":"8afaa772c390bd9d53a5cff9645ac3168334eb98","modified":1745773489562},{"_id":"themes/next/layout/_third-party/analytics/index.njk","hash":"f900306497b133e8b098bd9f4b96b93d1d96c185","modified":1745773489562},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.njk","hash":"d89066ff53879693f023e540d59c86137172c529","modified":1745773489561},{"_id":"themes/next/layout/_third-party/analytics/matomo.njk","hash":"4e89648a8ec8194c5823064cbca39c938a799006","modified":1745773489562},{"_id":"themes/next/layout/_third-party/analytics/plausible.njk","hash":"ef9f2bb7110507f1c4336800af9157d5fa9765bd","modified":1745773489563},{"_id":"themes/next/layout/_third-party/analytics/microsoft-clarity.njk","hash":"1efeeda00db08a3c033798228dd0092ee532cc36","modified":1745773489561},{"_id":"themes/next/layout/_third-party/chat/tidio.njk","hash":"02aab857c27fc103216029be991688b12a73a525","modified":1745773489558},{"_id":"themes/next/layout/_third-party/analytics/umami.njk","hash":"3343750682fbd8535e50f8129be3003ad26015b4","modified":1745773489561},{"_id":"themes/next/layout/_third-party/comments/changyan.njk","hash":"d1c950f8fbdf85e7a3eae5463767a89e858e8220","modified":1745773489557},{"_id":"themes/next/layout/_third-party/chat/chatra.njk","hash":"d7263fca16d0278ccf1f6aa1c6df6902a6344a09","modified":1745773489558},{"_id":"themes/next/layout/_third-party/comments/disqus.njk","hash":"9375b19a89b7fa9474e558d085af5448d4c5c50c","modified":1745773489557},{"_id":"themes/next/layout/_third-party/comments/isso.njk","hash":"64cc3bdaf644fd32c0d0a247f29f5b6904da9af3","modified":1745773489557},{"_id":"themes/next/layout/_third-party/comments/livere.njk","hash":"3b13b09fba84ec6000886890a6710736a2b8fafe","modified":1745773489558},{"_id":"themes/next/layout/_third-party/comments/disqusjs.njk","hash":"0749cb6902baecdfd01f779a2a2513f6d2f6a823","modified":1745773489557},{"_id":"themes/next/layout/_third-party/comments/utterances.njk","hash":"5a94032bc3512a10ad4328fc19ec07b819a1d687","modified":1745773489557},{"_id":"themes/next/layout/_third-party/comments/gitalk.njk","hash":"b63b7e2ede0d3e66e732fa1a06bda9b19e1e85d4","modified":1745773489557},{"_id":"themes/next/layout/_third-party/math/index.njk","hash":"abf37fc55aa86702118e8fdf5bf2d389dd589aa0","modified":1745773489559},{"_id":"themes/next/layout/_third-party/math/mathjax.njk","hash":"3677017fd4572b158311f5f5d870590ab25184e0","modified":1745773489559},{"_id":"themes/next/layout/_third-party/math/katex.njk","hash":"1ebf658690468ea197bdd0416eb7cfa4bd0b083a","modified":1745773489559},{"_id":"themes/next/layout/_third-party/search/localsearch.njk","hash":"e45ea3542cdc9ed7ec8447b5e6f35df4c5e82758","modified":1745773489560},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.njk","hash":"55c2468b2b7f035881d494085527d6554f37b556","modified":1745773489556},{"_id":"themes/next/layout/_third-party/search/algolia-search.njk","hash":"41b28f05e6233fb37700f7151f55868be10a0965","modified":1745773489560},{"_id":"themes/next/layout/_third-party/statistics/index.njk","hash":"568ddf7955d11d93fb5e842b403a7ac8b1b7fdb1","modified":1745773489556},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.njk","hash":"2446e748cdc102c78492216319ac02148db7daf6","modified":1745773489556},{"_id":"themes/next/layout/_third-party/statistics/firestore.njk","hash":"d32ebe94560fa95824478ebbff531bffc47b194d","modified":1745773489556},{"_id":"themes/next/layout/_third-party/tags/wavedrom.njk","hash":"02202bf563fb5eedde2ccad4d6c5b9109d30a703","modified":1745773489559},{"_id":"themes/next/layout/_third-party/tags/mermaid.njk","hash":"099e031f52fb8e47b3af5b2684737efc9e643ee7","modified":1745773489559},{"_id":"themes/next/layout/_third-party/tags/pdf.njk","hash":"2c81984cc4f5123103460442f6e046f5b6c97127","modified":1745773489560},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"d987709267a1bc6e5014411e9983d7c49c102c16","modified":1745773489607},{"_id":"themes/next/scripts/events/lib/highlight.js","hash":"8a8f752260be5b8098393f9879b61ffe904465e8","modified":1745773489608},{"_id":"themes/next/scripts/events/lib/config.js","hash":"00af4f5f9a79eaccf051f9e372d233d65d44c8a5","modified":1745773489608},{"_id":"themes/next/scripts/events/lib/utils.js","hash":"5942feb3f31ed3480bf50b0f5a4a305b5bdca3d6","modified":1745773489608},{"_id":"themes/next/scripts/events/lib/navigation.js","hash":"dd3562686d95a50375e6fd32e717ccb0d99c1e3d","modified":1745773489608},{"_id":"themes/next/scripts/events/lib/vendors.js","hash":"e2b4a9d6b08155735ec336eedc506763d5671821","modified":1745773489607},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"93ee5f9109dad885dc38c49bcee630c10f9dce6e","modified":1745773489604},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"7f71d6b271ba65ff333d5682e7575711d368c0d2","modified":1745773489602},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"5798cfc8f63665031dd3e01debed051628cec319","modified":1745773489603},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"19a402a225c31edffc50f202a14e0d582d3db23e","modified":1745773489603},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"7bb7dafdd7f6bca8464b54e17e552ce7f1714195","modified":1745773489603},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"a600a98e7436edeb31e291abca359885567df3c9","modified":1745773489603},{"_id":"themes/next/scripts/filters/comment/isso.js","hash":"ff8b5b5145220a17d0ecd9508ba9bd2d3b2da47d","modified":1745773489603},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"2c800eaab6c613e5d091be2111aaa786641aa0c2","modified":1745773489579},{"_id":"themes/next/scripts/filters/comment/utterances.js","hash":"d3bded697bc32dace689d2a6dfb6eb7514169d15","modified":1745773489603},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"5a07d8bb52bc1d51a624ca8db54be144566c306b","modified":1745773489602},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"96e0a7c2a65ce68215e17e369085b2ea2f1334f2","modified":1745773489579},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"20d5c6aa136bbb55e03906d98ee90ad3fbaa80a7","modified":1745773489579},{"_id":"themes/next/source/js/third-party/addtoany.js","hash":"5276c8f78ee562a8965216dc67d762e59cb4a9f2","modified":1745773489589},{"_id":"themes/next/source/js/third-party/fancybox.js","hash":"819f382c561fe5ec23c67cc5fabd63dd1cc22dc1","modified":1745773489587},{"_id":"themes/next/source/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1745773489587},{"_id":"themes/next/source/css/_variables/base.styl","hash":"b724edca546373d5eaf9b3602868f971c9094cf6","modified":1745773489579},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"879b49f693af0c04c285b2dd0c9cccaf77347b7c","modified":1745773489579},{"_id":"themes/next/source/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1745773489589},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"b8445c828d78a38e2de50bdc86b3bff66285ea0f","modified":1745773489571},{"_id":"themes/next/source/css/_common/outline/index.styl","hash":"8e34df131830d4fa3725e4590a672ba1cf1903e5","modified":1745773489577},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"48b2dfc04df6409c6e0736ccc11462ad97d349b1","modified":1745773489577},{"_id":"themes/next/source/css/_common/components/index.styl","hash":"2298e521253b3bf376a2412271bc2a7d305051f3","modified":1745773489571},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"90a86045a33c1bae49fc2f6fa1e1b53170c7f77b","modified":1745773489571},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"a042571d85ff7265f799004239a45f36b716b8a6","modified":1745773489565},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"f316ba87f8d3299677fbf8345e1e993c35210e2e","modified":1745773489567},{"_id":"themes/next/source/css/_common/scaffolding/index.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1745773489566},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"e4fecc889ba3317a64e9abba5842c79dff9b7827","modified":1745773489567},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"f4228c759db4a650c8d38745c2edd1dc83c45687","modified":1745773489566},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1745773489569},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"dafc6d23c80d6fe3e55a7711e94210d2479b629a","modified":1745773489583},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"bcbf498d8d3ecea84324f0a59b7f95f389a52b8d","modified":1745773489581},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"69c66aab4651e2e7ae9e65f08600144970648c60","modified":1745773489564},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"e840b23d33023e6d45e018f6e84b683dd56efd8d","modified":1745773489569},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"fa4fd8f76464e214fb7318f325b13c2b62f4b478","modified":1745773489583},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"f23c53e32d140091b819be2603d1afbbb5d66933","modified":1745773489583},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"3fbfab591f280e2e7f3b0265901c93bc4bd137ed","modified":1745773489581},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"6569a6640f79d247a8235b3914772c0e2f99ead2","modified":1745773489580},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"ab16a3dcdc0393b9b582ef59dcc13db9320e917c","modified":1745773489583},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"e31f6adbb22a451f07e4661cff9a2f12e4e99a36","modified":1745773489581},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"485d23ccb42c0d0c8ead7ea8930dd3e06d79a285","modified":1745773489583},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"c29a827e82d2820ed8977c92994da73721200fac","modified":1745773489581},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1745773489581},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1745773489581},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"e792a6233e1d4dbc5fd2f10ae97b7a790b82568b","modified":1745773489582},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"a03f16ffc7dfdbdc6053f9fd68d77257ba0c559e","modified":1745773489582},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"dc03835e42d82eaf2633cf3b627990ad3e1f5967","modified":1745773489582},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"778ed2ad5643b93970c95626b325defeb586733f","modified":1745773489582},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"8000075b227749a7495eaf417cac6ccfbe441580","modified":1745773489582},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"a92c4eb16bdb7806079467eb022ccf193bb0f794","modified":1745773489582},{"_id":"themes/next/source/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1745773489589},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1745773489592},{"_id":"themes/next/source/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1745773489589},{"_id":"themes/next/source/js/third-party/analytics/matomo.js","hash":"c6a25b26a1443caa70b47fd3dfa282271574deb5","modified":1745773489592},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","hash":"def07bcc7c17d8a0caad177fb1dd2f3a5e5b3536","modified":1745773489592},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1745773489592},{"_id":"themes/next/source/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1745773489588},{"_id":"themes/next/source/js/third-party/comments/disqus.js","hash":"da361917d65e5dca8362f8cdeb6c8cc0e8316cec","modified":1745773489587},{"_id":"themes/next/source/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1745773489588},{"_id":"themes/next/source/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1745773489587},{"_id":"themes/next/source/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1745773489588},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1745773489588},{"_id":"themes/next/source/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1745773489590},{"_id":"themes/next/source/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1745773489590},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","hash":"1e826dea3f684c0515f362dc1352447a1f0eae71","modified":1745773489588},{"_id":"themes/next/source/js/third-party/search/local-search.js","hash":"3968d972f47b79acc6c3fe44028bad77c9c5aab7","modified":1745773489591},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","hash":"1905978ef587bf08fe088ce4693a4c08db07cfbb","modified":1745773489591},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","hash":"6e0682bb42170d61b13b786295f45f9c785f8b73","modified":1745773489587},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","hash":"df01075f52302873f7de36050b5408c8d1afb452","modified":1745773489590},{"_id":"themes/next/source/js/third-party/tags/wavedrom.js","hash":"40dcd10df6edf124088c329346e0cc0bdac74ef1","modified":1745773489590},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","hash":"835cbf54c49ef1327f47df70ff2636ad36b6f57d","modified":1745773489587},{"_id":"themes/next/source/css/_common/components/post/index.styl","hash":"098d4bd034e986fcf7e443eac4fc2193935461b7","modified":1745773489570},{"_id":"themes/next/source/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1745773489590},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"809bab3414b1eb1ae44444eb821126868f764414","modified":1745773489571},{"_id":"themes/next/source/css/_common/components/post/post-body.styl","hash":"93f014809d6442da23f8b7d729f7375e2badba7d","modified":1745773489569},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"026cd5735fd2a75bb60b7bf8bd09139583d602b9","modified":1745773489571},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"aa366d37389760c8595529b850f461569577a1c5","modified":1745773489570},{"_id":"themes/next/source/css/_common/components/post/post-footer.styl","hash":"0f4830e19026317ed850f3be2979556e38f97f4a","modified":1745773489569},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"424de4f64b12c521e8c6bfbc711d7961490ab36e","modified":1745773489570},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"b47fb36915962309553ff7fb1782341585ed2b76","modified":1745773489570},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"8f094c4ac17e2ab45569b12d157747f9c7333c12","modified":1745773489572},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"ebfba158a0a4af3d1dabcacbc58986664de52140","modified":1745773489571},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"9ac6f477177264c26a46e8333b8456720a0444dc","modified":1745773489570},{"_id":"themes/next/source/css/_common/components/third-party/index.styl","hash":"54d12e2c5d9982f7b9e5b23be5133954a8514e9d","modified":1745773489572},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"1874e2b5d86cdeeaf2ccdc2669146a2b0c72d9db","modified":1745773489573},{"_id":"themes/next/source/css/_common/components/third-party/disqusjs.styl","hash":"877a537d5b95beb048142e4fdee6f17e6ef9c7bb","modified":1745773489572},{"_id":"themes/next/source/css/_common/outline/footer/index.styl","hash":"4e967702cf4c637132346bc74ec8854426f1a68c","modified":1745773489577},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"9d995eb4871a6c273d9d51558676a1fdabf69e72","modified":1745773489573},{"_id":"themes/next/source/css/_common/components/third-party/utterances.styl","hash":"56d90ae0559caa55b75f3c300ff2711f9ed65fc4","modified":1745773489572},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"38c64c2d04e46848382bfa246a0e9c508294767b","modified":1745773489578},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"e74f4bb47a101b014ee2a1783c87f3b87323f9a0","modified":1745773489578},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"a3dd3edea9c01b66b28a8367185269b9dcc3bdee","modified":1745773489578},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"bf3ad8b4268f763a1e26377681644887694bc009","modified":1745773489578},{"_id":"themes/next/source/css/_common/outline/header/index.styl","hash":"6e0d0796ef7fbbb62ffdfb448753a850de82c74f","modified":1745773489578},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"8afdc311c6b8db121758371f95cf1c5e77354f42","modified":1745773489574},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"a851e9d5aefcd027c95eeb323860b6da70f202d1","modified":1745773489578},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"6b816c2511242ee503fb5f34cd3e4dcdafc06b85","modified":1745773489573},{"_id":"themes/next/source/css/_common/components/pages/index.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1745773489573},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"51a97a33879289904cb523ddc2d88b5b0c60fa72","modified":1745773489574},{"_id":"themes/next/source/css/_common/outline/sidebar/index.styl","hash":"21acb11e397526132605eef23bde7b307aa1eab5","modified":1745773489575},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"1a81d1a71fcf0699629ce6e72dfd0a15f3a2dd0a","modified":1745773489574},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"0847400d8579b0a2dd1bf662c78954c10adf2680","modified":1745773489575},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"5b38ac4a0f1ade0e681aff0e3366c481d9cf3dcd","modified":1745773489576},{"_id":"themes/next/source/css/_common/outline/sidebar/related-posts.styl","hash":"b05908f04ef95f2d91e6eba89b12411c378d050f","modified":1745773489576},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"24752d145c6fb8f5344dca9c7b9640839c02e009","modified":1745773489575},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"46eece42510c2c89bb9209afb0262ad76a4b0b36","modified":1745773489576},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"ce36bf1602233298e0351b4babc592315529eb26","modified":1745773489575},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"c2e354a565c8c1b32bd0ceacc972b17982758b67","modified":1745773489576},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"741566d6ac5f852b5c8dee6a8996b65e48e7c97f","modified":1745773489577},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-copyright.styl","hash":"56805b77fe236fac19e19c716a49363bcf986311","modified":1745773489576},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"5c31f3a86e4e6fbf2f8419415620461fa8a63c56","modified":1745773489564},{"_id":"themes/next/source/css/_common/scaffolding/highlight/fold.styl","hash":"42a0b65491ad85438596b3fe0b7f23973e4cef34","modified":1745773489565},{"_id":"themes/next/source/css/_common/scaffolding/highlight/index.styl","hash":"9b0217e1caecd91e05572c7e8e52d32016ca312f","modified":1745773489565},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"26dd0adfcb1db6df29c6090c8d7e9b5a43583fb0","modified":1745773489576},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"d6418fd2bbfba7b73ddf11ec62db9637fdf5d8af","modified":1745773489568},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"393ff96234e4196b569d4b11496774eb78e147de","modified":1745773489568},{"_id":"themes/next/source/css/_common/scaffolding/tags/index.styl","hash":"22cd37bd5df9972d5074710896aba4424ad5161c","modified":1745773489567},{"_id":"themes/next/source/css/_common/scaffolding/tags/mermaid.styl","hash":"48d35dba575a7c9e8845b16652e76b7d4a4646de","modified":1745773489568},{"_id":"themes/next/source/css/_common/scaffolding/tags/link-grid.styl","hash":"49329a7144f3413d1c832e52a1f4954171ef11e1","modified":1745773489567},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"8213015d9cae45d2c9945f8aba9d8db39c734efc","modified":1745773489568},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"c3be8b0738f693e750486bb71769c3dbbec174cc","modified":1745773489567},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b6654a1d7cf82577d8263faffee8af3ad4a5c0e8","modified":1745773489567},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog/2016-04-21_07-12-24.png","hash":"8b2db6e1b6c48cfdb7bf5d6f820d05bf1f5984ea","modified":1745773489538},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"debee14539272fbe3835a7d3853af2230baa3501","modified":1745773489568},{"_id":"themes/next/source/css/_common/scaffolding/tags/wavedrom.styl","hash":"af113411ad9cca7674177be36af8dd399680834d","modified":1745773489568},{"_id":"public/404.html","hash":"c6444c089eb1c25e00126e383c9cb728bdf25726","modified":1745773740440},{"_id":"public/categories/index.html","hash":"f220f443b02f80618d1ef7d4f6be25a8d4971d43","modified":1745773740440},{"_id":"public/tags/index.html","hash":"ea0bacd147af16e624a8ceaa1e608885d276e175","modified":1745773740440},{"_id":"public/2017/12/29/error-handling-in-go/index.html","hash":"c0d1d839af36f5c37e08eb6705a96413d09c50c1","modified":1747667297817},{"_id":"public/2016/06/23/bad-parts-about-json-serialization-in-Golang/index.html","hash":"4d04e2f292162609240ca6f486b94b6664a07d24","modified":1745773740440},{"_id":"public/2016/04/20/experiences-about-develop-dlog/index.html","hash":"3af832c9cf53a33b3dfb651612a19f7ac3e43f22","modified":1745773740440},{"_id":"public/2016/03/26/product-design-vs-requirement-analysis/index.html","hash":"08df65c64ad874caabd35726a463e56902d71bfb","modified":1745773740440},{"_id":"public/archives/index.html","hash":"4db7ff4eb01d4415f6a645bfb9b772aea6c20bf5","modified":1745773740440},{"_id":"public/archives/2016/index.html","hash":"b106526cf3638723c49fd7e1fb7f19744ded9b08","modified":1745773740440},{"_id":"public/archives/2016/03/index.html","hash":"8aae305228bbb812503a674e977efc07909b7923","modified":1745773740440},{"_id":"public/archives/2016/04/index.html","hash":"4369fc9527f07b5e0d30f16dfe62bdf8e33857e2","modified":1745773740440},{"_id":"public/archives/2016/06/index.html","hash":"0be07d074ee158e2ed337abe71471f70f8768036","modified":1745773740440},{"_id":"public/archives/2017/index.html","hash":"c3db79a58a37c5f616724928f4f2aad1f699ac1a","modified":1745773740440},{"_id":"public/archives/2017/12/index.html","hash":"bf2b1c6aa519a0f7041824b5d77c6b48922d0531","modified":1745773740440},{"_id":"public/categories//index.html","hash":"44da86c85bb6dfdc149d3f9b80dabb6de2dee0a5","modified":1745773740440},{"_id":"public/categories//index.html","hash":"3681f20649ba3150e096d535ff55749fe5449b36","modified":1745773740440},{"_id":"public/index.html","hash":"e436823d071e6ba9a883bf84dfc0e5a7444979f3","modified":1747667297817},{"_id":"public/tags//index.html","hash":"613ac6b96f2925f93cb2f6cf9f86168a78615798","modified":1745773740440},{"_id":"public/tags//index.html","hash":"08765472edb26fafc0a79941057f2fefb4e86982","modified":1745773740440},{"_id":"public/tags/golang/index.html","hash":"b6e90899f1ccf30705552bd47185f4c1e47d808a","modified":1745773740440},{"_id":"public/tags/json/index.html","hash":"26d8a3e16eac39b55af5e59851c322d004f5daff","modified":1745773740440},{"_id":"public/samples/expvarsample.go","hash":"40e471129b2c9c1599977e73955d9ff19ea6f821","modified":1745773740440},{"_id":"public/images/avatar.jpg","hash":"c4dd28a263439f83c15ddc069d97642fcf22065f","modified":1745773740440},{"_id":"public/favicon.ico","hash":"1f7d35b787b1751eef2793a2a8c6171dff51820f","modified":1745773740440},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1745773740440},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1745773740440},{"_id":"public/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1745773740440},{"_id":"public/images/logo-algolia-nebula-blue-full.svg","hash":"a38c6d92b368bfc42c72ad799ad03f3274957065","modified":1745773740440},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1745773740440},{"_id":"public/images/logo.svg","hash":"099e11ab995a2c8981427a85476d082609848c77","modified":1745773740440},{"_id":"public/2016/04/20/experiences-about-develop-dlog/channel.png","hash":"07fa353dc547212f594f859c2dde0c217eff983b","modified":1745773740440},{"_id":"public/2016/04/20/experiences-about-develop-dlog/use_channel.png","hash":"853e9b256bf1db8aee27f55ec881305eb52d1ab6","modified":1745773740440},{"_id":"public/css/main.css","hash":"3ee14cd83bbbb18bf1ec21b6b26f6896a0ae9646","modified":1745773740440},{"_id":"public/css/noscript.css","hash":"4cd5301e478e0e0d4b176740ec314087ec5cb707","modified":1745773740440},{"_id":"public/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1745773740440},{"_id":"public/js/bookmark.js","hash":"9ba4cceafd12c6d5ba8a6b986a046ef8319a7811","modified":1745773740440},{"_id":"public/js/next-boot.js","hash":"523bbaeda463e82ab0be428cc0005717038ec63e","modified":1745773740440},{"_id":"public/js/pjax.js","hash":"694b271819aab37ce473b15db9e6aded971d82e5","modified":1745773740440},{"_id":"public/js/motion.js","hash":"6f751f5c9499a39d7c5e1d323db3260342dd9431","modified":1745773740440},{"_id":"public/js/schedule.js","hash":"a1333258726caf84f368a8f8454639c7dc1626bb","modified":1745773740440},{"_id":"public/js/sidebar.js","hash":"2ee359ae48273b01ba1e0768704524e08702c7eb","modified":1745773740440},{"_id":"public/js/utils.js","hash":"345a8158e6c34e19245a07c778f5699c8673f1b1","modified":1745773740440},{"_id":"public/js/third-party/addtoany.js","hash":"5276c8f78ee562a8965216dc67d762e59cb4a9f2","modified":1745773740440},{"_id":"public/js/third-party/fancybox.js","hash":"819f382c561fe5ec23c67cc5fabd63dd1cc22dc1","modified":1745773740440},{"_id":"public/js/third-party/quicklink.js","hash":"eed02e6fced8e5a653077205d4d4d7834ca71472","modified":1745773740440},{"_id":"public/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1745773740440},{"_id":"public/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1745773740440},{"_id":"public/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1745773740440},{"_id":"public/js/third-party/pace.js","hash":"0ef04218b93561ba4d0ff420d556c3d90a756d32","modified":1745773740440},{"_id":"public/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1745773740440},{"_id":"public/js/third-party/analytics/matomo.js","hash":"c6a25b26a1443caa70b47fd3dfa282271574deb5","modified":1745773740440},{"_id":"public/js/third-party/comments/changyan.js","hash":"260d1a77d6a3bb33a579d3e4cca1997003e799b5","modified":1745773740440},{"_id":"public/js/third-party/comments/disqus.js","hash":"da361917d65e5dca8362f8cdeb6c8cc0e8316cec","modified":1745773740440},{"_id":"public/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1745773740440},{"_id":"public/js/third-party/comments/disqusjs.js","hash":"1e826dea3f684c0515f362dc1352447a1f0eae71","modified":1745773740440},{"_id":"public/js/third-party/analytics/google-analytics.js","hash":"def07bcc7c17d8a0caad177fb1dd2f3a5e5b3536","modified":1745773740440},{"_id":"public/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1745773740440},{"_id":"public/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1745773740440},{"_id":"public/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1745773740440},{"_id":"public/js/third-party/math/mathjax.js","hash":"5c749b9c1c3bb738122d0516211ecff6496d4907","modified":1745773740440},{"_id":"public/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1745773740440},{"_id":"public/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1745773740440},{"_id":"public/js/third-party/search/local-search.js","hash":"3968d972f47b79acc6c3fe44028bad77c9c5aab7","modified":1745773740440},{"_id":"public/js/third-party/statistics/firestore.js","hash":"6e0682bb42170d61b13b786295f45f9c785f8b73","modified":1745773740440},{"_id":"public/js/third-party/statistics/lean-analytics.js","hash":"835cbf54c49ef1327f47df70ff2636ad36b6f57d","modified":1745773740440},{"_id":"public/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1745773740440},{"_id":"public/js/third-party/tags/wavedrom.js","hash":"40dcd10df6edf124088c329346e0cc0bdac74ef1","modified":1745773740440},{"_id":"public/js/third-party/tags/mermaid.js","hash":"df01075f52302873f7de36050b5408c8d1afb452","modified":1745773740440},{"_id":"public/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1745773740440},{"_id":"public/js/third-party/search/algolia-search.js","hash":"1905978ef587bf08fe088ce4693a4c08db07cfbb","modified":1745773740440},{"_id":"public/2016/04/20/experiences-about-develop-dlog/expvarmon_screen.png","hash":"3cf57a3f5a4de25e898ce566770f123a6efb8eb4","modified":1745773740440},{"_id":"public/2017/12/29/error-handling-in-go/d2a2d12e1a00f819d7fd7af4b536efa2.png","hash":"ae40aa7e6dcc2d443100f55eeebea79c3fa6b305","modified":1745773740440},{"_id":"public/2016/04/20/experiences-about-develop-dlog/2016-04-21_07-12-40.png","hash":"328e623a575da9a88b9a2cbb058d787e520ece1b","modified":1745773740440},{"_id":"public/2016/04/20/experiences-about-develop-dlog/2016-04-21_07-12-24.png","hash":"8b2db6e1b6c48cfdb7bf5d6f820d05bf1f5984ea","modified":1745773740440},{"_id":"public/2016/03/26/product-design-vs-requirement-analysis/0f819d7fd7af4b536efa2.png","hash":"ae40aa7e6dcc2d443100f55eeebea79c3fa6b305","modified":1745774101617}],"Category":[{"name":"","_id":"cm9zwlzc50004fdjhbnwv3p2a"},{"name":"","_id":"cm9zwlzc60009fdjh0j7u3jui"}],"Data":[],"Page":[{"_content":"<!DOCTYPE HTML>\n<html>\n<head>\n  <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\"/>\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n  <meta name=\"robots\" content=\"all\" />\n  <meta name=\"robots\" content=\"index,follow\"/>\n</head>\n<body>\n\n<script type=\"text/javascript\" src=\"http://www.qq.com/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"/\"\n        homePageName=\"\">\n</script>\n\n</body>\n</html>\n","source":"404.html","raw":"<!DOCTYPE HTML>\n<html>\n<head>\n  <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\"/>\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n  <meta name=\"robots\" content=\"all\" />\n  <meta name=\"robots\" content=\"index,follow\"/>\n</head>\n<body>\n\n<script type=\"text/javascript\" src=\"http://www.qq.com/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"/\"\n        homePageName=\"\">\n</script>\n\n</body>\n</html>\n","date":"2025-04-27T17:04:49.541Z","updated":"2025-04-27T17:04:49.541Z","path":"404.html","title":"","comments":1,"layout":"page","_id":"cm9zwlzc20000fdjh9r3qcsdi","content":"<!DOCTYPE HTML>\n<html>\n<head>\n  <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\"/>\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n  <meta name=\"robots\" content=\"all\" />\n  <meta name=\"robots\" content=\"index,follow\"/>\n</head>\n<body>\n\n<script type=\"text/javascript\" src=\"http://www.qq.com/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"/\"\n        homePageName=\"\">\n</script>\n\n</body>\n</html>\n","excerpt":"","more":"<!DOCTYPE HTML>\n<html>\n<head>\n  <meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8;\"/>\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n  <meta name=\"robots\" content=\"all\" />\n  <meta name=\"robots\" content=\"index,follow\"/>\n</head>\n<body>\n\n<script type=\"text/javascript\" src=\"http://www.qq.com/404/search_children.js\"\n        charset=\"utf-8\" homePageUrl=\"/\"\n        homePageName=\"\">\n</script>\n\n</body>\n</html>\n"},{"title":"","date":"2016-04-23T12:10:41.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: \ndate: 2016-04-23 20:10:41\ntype: \"categories\"\ncomments: false\n---\n","updated":"2025-04-27T17:04:49.543Z","path":"categories/index.html","layout":"page","_id":"cm9zwlzc40002fdjh4s6b1l0p","content":"","excerpt":"","more":""},{"title":"","date":"2016-04-23T12:05:07.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: \ndate: 2016-04-23 20:05:07\ntype: \"tags\"\ncomments: false\n---\n","updated":"2025-04-27T17:04:49.542Z","path":"tags/index.html","layout":"page","_id":"cm9zwlzc60006fdjh69z80ofz","content":"","excerpt":"","more":""}],"Post":[{"title":"","date":"2016-03-26T13:13:28.000Z","_content":"\n    \n    \n\n# \n\n2006CMMIRUPMSFUML\n\n2011Ebooking3\n\n\n\n# \n\n\n\nxx\n\n|                             |  |  |\n|:--------------------------------|:---------|:---------|\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n|                     |          |          |\n|                     |          |          |\n|                             |          |          |\n|                         |          |          |\n|                       |          |          |\n|                         |          |          |\n|                 |          |          |\n|                 |          |          |\n|                       |          |          |\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n|                     |          |          |\n| UML |          |          |\n| E-R                       |          |          |\n|                         |          |          |\n|                         |          |          |\n| Rational                        |          |          |\n| Axure RP                        |          |          |\n| Sketch                          |          |          |\n| UIUE                          |          |          |\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n\n\n\n\n|                             |  |  |\n|:--------------------------------|:---------|:---------|\n|                         | x        |          |\n|                         | x        |          |\n|                         | x        |          |\n|                         | x        |          |\n|                         |          | x        |\n|                     | x        |          |\n|                     |          | x        |\n|                             |          | x        |\n|                         | x        |          |\n|                       |          | x        |\n|                         |          | x        |\n|                 | x        |          |\n|                 |          | x        |\n|                       |          | x        |\n|                         | x        | x        |\n|                         |          | x        |\n|                         | x        |          |\n|                     |          | x        |\n| UML |          | x        |\n| E-R                       |          | x        |\n|                         |          | x        |\n|                         | x        |          |\n| Rational                        |          | x        |\n| Axure RP                        | x        |          |\n| Sketch                          | x        |          |\n| UIUE                          | x        |          |\n|                         | x        |          |\n|                         | x        |          |\n|                         |          | x        |\n|                         | x        |          |\n\n\n\n- \n- \n- \n\n\n\n# \n\n\n\n- \n- \n\nE-RUML\n\nE-RUMLUI/UE****\n\n# \n\n\n\n\n\n\n\n# \n\n- [UMLChina](http://www.umlchina.com/)\n- [](http://v.youku.com/v_show/id_XMTIzMzczNg==.html)\n","source":"_posts/2016-03-26-product-design-vs-requirement-analysis.md","raw":"---\ntitle: \ndate: 2016-03-26 21:13:28\ncategories:\n- \ntags:\n- \n- \n---\n\n    \n    \n\n# \n\n2006CMMIRUPMSFUML\n\n2011Ebooking3\n\n\n\n# \n\n\n\nxx\n\n|                             |  |  |\n|:--------------------------------|:---------|:---------|\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n|                     |          |          |\n|                     |          |          |\n|                             |          |          |\n|                         |          |          |\n|                       |          |          |\n|                         |          |          |\n|                 |          |          |\n|                 |          |          |\n|                       |          |          |\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n|                     |          |          |\n| UML |          |          |\n| E-R                       |          |          |\n|                         |          |          |\n|                         |          |          |\n| Rational                        |          |          |\n| Axure RP                        |          |          |\n| Sketch                          |          |          |\n| UIUE                          |          |          |\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n|                         |          |          |\n\n\n\n\n|                             |  |  |\n|:--------------------------------|:---------|:---------|\n|                         | x        |          |\n|                         | x        |          |\n|                         | x        |          |\n|                         | x        |          |\n|                         |          | x        |\n|                     | x        |          |\n|                     |          | x        |\n|                             |          | x        |\n|                         | x        |          |\n|                       |          | x        |\n|                         |          | x        |\n|                 | x        |          |\n|                 |          | x        |\n|                       |          | x        |\n|                         | x        | x        |\n|                         |          | x        |\n|                         | x        |          |\n|                     |          | x        |\n| UML |          | x        |\n| E-R                       |          | x        |\n|                         |          | x        |\n|                         | x        |          |\n| Rational                        |          | x        |\n| Axure RP                        | x        |          |\n| Sketch                          | x        |          |\n| UIUE                          | x        |          |\n|                         | x        |          |\n|                         | x        |          |\n|                         |          | x        |\n|                         | x        |          |\n\n\n\n- \n- \n- \n\n\n\n# \n\n\n\n- \n- \n\nE-RUML\n\nE-RUMLUI/UE****\n\n# \n\n\n\n\n\n\n\n# \n\n- [UMLChina](http://www.umlchina.com/)\n- [](http://v.youku.com/v_show/id_XMTIzMzczNg==.html)\n","slug":"product-design-vs-requirement-analysis","published":1,"updated":"2025-04-27T17:04:49.539Z","comments":1,"layout":"post","photos":[],"_id":"cm9zwlzc20001fdjh8l2s8eko","content":"<pre><code>\n\n</code></pre>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>2006CMMIRUPMSFUML</p>\n<p>2011Ebooking3</p>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p>xx</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">UML</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">E-R</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Rational</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Axure RP</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Sketch</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">UIUE</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p></p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\">UML</td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\">E-R</td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Rational</td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\">Axure RP</td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Sketch</td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">UIUE</td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>E-RUML</p>\n<p>E-RUMLUI&#x2F;UE<strong></strong></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p></p>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li><a href=\"http://www.umlchina.com/\">UMLChina</a></li>\n<li><a href=\"http://v.youku.com/v_show/id_XMTIzMzczNg==.html\"></a></li>\n</ul>\n","excerpt":"","more":"<pre><code>\n\n</code></pre>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>2006CMMIRUPMSFUML</p>\n<p>2011Ebooking3</p>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p>xx</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">UML</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">E-R</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Rational</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Axure RP</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Sketch</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">UIUE</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p></p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\">UML</td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\">E-R</td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Rational</td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\">Axure RP</td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Sketch</td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">UIUE</td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\">x</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>E-RUML</p>\n<p>E-RUMLUI&#x2F;UE<strong></strong></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p></p>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li><a href=\"http://www.umlchina.com/\">UMLChina</a></li>\n<li><a href=\"http://v.youku.com/v_show/id_XMTIzMzczNg==.html\"></a></li>\n</ul>\n"},{"title":"GolangJSON","date":"2016-06-23T00:09:39.000Z","_content":"\n\n# \n\n\n\nGolangJSON\n\n# \n\n## 1`omitempty`\n\nC#JSON`Newtonsoft.Json`JSONJSON`property annotation``ShouldSerialize method`\n\n```c#\n// ShouldSerialize methodObsoleteSetting\nclass Config\n{\n    public Fizz ObsoleteSetting { get; set; }\n\n    public bool ShouldSerializeObsoleteSetting()\n    {\n        return false;\n    }\n}\n\n// JsonIgnoreannotationObsoleteSetting\nclass Config\n{\n    [JsonIgnore]\n    public Fizz ObsoleteSetting { get; set; }\n\n    public Bang ReplacementSetting { get; set; }\n}\n```\n\n`Newtonsoft.Json`Conditional Property Serialization\n\n- [Conditional Property Serialization](http://www.newtonsoft.com/json/help/html/ConditionalProperties.htm)\n- [Making a property deserialize but not serialize with json.net](http://stackoverflow.com/questions/11564091/making-a-property-deserialize-but-not-serialize-with-json-net)\n\nGolang`omitempty`C#[encoding/json package](http://docs.studygolang.com/pkg/encoding/json/#Marshal)`omitempty`\n\n> Struct values encode as JSON objects. Each exported struct field becomes a member of the object unless\n>\n> - the field's tag is \"-\", or\n> - the field is empty and its tag specifies the \"omitempty\" option.\n>\n> The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero. The object's default key string is the struct field name but can be specified in the struct field's tag value. The \"json\" key in the struct field's tag value is the key name, followed by an optional comma and options. Examples:\n>\n> ```go\n> // Field is ignored by this package.\n> Field int `json:\"-\"`\n>\n> // Field appears in JSON as key \"myName\".\n> Field int `json:\"myName\"`\n>\n> // Field appears in JSON as key \"myName\" and\n> // the field is omitted from the object if its value is empty,\n> // as defined above.\n> Field int `json:\"myName,omitempty\"`\n>\n> // Field appears in JSON as key \"Field\" (the default), but\n> // the field is skipped if empty.\n> // Note the leading comma.\n> Field int `json:\",omitempty\"`\n> ```\n\nGolang`field`JSON`-``field``JsonIgnore`\n\n`omitempty``field``empty`JSON`field``Newtonsoft.Json`[](http://stackoverflow.com/questions/6507889/how-to-ignore-a-property-in-class-if-null-using-json-net)[](https://dotnetfiddle.net/VXqRnm)`emtpty`\n\n> The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero.\n\n`empty values`\n\n```go\npackage main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"log\"\n    \"os\"\n)\n\ntype S1 struct {\n    I1 int\n    I2 int `json:\",omitempty\"`\n\n    F1 float64\n    F2 float64 `json:\",omitempty\"`\n\n    S1 string\n    S2 string `json:\",omitempty\"`\n\n    B1 bool\n    B2 bool `json:\",omitempty\"`\n\n    Slice1 []int\n    Slice2 []int `json:\",omitempty\"`\n    Slice3 []int `json:\",omitempty\"`\n\n    Map1 map[string]string\n    Map2 map[string]string `json:\",omitempty\"`\n    Map3 map[string]string `json:\",omitempty\"`\n\n    O1 interface{}\n    O2 interface{} `json:\",omitempty\"`\n    O3 interface{} `json:\",omitempty\"`\n    O4 interface{} `json:\",omitempty\"`\n    O5 interface{} `json:\",omitempty\"`\n    O6 interface{} `json:\",omitempty\"`\n    O7 interface{} `json:\",omitempty\"`\n    O8 interface{} `json:\",omitempty\"`\n\n    P1 *int\n    P2 *int               `json:\",omitempty\"`\n    P3 *int               `json:\",omitempty\"`\n    P4 *float64           `json:\",omitempty\"`\n    P5 *string            `json:\",omitempty\"`\n    P6 *bool              `json:\",omitempty\"`\n    P7 *[]int             `json:\",omitempty\"`\n    P8 *map[string]string `json:\",omitempty\"`\n}\n\nfunc main() {\n\n    p3 := 0\n    p4 := float64(0)\n    p5 := \"\"\n    p6 := false\n    p7 := []int{}\n    p8 := map[string]string{}\n\n    s1 := S1{\n        I1: 0,\n        I2: 0,\n\n        F1: 0,\n        F2: 0,\n\n        S1: \"\",\n        S2: \"\",\n\n        B1: false,\n        B2: false,\n\n        Slice1: []int{},\n        Slice2: nil,\n        Slice3: []int{},\n\n        Map1: map[string]string{},\n        Map2: nil,\n        Map3: map[string]string{},\n\n        O1: nil,\n        O2: nil,\n        O3: int(0),\n        O4: float64(0),\n        O5: \"\",\n        O6: false,\n        O7: []int{},\n        O8: map[string]string{},\n\n        P1: nil,\n        P2: nil,\n        P3: &p3,\n        P4: &p4,\n        P5: &p5,\n        P6: &p6,\n        P7: &p7,\n        P8: &p8,\n    }\n\n    b, err := json.Marshal(s1)\n    if err != nil {\n        log.Printf(\"marshal error: %v\", err)\n        return\n    }\n\n    var out bytes.Buffer\n    json.Indent(&out, b, \"\", \"\\t\")\n    out.WriteTo(os.Stdout)\n    //Output:\n    //{\n    //\t\"I1\": 0,\n    //\t\"F1\": 0,\n    //\t\"S1\": \"\",\n    //\t\"B1\": false,\n    //\t\"Slice1\": [],\n    //\t\"Map1\": {},\n    //\t\"O1\": null,\n    //\t\"O3\": 0,\n    //\t\"O4\": 0,\n    //\t\"O5\": \"\",\n    //\t\"O6\": false,\n    //\t\"O7\": [],\n    //\t\"O8\": {},\n    //\t\"P1\": null,\n    //\t\"P2\": 0\n    //}%\n}\n```\n\n*[](https://play.golang.org/p/6y_m27r8EO)*\n\n`empty value`\n\nAppRestful APIResponse`User`\n\n```go\ntype User struct {\n    ID        int `json:\"id\"`                  // id\n    // field\n    FansCount int `json:\"fansCount,omitempty\"` // \n}\n```\n\nAppRestful APIResponse\n\n```json\n{\n    \"id\": 1000386,\n    ...\n}\n```\n\nResponseUser`fansCount``fansCount``int`0`User``fansCount`********\n\n********`User`\n\n```go\ntype User struct {\n    ID        int  `json:\"id\"`                  // id\n    // field\n    FansCount *int `json:\"fansCount,omitempty\"` // \n}\n```\n\n`FansCount``nil`0\n\n`FansCount``FansCount`\n\n```go\n// FansCountint\nuser := dataAccess.GetUserInfo(userId)\nuser.FansCount = dataAccess.GetFansCount(userId)\n\n// FansCount*int\nuser := dataAccess.GetUserInfo(userId)\nfansCount := dataAccess.GetFansCount(userId)\nuser.FansCount = &fansCount\n```\n\n## 2JSONinterface{}Number\n\n[JSON](http://json.org/)\n\n![](https://www.json.org/img/value.png)\n\nJSON:\n\n```json\n{\n    \"name\": \"ethancai\",\n    \"fansCount\": 9223372036854775807\n}\n```\n\n\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype User struct {\n    Name      string\n    FansCount int64\n}\n\nfunc main() {\n    const jsonStream = `\n        {\"name\":\"ethancai\", \"fansCount\": 9223372036854775807}\n    `\n    var user User  // User\n    err := json.Unmarshal([]byte(jsonStream), &user)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n\n    fmt.Printf(\"%+v \\n\", user)\n}\n// Output:\n//  {Name:ethancai FansCount:9223372036854775807}\n```\n\n*[](https://play.golang.org/p/203egccrea)*\n\nJSON`float64`\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    const jsonStream = `\n        {\"name\":\"ethancai\", \"fansCount\": 9223372036854775807}\n    `\n    var user interface{}  // \n    err := json.Unmarshal([]byte(jsonStream), &user)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    m := user.(map[string]interface{})\n\n    fansCount := m[\"fansCount\"]\n\n    fmt.Printf(\"%+v \\n\", reflect.TypeOf(fansCount).Name())\n    fmt.Printf(\"%+v \\n\", fansCount.(float64))\n}\n\n// Output:\n// \tfloat64\n//  \t9.223372036854776e+18\n```\n\n*[](https://play.golang.org/p/l4GzgA4WDA)*\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype User struct {\n    Name      string\n    FansCount interface{}  // FansCount\n}\n\nfunc main() {\n    const jsonStream = `\n        {\"name\":\"ethancai\", \"fansCount\": 9223372036854775807}\n    `\n    var user User\n    err := json.Unmarshal([]byte(jsonStream), &user)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n\n    fmt.Printf(\"%+v \\n\", user)\n}\n\n// Output:\n// \t{Name:ethancai FansCount:9.223372036854776e+18}\n```\n\n*[](https://play.golang.org/p/SoD6SOGuCM)*\n\n`fansCount``float64`\n\n\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n    \"strings\"\n)\n\nfunc main() {\n    const jsonStream = `\n        {\"name\":\"ethancai\", \"fansCount\": 9223372036854775807}\n    `\n\n    decoder := json.NewDecoder(strings.NewReader(jsonStream))\n    decoder.UseNumber()    // UseNumber causes the Decoder to unmarshal a number into an interface{} as a Number instead of as a float64.\n\n    var user interface{}\n    if err := decoder.Decode(&user); err != nil {\n        fmt.Println(\"error:\", err)\n            return\n        }\n\n    m := user.(map[string]interface{})\n    fansCount := m[\"fansCount\"]\n    fmt.Printf(\"%+v \\n\", reflect.TypeOf(fansCount).PkgPath() + \".\" + reflect.TypeOf(fansCount).Name())\n\n     v, err := fansCount.(json.Number).Int64()\n    if err != nil {\n        fmt.Println(\"error:\", err)\n            return\n    }\n    fmt.Printf(\"%+v \\n\", v)\n}\n\n// Output:\n// \tencoding/json.Number\n// \t9223372036854775807\n```\n*[](https://play.golang.org/p/KYrFshVMFD)*\n\n`func (*Decoder) UseNumber`JSON`float64``json.Number``json.Number`\n\n```go\n// A Number represents a JSON number literal.\ntype Number string\n\n// String returns the literal text of the number.\nfunc (n Number) String() string { return string(n) }\n\n// Float64 returns the number as a float64.\nfunc (n Number) Float64() (float64, error) {\n    return strconv.ParseFloat(string(n), 64)\n}\n\n// Int64 returns the number as an int64.\nfunc (n Number) Int64() (int64, error) {\n    return strconv.ParseInt(string(n), 10, 64)\n}\n```\n\n`json.Number`JSON`json.Number``json.Number``float64``int64`\n\nGolangJSON\n\nJavaScript[](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Numbers_and_dates)JSONJSONJavaScript Object NotationJavaScriptDouglas CrockfordJavaScript[Douglas Crockford](http://www.infoq.com/cn/news/2010/02/qconbeijing2010-douglas)\n\nC#JSONlibrary [Json.NET](http://www.newtonsoft.com/json)JSONGolang\n\n```c#\nusing System;\nusing Newtonsoft.Json;\n\npublic class Program\n{\n    public static void Main()\n    {\n        string json = @\"{\n  'Name': 'Ethan',\n  'FansCount': 121211,\n  'Price': 99.99\n}\";\n\n        Product m = JsonConvert.DeserializeObject<Product>(json);\n\n        Console.WriteLine(m.FansCount);\n        Console.WriteLine(m.FansCount.GetType().FullName);\n\n        Console.WriteLine(m.Price);\n        Console.WriteLine(m.Price.GetType().FullName);\n\n    }\n}\n\npublic class Product\n{\n    public string Name\n    {\n        get;\n        set;\n    }\n\n    public object FansCount\n    {\n        get;\n        set;\n    }\n\n    public object Price\n    {\n        get;\n        set;\n    }\n}\n\n// Output:\n//      121211\n//      System.Int64\n//      99.99\n//      System.Double\n```\n\n*[](https://dotnetfiddle.net/IrlMae)*\n\n`Json.NET`\n\n## 3\n\nJSONlibrary\n\nGo\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    type Product struct {\n        Name      string\n        CreatedAt time.Time\n    }\n    pdt := Product{\n        Name:      \"Reds\",\n        CreatedAt: time.Now(),\n    }\n    b, err := json.Marshal(pdt)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    os.Stdout.Write(b)\n}\n// Output\n//      {\"Name\":\"Reds\",\"CreatedAt\":\"2016-06-27T07:40:54.69292134+08:00\"}\n```\n\nJavaScript\n\n```sh\n  ~ node\n> var jo = { name: \"ethan\", createdAt: Date.now() };\nundefined\n> JSON.stringify(jo)\n'{\"name\":\"ethan\",\"createdAt\":1466984665633}'\n```\n\nC#\n\n```c#\nusing System;\nusing Newtonsoft.Json;\n\npublic class Program\n{\n    public static void Main()\n    {\n        Product product = new Product();\n        product.Name = \"Apple\";\n        product.CreatedAt = DateTime.Now;\n\n        string json = JsonConvert.SerializeObject(product,\n                            Newtonsoft.Json.Formatting.Indented,\n                            new JsonSerializerSettings {\n                                NullValueHandling = NullValueHandling.Ignore\n                            });\n        Console.WriteLine(json);\n    }\n}\n\npublic class Product\n{\n    public string Name\n    {\n        get;\n        set;\n    }\n\n    public DateTime CreatedAt\n    {\n        get;\n        set;\n    }\n}\n// Output:\n//      {\n//        \"Name\": \"Apple\",\n//        \"CreatedAt\": \"2016-06-26T23:46:57.3244307+00:00\"\n//      }\n```\n\nGo`encoding/json` packageC#Json.NET[ISO 8601](http://www.w3.org/TR/NOTE-datetime)JavaScript`Date`197011000JavaScript[`dateObj.toISOString()`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString)ISO[`Date.parse(dateString)`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/parse)ISO\n\nISOGo`time.Time`\n\n```go\ntype Time struct {\n    // sec gives the number of seconds elapsed since\n    // January 1, year 1 00:00:00 UTC.\n    sec int64\n\n    // nsec specifies a non-negative nanosecond\n    // offset within the second named by Seconds.\n    // It must be in the range [0, 999999999].\n    nsec int32\n\n    // loc specifies the Location that should be used to\n    // determine the minute, hour, month, day, and year\n    // that correspond to this Time.\n    // Only the zero Time has a nil Location.\n    // In that case it is interpreted to mean UTC.\n    loc *Location\n}\n```\n\nJSON\n\n- .NET FrameworkJSON`\"\\/Date(1343660352227+0530)\\/\"`\n- ISO\n- `1970-1-1 00:00:00 UTC``1970-1-1 00:00:00`\n\n\n# \n\n\n\n- [package encoding/json in Go](http://docs.studygolang.com/pkg/encoding/json/)\n- [http://docs.studygolang.com/src/encoding/json/example_test.go](http://docs.studygolang.com/src/encoding/json/example_test.go)\n- [The Go Blog: JSON and Go](https://blog.golang.org/json-and-go)\n- [Go by example: JSON](https://gobyexample.com/json)\n- [JSON decoding in Go](http://attilaolah.eu/2013/11/29/json-decoding-in-go/)\n- [go and json](https://eager.io/blog/go-and-json/)\n- [Decode JSON Documents In Go](https://www.goinggo.net/2014/01/decode-json-documents-in-go.html)\n- [ffjson: faster JSON serialization for Golang](https://journal.paul.querna.org/articles/2014/03/31/ffjson-faster-json-in-go/)\n- [Serialization in Go](http://www.slideshare.net/albertstrasheim/serialization-in-go)\n\n\n\n- [ffjson](https://github.com/pquerna/ffjson): faster JSON serialization for Go\n- [go-simplejson](https://github.com/bitly/go-simplejson): a Go package to interact with arbitrary JSON\n- [Jason](https://github.com/antonholmquist/jason): Easy-to-use JSON Library for Go\n- [easyjson](https://github.com/mailru/easyjson)\n- [gabs](https://github.com/Jeffail/gabs)\n- [jsonparser](https://github.com/buger/jsonparser)\n\n\n\n- [JSON-to-Go](https://mholt.github.io/json-to-go/): instantly converts JSON into a Go type definition\n","source":"_posts/2016-06-23-bad-parts-about-json-serialization-in-Golang.md","raw":"---\ntitle: GolangJSON\ncategories:\n  - \ntags:\n  - golang\n  - json\ndate: 2016-06-23 08:09:39\n---\n\n\n# \n\n\n\nGolangJSON\n\n# \n\n## 1`omitempty`\n\nC#JSON`Newtonsoft.Json`JSONJSON`property annotation``ShouldSerialize method`\n\n```c#\n// ShouldSerialize methodObsoleteSetting\nclass Config\n{\n    public Fizz ObsoleteSetting { get; set; }\n\n    public bool ShouldSerializeObsoleteSetting()\n    {\n        return false;\n    }\n}\n\n// JsonIgnoreannotationObsoleteSetting\nclass Config\n{\n    [JsonIgnore]\n    public Fizz ObsoleteSetting { get; set; }\n\n    public Bang ReplacementSetting { get; set; }\n}\n```\n\n`Newtonsoft.Json`Conditional Property Serialization\n\n- [Conditional Property Serialization](http://www.newtonsoft.com/json/help/html/ConditionalProperties.htm)\n- [Making a property deserialize but not serialize with json.net](http://stackoverflow.com/questions/11564091/making-a-property-deserialize-but-not-serialize-with-json-net)\n\nGolang`omitempty`C#[encoding/json package](http://docs.studygolang.com/pkg/encoding/json/#Marshal)`omitempty`\n\n> Struct values encode as JSON objects. Each exported struct field becomes a member of the object unless\n>\n> - the field's tag is \"-\", or\n> - the field is empty and its tag specifies the \"omitempty\" option.\n>\n> The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero. The object's default key string is the struct field name but can be specified in the struct field's tag value. The \"json\" key in the struct field's tag value is the key name, followed by an optional comma and options. Examples:\n>\n> ```go\n> // Field is ignored by this package.\n> Field int `json:\"-\"`\n>\n> // Field appears in JSON as key \"myName\".\n> Field int `json:\"myName\"`\n>\n> // Field appears in JSON as key \"myName\" and\n> // the field is omitted from the object if its value is empty,\n> // as defined above.\n> Field int `json:\"myName,omitempty\"`\n>\n> // Field appears in JSON as key \"Field\" (the default), but\n> // the field is skipped if empty.\n> // Note the leading comma.\n> Field int `json:\",omitempty\"`\n> ```\n\nGolang`field`JSON`-``field``JsonIgnore`\n\n`omitempty``field``empty`JSON`field``Newtonsoft.Json`[](http://stackoverflow.com/questions/6507889/how-to-ignore-a-property-in-class-if-null-using-json-net)[](https://dotnetfiddle.net/VXqRnm)`emtpty`\n\n> The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero.\n\n`empty values`\n\n```go\npackage main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"log\"\n    \"os\"\n)\n\ntype S1 struct {\n    I1 int\n    I2 int `json:\",omitempty\"`\n\n    F1 float64\n    F2 float64 `json:\",omitempty\"`\n\n    S1 string\n    S2 string `json:\",omitempty\"`\n\n    B1 bool\n    B2 bool `json:\",omitempty\"`\n\n    Slice1 []int\n    Slice2 []int `json:\",omitempty\"`\n    Slice3 []int `json:\",omitempty\"`\n\n    Map1 map[string]string\n    Map2 map[string]string `json:\",omitempty\"`\n    Map3 map[string]string `json:\",omitempty\"`\n\n    O1 interface{}\n    O2 interface{} `json:\",omitempty\"`\n    O3 interface{} `json:\",omitempty\"`\n    O4 interface{} `json:\",omitempty\"`\n    O5 interface{} `json:\",omitempty\"`\n    O6 interface{} `json:\",omitempty\"`\n    O7 interface{} `json:\",omitempty\"`\n    O8 interface{} `json:\",omitempty\"`\n\n    P1 *int\n    P2 *int               `json:\",omitempty\"`\n    P3 *int               `json:\",omitempty\"`\n    P4 *float64           `json:\",omitempty\"`\n    P5 *string            `json:\",omitempty\"`\n    P6 *bool              `json:\",omitempty\"`\n    P7 *[]int             `json:\",omitempty\"`\n    P8 *map[string]string `json:\",omitempty\"`\n}\n\nfunc main() {\n\n    p3 := 0\n    p4 := float64(0)\n    p5 := \"\"\n    p6 := false\n    p7 := []int{}\n    p8 := map[string]string{}\n\n    s1 := S1{\n        I1: 0,\n        I2: 0,\n\n        F1: 0,\n        F2: 0,\n\n        S1: \"\",\n        S2: \"\",\n\n        B1: false,\n        B2: false,\n\n        Slice1: []int{},\n        Slice2: nil,\n        Slice3: []int{},\n\n        Map1: map[string]string{},\n        Map2: nil,\n        Map3: map[string]string{},\n\n        O1: nil,\n        O2: nil,\n        O3: int(0),\n        O4: float64(0),\n        O5: \"\",\n        O6: false,\n        O7: []int{},\n        O8: map[string]string{},\n\n        P1: nil,\n        P2: nil,\n        P3: &p3,\n        P4: &p4,\n        P5: &p5,\n        P6: &p6,\n        P7: &p7,\n        P8: &p8,\n    }\n\n    b, err := json.Marshal(s1)\n    if err != nil {\n        log.Printf(\"marshal error: %v\", err)\n        return\n    }\n\n    var out bytes.Buffer\n    json.Indent(&out, b, \"\", \"\\t\")\n    out.WriteTo(os.Stdout)\n    //Output:\n    //{\n    //\t\"I1\": 0,\n    //\t\"F1\": 0,\n    //\t\"S1\": \"\",\n    //\t\"B1\": false,\n    //\t\"Slice1\": [],\n    //\t\"Map1\": {},\n    //\t\"O1\": null,\n    //\t\"O3\": 0,\n    //\t\"O4\": 0,\n    //\t\"O5\": \"\",\n    //\t\"O6\": false,\n    //\t\"O7\": [],\n    //\t\"O8\": {},\n    //\t\"P1\": null,\n    //\t\"P2\": 0\n    //}%\n}\n```\n\n*[](https://play.golang.org/p/6y_m27r8EO)*\n\n`empty value`\n\nAppRestful APIResponse`User`\n\n```go\ntype User struct {\n    ID        int `json:\"id\"`                  // id\n    // field\n    FansCount int `json:\"fansCount,omitempty\"` // \n}\n```\n\nAppRestful APIResponse\n\n```json\n{\n    \"id\": 1000386,\n    ...\n}\n```\n\nResponseUser`fansCount``fansCount``int`0`User``fansCount`********\n\n********`User`\n\n```go\ntype User struct {\n    ID        int  `json:\"id\"`                  // id\n    // field\n    FansCount *int `json:\"fansCount,omitempty\"` // \n}\n```\n\n`FansCount``nil`0\n\n`FansCount``FansCount`\n\n```go\n// FansCountint\nuser := dataAccess.GetUserInfo(userId)\nuser.FansCount = dataAccess.GetFansCount(userId)\n\n// FansCount*int\nuser := dataAccess.GetUserInfo(userId)\nfansCount := dataAccess.GetFansCount(userId)\nuser.FansCount = &fansCount\n```\n\n## 2JSONinterface{}Number\n\n[JSON](http://json.org/)\n\n![](https://www.json.org/img/value.png)\n\nJSON:\n\n```json\n{\n    \"name\": \"ethancai\",\n    \"fansCount\": 9223372036854775807\n}\n```\n\n\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype User struct {\n    Name      string\n    FansCount int64\n}\n\nfunc main() {\n    const jsonStream = `\n        {\"name\":\"ethancai\", \"fansCount\": 9223372036854775807}\n    `\n    var user User  // User\n    err := json.Unmarshal([]byte(jsonStream), &user)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n\n    fmt.Printf(\"%+v \\n\", user)\n}\n// Output:\n//  {Name:ethancai FansCount:9223372036854775807}\n```\n\n*[](https://play.golang.org/p/203egccrea)*\n\nJSON`float64`\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    const jsonStream = `\n        {\"name\":\"ethancai\", \"fansCount\": 9223372036854775807}\n    `\n    var user interface{}  // \n    err := json.Unmarshal([]byte(jsonStream), &user)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    m := user.(map[string]interface{})\n\n    fansCount := m[\"fansCount\"]\n\n    fmt.Printf(\"%+v \\n\", reflect.TypeOf(fansCount).Name())\n    fmt.Printf(\"%+v \\n\", fansCount.(float64))\n}\n\n// Output:\n// \tfloat64\n//  \t9.223372036854776e+18\n```\n\n*[](https://play.golang.org/p/l4GzgA4WDA)*\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype User struct {\n    Name      string\n    FansCount interface{}  // FansCount\n}\n\nfunc main() {\n    const jsonStream = `\n        {\"name\":\"ethancai\", \"fansCount\": 9223372036854775807}\n    `\n    var user User\n    err := json.Unmarshal([]byte(jsonStream), &user)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n\n    fmt.Printf(\"%+v \\n\", user)\n}\n\n// Output:\n// \t{Name:ethancai FansCount:9.223372036854776e+18}\n```\n\n*[](https://play.golang.org/p/SoD6SOGuCM)*\n\n`fansCount``float64`\n\n\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n    \"strings\"\n)\n\nfunc main() {\n    const jsonStream = `\n        {\"name\":\"ethancai\", \"fansCount\": 9223372036854775807}\n    `\n\n    decoder := json.NewDecoder(strings.NewReader(jsonStream))\n    decoder.UseNumber()    // UseNumber causes the Decoder to unmarshal a number into an interface{} as a Number instead of as a float64.\n\n    var user interface{}\n    if err := decoder.Decode(&user); err != nil {\n        fmt.Println(\"error:\", err)\n            return\n        }\n\n    m := user.(map[string]interface{})\n    fansCount := m[\"fansCount\"]\n    fmt.Printf(\"%+v \\n\", reflect.TypeOf(fansCount).PkgPath() + \".\" + reflect.TypeOf(fansCount).Name())\n\n     v, err := fansCount.(json.Number).Int64()\n    if err != nil {\n        fmt.Println(\"error:\", err)\n            return\n    }\n    fmt.Printf(\"%+v \\n\", v)\n}\n\n// Output:\n// \tencoding/json.Number\n// \t9223372036854775807\n```\n*[](https://play.golang.org/p/KYrFshVMFD)*\n\n`func (*Decoder) UseNumber`JSON`float64``json.Number``json.Number`\n\n```go\n// A Number represents a JSON number literal.\ntype Number string\n\n// String returns the literal text of the number.\nfunc (n Number) String() string { return string(n) }\n\n// Float64 returns the number as a float64.\nfunc (n Number) Float64() (float64, error) {\n    return strconv.ParseFloat(string(n), 64)\n}\n\n// Int64 returns the number as an int64.\nfunc (n Number) Int64() (int64, error) {\n    return strconv.ParseInt(string(n), 10, 64)\n}\n```\n\n`json.Number`JSON`json.Number``json.Number``float64``int64`\n\nGolangJSON\n\nJavaScript[](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Numbers_and_dates)JSONJSONJavaScript Object NotationJavaScriptDouglas CrockfordJavaScript[Douglas Crockford](http://www.infoq.com/cn/news/2010/02/qconbeijing2010-douglas)\n\nC#JSONlibrary [Json.NET](http://www.newtonsoft.com/json)JSONGolang\n\n```c#\nusing System;\nusing Newtonsoft.Json;\n\npublic class Program\n{\n    public static void Main()\n    {\n        string json = @\"{\n  'Name': 'Ethan',\n  'FansCount': 121211,\n  'Price': 99.99\n}\";\n\n        Product m = JsonConvert.DeserializeObject<Product>(json);\n\n        Console.WriteLine(m.FansCount);\n        Console.WriteLine(m.FansCount.GetType().FullName);\n\n        Console.WriteLine(m.Price);\n        Console.WriteLine(m.Price.GetType().FullName);\n\n    }\n}\n\npublic class Product\n{\n    public string Name\n    {\n        get;\n        set;\n    }\n\n    public object FansCount\n    {\n        get;\n        set;\n    }\n\n    public object Price\n    {\n        get;\n        set;\n    }\n}\n\n// Output:\n//      121211\n//      System.Int64\n//      99.99\n//      System.Double\n```\n\n*[](https://dotnetfiddle.net/IrlMae)*\n\n`Json.NET`\n\n## 3\n\nJSONlibrary\n\nGo\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    type Product struct {\n        Name      string\n        CreatedAt time.Time\n    }\n    pdt := Product{\n        Name:      \"Reds\",\n        CreatedAt: time.Now(),\n    }\n    b, err := json.Marshal(pdt)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    os.Stdout.Write(b)\n}\n// Output\n//      {\"Name\":\"Reds\",\"CreatedAt\":\"2016-06-27T07:40:54.69292134+08:00\"}\n```\n\nJavaScript\n\n```sh\n  ~ node\n> var jo = { name: \"ethan\", createdAt: Date.now() };\nundefined\n> JSON.stringify(jo)\n'{\"name\":\"ethan\",\"createdAt\":1466984665633}'\n```\n\nC#\n\n```c#\nusing System;\nusing Newtonsoft.Json;\n\npublic class Program\n{\n    public static void Main()\n    {\n        Product product = new Product();\n        product.Name = \"Apple\";\n        product.CreatedAt = DateTime.Now;\n\n        string json = JsonConvert.SerializeObject(product,\n                            Newtonsoft.Json.Formatting.Indented,\n                            new JsonSerializerSettings {\n                                NullValueHandling = NullValueHandling.Ignore\n                            });\n        Console.WriteLine(json);\n    }\n}\n\npublic class Product\n{\n    public string Name\n    {\n        get;\n        set;\n    }\n\n    public DateTime CreatedAt\n    {\n        get;\n        set;\n    }\n}\n// Output:\n//      {\n//        \"Name\": \"Apple\",\n//        \"CreatedAt\": \"2016-06-26T23:46:57.3244307+00:00\"\n//      }\n```\n\nGo`encoding/json` packageC#Json.NET[ISO 8601](http://www.w3.org/TR/NOTE-datetime)JavaScript`Date`197011000JavaScript[`dateObj.toISOString()`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString)ISO[`Date.parse(dateString)`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/parse)ISO\n\nISOGo`time.Time`\n\n```go\ntype Time struct {\n    // sec gives the number of seconds elapsed since\n    // January 1, year 1 00:00:00 UTC.\n    sec int64\n\n    // nsec specifies a non-negative nanosecond\n    // offset within the second named by Seconds.\n    // It must be in the range [0, 999999999].\n    nsec int32\n\n    // loc specifies the Location that should be used to\n    // determine the minute, hour, month, day, and year\n    // that correspond to this Time.\n    // Only the zero Time has a nil Location.\n    // In that case it is interpreted to mean UTC.\n    loc *Location\n}\n```\n\nJSON\n\n- .NET FrameworkJSON`\"\\/Date(1343660352227+0530)\\/\"`\n- ISO\n- `1970-1-1 00:00:00 UTC``1970-1-1 00:00:00`\n\n\n# \n\n\n\n- [package encoding/json in Go](http://docs.studygolang.com/pkg/encoding/json/)\n- [http://docs.studygolang.com/src/encoding/json/example_test.go](http://docs.studygolang.com/src/encoding/json/example_test.go)\n- [The Go Blog: JSON and Go](https://blog.golang.org/json-and-go)\n- [Go by example: JSON](https://gobyexample.com/json)\n- [JSON decoding in Go](http://attilaolah.eu/2013/11/29/json-decoding-in-go/)\n- [go and json](https://eager.io/blog/go-and-json/)\n- [Decode JSON Documents In Go](https://www.goinggo.net/2014/01/decode-json-documents-in-go.html)\n- [ffjson: faster JSON serialization for Golang](https://journal.paul.querna.org/articles/2014/03/31/ffjson-faster-json-in-go/)\n- [Serialization in Go](http://www.slideshare.net/albertstrasheim/serialization-in-go)\n\n\n\n- [ffjson](https://github.com/pquerna/ffjson): faster JSON serialization for Go\n- [go-simplejson](https://github.com/bitly/go-simplejson): a Go package to interact with arbitrary JSON\n- [Jason](https://github.com/antonholmquist/jason): Easy-to-use JSON Library for Go\n- [easyjson](https://github.com/mailru/easyjson)\n- [gabs](https://github.com/Jeffail/gabs)\n- [jsonparser](https://github.com/buger/jsonparser)\n\n\n\n- [JSON-to-Go](https://mholt.github.io/json-to-go/): instantly converts JSON into a Go type definition\n","slug":"bad-parts-about-json-serialization-in-Golang","published":1,"updated":"2025-04-27T17:04:49.541Z","comments":1,"layout":"post","photos":[],"_id":"cm9zwlzc40003fdjh7bagfwwo","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p>GolangJSON</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"1omitempty\"><a href=\"#1omitempty\" class=\"headerlink\" title=\"1omitempty\"></a>1<code>omitempty</code></h2><p>C#JSON<code>Newtonsoft.Json</code>JSONJSON<code>property annotation</code><code>ShouldSerialize method</code></p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShouldSerialize methodObsoleteSetting</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Config</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Fizz ObsoleteSetting &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">bool</span> <span class=\"title\">ShouldSerializeObsoleteSetting</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// JsonIgnoreannotationObsoleteSetting</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Config</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    [<span class=\"meta\">JsonIgnore</span>]</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Fizz ObsoleteSetting &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Bang ReplacementSetting &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Newtonsoft.Json</code>Conditional Property Serialization</p>\n<ul>\n<li><a href=\"http://www.newtonsoft.com/json/help/html/ConditionalProperties.htm\">Conditional Property Serialization</a></li>\n<li><a href=\"http://stackoverflow.com/questions/11564091/making-a-property-deserialize-but-not-serialize-with-json-net\">Making a property deserialize but not serialize with json.net</a></li>\n</ul>\n<p>Golang<code>omitempty</code>C#<a href=\"http://docs.studygolang.com/pkg/encoding/json/#Marshal\">encoding&#x2F;json package</a><code>omitempty</code></p>\n<blockquote>\n<p>Struct values encode as JSON objects. Each exported struct field becomes a member of the object unless</p>\n<ul>\n<li>the fields tag is -, or</li>\n<li>the field is empty and its tag specifies the omitempty option.</li>\n</ul>\n<p>The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero. The objects default key string is the struct field name but can be specified in the struct fields tag value. The json key in the struct fields tag value is the key name, followed by an optional comma and options. Examples:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Field is ignored by this package.</span></span><br><span class=\"line\">Field <span class=\"type\">int</span> <span class=\"string\">`json:&quot;-&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Field appears in JSON as key &quot;myName&quot;.</span></span><br><span class=\"line\">Field <span class=\"type\">int</span> <span class=\"string\">`json:&quot;myName&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Field appears in JSON as key &quot;myName&quot; and</span></span><br><span class=\"line\"><span class=\"comment\">// the field is omitted from the object if its value is empty,</span></span><br><span class=\"line\"><span class=\"comment\">// as defined above.</span></span><br><span class=\"line\">Field <span class=\"type\">int</span> <span class=\"string\">`json:&quot;myName,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Field appears in JSON as key &quot;Field&quot; (the default), but</span></span><br><span class=\"line\"><span class=\"comment\">// the field is skipped if empty.</span></span><br><span class=\"line\"><span class=\"comment\">// Note the leading comma.</span></span><br><span class=\"line\">Field <span class=\"type\">int</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br></pre></td></tr></table></figure></blockquote>\n<p>Golang<code>field</code>JSON<code>-</code><code>field</code><code>JsonIgnore</code></p>\n<p><code>omitempty</code><code>field</code><code>empty</code>JSON<code>field</code><code>Newtonsoft.Json</code><a href=\"http://stackoverflow.com/questions/6507889/how-to-ignore-a-property-in-class-if-null-using-json-net\"></a><a href=\"https://dotnetfiddle.net/VXqRnm\"></a><code>emtpty</code></p>\n<blockquote>\n<p>The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero.</p>\n</blockquote>\n<p><code>empty values</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;bytes&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> S1 <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    I1 <span class=\"type\">int</span></span><br><span class=\"line\">    I2 <span class=\"type\">int</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    F1 <span class=\"type\">float64</span></span><br><span class=\"line\">    F2 <span class=\"type\">float64</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    S1 <span class=\"type\">string</span></span><br><span class=\"line\">    S2 <span class=\"type\">string</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    B1 <span class=\"type\">bool</span></span><br><span class=\"line\">    B2 <span class=\"type\">bool</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Slice1 []<span class=\"type\">int</span></span><br><span class=\"line\">    Slice2 []<span class=\"type\">int</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    Slice3 []<span class=\"type\">int</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Map1 <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span></span><br><span class=\"line\">    Map2 <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    Map3 <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    O1 <span class=\"keyword\">interface</span>&#123;&#125;</span><br><span class=\"line\">    O2 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O3 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O4 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O5 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O6 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O7 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O8 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    P1 *<span class=\"type\">int</span></span><br><span class=\"line\">    P2 *<span class=\"type\">int</span>               <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P3 *<span class=\"type\">int</span>               <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P4 *<span class=\"type\">float64</span>           <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P5 *<span class=\"type\">string</span>            <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P6 *<span class=\"type\">bool</span>              <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P7 *[]<span class=\"type\">int</span>             <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P8 *<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    p3 := <span class=\"number\">0</span></span><br><span class=\"line\">    p4 := <span class=\"type\">float64</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">    p5 := <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    p6 := <span class=\"literal\">false</span></span><br><span class=\"line\">    p7 := []<span class=\"type\">int</span>&#123;&#125;</span><br><span class=\"line\">    p8 := <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    s1 := S1&#123;</span><br><span class=\"line\">        I1: <span class=\"number\">0</span>,</span><br><span class=\"line\">        I2: <span class=\"number\">0</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">        F1: <span class=\"number\">0</span>,</span><br><span class=\"line\">        F2: <span class=\"number\">0</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">        S1: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">        S2: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">        B1: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        B2: <span class=\"literal\">false</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">        Slice1: []<span class=\"type\">int</span>&#123;&#125;,</span><br><span class=\"line\">        Slice2: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        Slice3: []<span class=\"type\">int</span>&#123;&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        Map1: <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span>&#123;&#125;,</span><br><span class=\"line\">        Map2: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        Map3: <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span>&#123;&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        O1: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        O2: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        O3: <span class=\"type\">int</span>(<span class=\"number\">0</span>),</span><br><span class=\"line\">        O4: <span class=\"type\">float64</span>(<span class=\"number\">0</span>),</span><br><span class=\"line\">        O5: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">        O6: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        O7: []<span class=\"type\">int</span>&#123;&#125;,</span><br><span class=\"line\">        O8: <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span>&#123;&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        P1: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        P2: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        P3: &amp;p3,</span><br><span class=\"line\">        P4: &amp;p4,</span><br><span class=\"line\">        P5: &amp;p5,</span><br><span class=\"line\">        P6: &amp;p6,</span><br><span class=\"line\">        P7: &amp;p7,</span><br><span class=\"line\">        P8: &amp;p8,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    b, err := json.Marshal(s1)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        log.Printf(<span class=\"string\">&quot;marshal error: %v&quot;</span>, err)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> out bytes.Buffer</span><br><span class=\"line\">    json.Indent(&amp;out, b, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;\\t&quot;</span>)</span><br><span class=\"line\">    out.WriteTo(os.Stdout)</span><br><span class=\"line\">    <span class=\"comment\">//Output:</span></span><br><span class=\"line\">    <span class=\"comment\">//&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;I1&quot;: 0,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;F1&quot;: 0,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;S1&quot;: &quot;&quot;,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;B1&quot;: false,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;Slice1&quot;: [],</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;Map1&quot;: &#123;&#125;,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O1&quot;: null,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O3&quot;: 0,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O4&quot;: 0,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O5&quot;: &quot;&quot;,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O6&quot;: false,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O7&quot;: [],</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O8&quot;: &#123;&#125;,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;P1&quot;: null,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;P2&quot;: 0</span></span><br><span class=\"line\">    <span class=\"comment\">//&#125;%</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/6y_m27r8EO\"></a></em></p>\n<p><code>empty value</code></p>\n<p>AppRestful APIResponse<code>User</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    ID        <span class=\"type\">int</span> <span class=\"string\">`json:&quot;id&quot;`</span>                  <span class=\"comment\">// id</span></span><br><span class=\"line\">    <span class=\"comment\">// field</span></span><br><span class=\"line\">    FansCount <span class=\"type\">int</span> <span class=\"string\">`json:&quot;fansCount,omitempty&quot;`</span> <span class=\"comment\">// </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>AppRestful APIResponse</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;id&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1000386</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ResponseUser<code>fansCount</code><code>fansCount</code><code>int</code>0<code>User</code><code>fansCount</code><strong></strong><strong></strong></p>\n<p><strong></strong><strong></strong><code>User</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    ID        <span class=\"type\">int</span>  <span class=\"string\">`json:&quot;id&quot;`</span>                  <span class=\"comment\">// id</span></span><br><span class=\"line\">    <span class=\"comment\">// field</span></span><br><span class=\"line\">    FansCount *<span class=\"type\">int</span> <span class=\"string\">`json:&quot;fansCount,omitempty&quot;`</span> <span class=\"comment\">// </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>FansCount</code><code>nil</code>0</p>\n<p><code>FansCount</code><code>FansCount</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// FansCountint</span></span><br><span class=\"line\">user := dataAccess.GetUserInfo(userId)</span><br><span class=\"line\">user.FansCount = dataAccess.GetFansCount(userId)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// FansCount*int</span></span><br><span class=\"line\">user := dataAccess.GetUserInfo(userId)</span><br><span class=\"line\">fansCount := dataAccess.GetFansCount(userId)</span><br><span class=\"line\">user.FansCount = &amp;fansCount</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2JSONinterface-Number\"><a href=\"#2JSONinterface-Number\" class=\"headerlink\" title=\"2JSONinterface{}Number\"></a>2JSONinterface{}Number</h2><p><a href=\"http://json.org/\">JSON</a></p>\n<p><img src=\"https://www.json.org/img/value.png\"></p>\n<p>JSON:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ethancai&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;fansCount&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">9223372036854775807</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Name      <span class=\"type\">string</span></span><br><span class=\"line\">    FansCount <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> jsonStream = <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">        &#123;&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807&#125;</span></span><br><span class=\"line\"><span class=\"string\">    `</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> user User  <span class=\"comment\">// User</span></span><br><span class=\"line\">    err := json.Unmarshal([]<span class=\"type\">byte</span>(jsonStream), &amp;user)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, user)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">//  &#123;Name:ethancai FansCount:9223372036854775807&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/203egccrea\"></a></em></p>\n<p>JSON<code>float64</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;reflect&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> jsonStream = <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">        &#123;&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807&#125;</span></span><br><span class=\"line\"><span class=\"string\">    `</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> user <span class=\"keyword\">interface</span>&#123;&#125;  <span class=\"comment\">// </span></span><br><span class=\"line\">    err := json.Unmarshal([]<span class=\"type\">byte</span>(jsonStream), &amp;user)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    m := user.(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    fansCount := m[<span class=\"string\">&quot;fansCount&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, reflect.TypeOf(fansCount).Name())</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, fansCount.(<span class=\"type\">float64</span>))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">// \tfloat64</span></span><br><span class=\"line\"><span class=\"comment\">//  \t9.223372036854776e+18</span></span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/l4GzgA4WDA\"></a></em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Name      <span class=\"type\">string</span></span><br><span class=\"line\">    FansCount <span class=\"keyword\">interface</span>&#123;&#125;  <span class=\"comment\">// FansCount</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> jsonStream = <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">        &#123;&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807&#125;</span></span><br><span class=\"line\"><span class=\"string\">    `</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> user User</span><br><span class=\"line\">    err := json.Unmarshal([]<span class=\"type\">byte</span>(jsonStream), &amp;user)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, user)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">// \t&#123;Name:ethancai FansCount:9.223372036854776e+18&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/SoD6SOGuCM\"></a></em></p>\n<p><code>fansCount</code><code>float64</code></p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;reflect&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;strings&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> jsonStream = <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">        &#123;&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807&#125;</span></span><br><span class=\"line\"><span class=\"string\">    `</span></span><br><span class=\"line\"></span><br><span class=\"line\">    decoder := json.NewDecoder(strings.NewReader(jsonStream))</span><br><span class=\"line\">    decoder.UseNumber()    <span class=\"comment\">// UseNumber causes the Decoder to unmarshal a number into an interface&#123;&#125; as a Number instead of as a float64.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> user <span class=\"keyword\">interface</span>&#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err := decoder.Decode(&amp;user); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    m := user.(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;)</span><br><span class=\"line\">    fansCount := m[<span class=\"string\">&quot;fansCount&quot;</span>]</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, reflect.TypeOf(fansCount).PkgPath() + <span class=\"string\">&quot;.&quot;</span> + reflect.TypeOf(fansCount).Name())</span><br><span class=\"line\"></span><br><span class=\"line\">     v, err := fansCount.(json.Number).Int64()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, v)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">// \tencoding/json.Number</span></span><br><span class=\"line\"><span class=\"comment\">// \t9223372036854775807</span></span><br></pre></td></tr></table></figure>\n<p><em><a href=\"https://play.golang.org/p/KYrFshVMFD\"></a></em></p>\n<p><code>func (*Decoder) UseNumber</code>JSON<code>float64</code><code>json.Number</code><code>json.Number</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// A Number represents a JSON number literal.</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Number <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// String returns the literal text of the number.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(n Number)</span></span> String() <span class=\"type\">string</span> &#123; <span class=\"keyword\">return</span> <span class=\"type\">string</span>(n) &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Float64 returns the number as a float64.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(n Number)</span></span> Float64() (<span class=\"type\">float64</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strconv.ParseFloat(<span class=\"type\">string</span>(n), <span class=\"number\">64</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Int64 returns the number as an int64.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(n Number)</span></span> Int64() (<span class=\"type\">int64</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strconv.ParseInt(<span class=\"type\">string</span>(n), <span class=\"number\">10</span>, <span class=\"number\">64</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>json.Number</code>JSON<code>json.Number</code><code>json.Number</code><code>float64</code><code>int64</code></p>\n<p>GolangJSON</p>\n<p>JavaScript<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Numbers_and_dates\"></a>JSONJSONJavaScript Object NotationJavaScriptDouglas CrockfordJavaScript<a href=\"http://www.infoq.com/cn/news/2010/02/qconbeijing2010-douglas\">Douglas Crockford</a></p>\n<p>C#JSONlibrary <a href=\"http://www.newtonsoft.com/json\">Json.NET</a>JSONGolang</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"><span class=\"keyword\">using</span> Newtonsoft.Json;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Program</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">string</span> json = <span class=\"string\">@&quot;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;Name&#x27;: &#x27;Ethan&#x27;,</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;FansCount&#x27;: 121211,</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;Price&#x27;: 99.99</span></span><br><span class=\"line\"><span class=\"string\">&#125;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        Product m = JsonConvert.DeserializeObject&lt;Product&gt;(json);</span><br><span class=\"line\"></span><br><span class=\"line\">        Console.WriteLine(m.FansCount);</span><br><span class=\"line\">        Console.WriteLine(m.FansCount.GetType().FullName);</span><br><span class=\"line\"></span><br><span class=\"line\">        Console.WriteLine(m.Price);</span><br><span class=\"line\">        Console.WriteLine(m.Price.GetType().FullName);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Product</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> Name</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span>;</span><br><span class=\"line\">        <span class=\"keyword\">set</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">object</span> FansCount</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span>;</span><br><span class=\"line\">        <span class=\"keyword\">set</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">object</span> Price</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span>;</span><br><span class=\"line\">        <span class=\"keyword\">set</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">//      121211</span></span><br><span class=\"line\"><span class=\"comment\">//      System.Int64</span></span><br><span class=\"line\"><span class=\"comment\">//      99.99</span></span><br><span class=\"line\"><span class=\"comment\">//      System.Double</span></span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://dotnetfiddle.net/IrlMae\"></a></em></p>\n<p><code>Json.NET</code></p>\n<h2 id=\"3\"><a href=\"#3\" class=\"headerlink\" title=\"3\"></a>3</h2><p>JSONlibrary</p>\n<p>Go</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> Product <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">        Name      <span class=\"type\">string</span></span><br><span class=\"line\">        CreatedAt time.Time</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    pdt := Product&#123;</span><br><span class=\"line\">        Name:      <span class=\"string\">&quot;Reds&quot;</span>,</span><br><span class=\"line\">        CreatedAt: time.Now(),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    b, err := json.Marshal(pdt)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    os.Stdout.Write(b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Output</span></span><br><span class=\"line\"><span class=\"comment\">//      &#123;&quot;Name&quot;:&quot;Reds&quot;,&quot;CreatedAt&quot;:&quot;2016-06-27T07:40:54.69292134+08:00&quot;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>JavaScript</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ node</span><br><span class=\"line\">&gt; var jo = &#123; name: <span class=\"string\">&quot;ethan&quot;</span>, createdAt: Date.now() &#125;;</span><br><span class=\"line\">undefined</span><br><span class=\"line\">&gt; JSON.stringify(jo)</span><br><span class=\"line\"><span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;ethan&quot;,&quot;createdAt&quot;:1466984665633&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>C#</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"><span class=\"keyword\">using</span> Newtonsoft.Json;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Program</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Product product = <span class=\"keyword\">new</span> Product();</span><br><span class=\"line\">        product.Name = <span class=\"string\">&quot;Apple&quot;</span>;</span><br><span class=\"line\">        product.CreatedAt = DateTime.Now;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">string</span> json = JsonConvert.SerializeObject(product,</span><br><span class=\"line\">                            Newtonsoft.Json.Formatting.Indented,</span><br><span class=\"line\">                            <span class=\"keyword\">new</span> JsonSerializerSettings &#123;</span><br><span class=\"line\">                                NullValueHandling = NullValueHandling.Ignore</span><br><span class=\"line\">                            &#125;);</span><br><span class=\"line\">        Console.WriteLine(json);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Product</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> Name</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span>;</span><br><span class=\"line\">        <span class=\"keyword\">set</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DateTime CreatedAt</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span>;</span><br><span class=\"line\">        <span class=\"keyword\">set</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">//      &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//        &quot;Name&quot;: &quot;Apple&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">//        &quot;CreatedAt&quot;: &quot;2016-06-26T23:46:57.3244307+00:00&quot;</span></span><br><span class=\"line\"><span class=\"comment\">//      &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>Go<code>encoding/json</code> packageC#Json.NET<a href=\"http://www.w3.org/TR/NOTE-datetime\">ISO 8601</a>JavaScript<code>Date</code>197011000JavaScript<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString\"><code>dateObj.toISOString()</code></a>ISO<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/parse\"><code>Date.parse(dateString)</code></a>ISO</p>\n<p>ISOGo<code>time.Time</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Time <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// sec gives the number of seconds elapsed since</span></span><br><span class=\"line\">    <span class=\"comment\">// January 1, year 1 00:00:00 UTC.</span></span><br><span class=\"line\">    sec <span class=\"type\">int64</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// nsec specifies a non-negative nanosecond</span></span><br><span class=\"line\">    <span class=\"comment\">// offset within the second named by Seconds.</span></span><br><span class=\"line\">    <span class=\"comment\">// It must be in the range [0, 999999999].</span></span><br><span class=\"line\">    nsec <span class=\"type\">int32</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// loc specifies the Location that should be used to</span></span><br><span class=\"line\">    <span class=\"comment\">// determine the minute, hour, month, day, and year</span></span><br><span class=\"line\">    <span class=\"comment\">// that correspond to this Time.</span></span><br><span class=\"line\">    <span class=\"comment\">// Only the zero Time has a nil Location.</span></span><br><span class=\"line\">    <span class=\"comment\">// In that case it is interpreted to mean UTC.</span></span><br><span class=\"line\">    loc *Location</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>JSON</p>\n<ul>\n<li>.NET FrameworkJSON<code>&quot;\\/Date(1343660352227+0530)\\/&quot;</code></li>\n<li>ISO</li>\n<li><code>1970-1-1 00:00:00 UTC</code><code>1970-1-1 00:00:00</code></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ul>\n<li><a href=\"http://docs.studygolang.com/pkg/encoding/json/\">package encoding&#x2F;json in Go</a></li>\n<li><a href=\"http://docs.studygolang.com/src/encoding/json/example_test.go\">http://docs.studygolang.com/src/encoding/json/example_test.go</a></li>\n<li><a href=\"https://blog.golang.org/json-and-go\">The Go Blog: JSON and Go</a></li>\n<li><a href=\"https://gobyexample.com/json\">Go by example: JSON</a></li>\n<li><a href=\"http://attilaolah.eu/2013/11/29/json-decoding-in-go/\">JSON decoding in Go</a></li>\n<li><a href=\"https://eager.io/blog/go-and-json/\">go and json</a></li>\n<li><a href=\"https://www.goinggo.net/2014/01/decode-json-documents-in-go.html\">Decode JSON Documents In Go</a></li>\n<li><a href=\"https://journal.paul.querna.org/articles/2014/03/31/ffjson-faster-json-in-go/\">ffjson: faster JSON serialization for Golang</a></li>\n<li><a href=\"http://www.slideshare.net/albertstrasheim/serialization-in-go\">Serialization in Go</a></li>\n</ul>\n<p></p>\n<ul>\n<li><a href=\"https://github.com/pquerna/ffjson\">ffjson</a>: faster JSON serialization for Go</li>\n<li><a href=\"https://github.com/bitly/go-simplejson\">go-simplejson</a>: a Go package to interact with arbitrary JSON</li>\n<li><a href=\"https://github.com/antonholmquist/jason\">Jason</a>: Easy-to-use JSON Library for Go</li>\n<li><a href=\"https://github.com/mailru/easyjson\">easyjson</a></li>\n<li><a href=\"https://github.com/Jeffail/gabs\">gabs</a></li>\n<li><a href=\"https://github.com/buger/jsonparser\">jsonparser</a></li>\n</ul>\n<p></p>\n<ul>\n<li><a href=\"https://mholt.github.io/json-to-go/\">JSON-to-Go</a>: instantly converts JSON into a Go type definition</li>\n</ul>\n","excerpt":"","more":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p>GolangJSON</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"1omitempty\"><a href=\"#1omitempty\" class=\"headerlink\" title=\"1omitempty\"></a>1<code>omitempty</code></h2><p>C#JSON<code>Newtonsoft.Json</code>JSONJSON<code>property annotation</code><code>ShouldSerialize method</code></p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ShouldSerialize methodObsoleteSetting</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Config</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Fizz ObsoleteSetting &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"built_in\">bool</span> <span class=\"title\">ShouldSerializeObsoleteSetting</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// JsonIgnoreannotationObsoleteSetting</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">Config</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    [<span class=\"meta\">JsonIgnore</span>]</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Fizz ObsoleteSetting &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Bang ReplacementSetting &#123; <span class=\"keyword\">get</span>; <span class=\"keyword\">set</span>; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Newtonsoft.Json</code>Conditional Property Serialization</p>\n<ul>\n<li><a href=\"http://www.newtonsoft.com/json/help/html/ConditionalProperties.htm\">Conditional Property Serialization</a></li>\n<li><a href=\"http://stackoverflow.com/questions/11564091/making-a-property-deserialize-but-not-serialize-with-json-net\">Making a property deserialize but not serialize with json.net</a></li>\n</ul>\n<p>Golang<code>omitempty</code>C#<a href=\"http://docs.studygolang.com/pkg/encoding/json/#Marshal\">encoding&#x2F;json package</a><code>omitempty</code></p>\n<blockquote>\n<p>Struct values encode as JSON objects. Each exported struct field becomes a member of the object unless</p>\n<ul>\n<li>the fields tag is -, or</li>\n<li>the field is empty and its tag specifies the omitempty option.</li>\n</ul>\n<p>The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero. The objects default key string is the struct field name but can be specified in the struct fields tag value. The json key in the struct fields tag value is the key name, followed by an optional comma and options. Examples:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Field is ignored by this package.</span></span><br><span class=\"line\">Field <span class=\"type\">int</span> <span class=\"string\">`json:&quot;-&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Field appears in JSON as key &quot;myName&quot;.</span></span><br><span class=\"line\">Field <span class=\"type\">int</span> <span class=\"string\">`json:&quot;myName&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Field appears in JSON as key &quot;myName&quot; and</span></span><br><span class=\"line\"><span class=\"comment\">// the field is omitted from the object if its value is empty,</span></span><br><span class=\"line\"><span class=\"comment\">// as defined above.</span></span><br><span class=\"line\">Field <span class=\"type\">int</span> <span class=\"string\">`json:&quot;myName,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Field appears in JSON as key &quot;Field&quot; (the default), but</span></span><br><span class=\"line\"><span class=\"comment\">// the field is skipped if empty.</span></span><br><span class=\"line\"><span class=\"comment\">// Note the leading comma.</span></span><br><span class=\"line\">Field <span class=\"type\">int</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br></pre></td></tr></table></figure></blockquote>\n<p>Golang<code>field</code>JSON<code>-</code><code>field</code><code>JsonIgnore</code></p>\n<p><code>omitempty</code><code>field</code><code>empty</code>JSON<code>field</code><code>Newtonsoft.Json</code><a href=\"http://stackoverflow.com/questions/6507889/how-to-ignore-a-property-in-class-if-null-using-json-net\"></a><a href=\"https://dotnetfiddle.net/VXqRnm\"></a><code>emtpty</code></p>\n<blockquote>\n<p>The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero.</p>\n</blockquote>\n<p><code>empty values</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;bytes&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> S1 <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    I1 <span class=\"type\">int</span></span><br><span class=\"line\">    I2 <span class=\"type\">int</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    F1 <span class=\"type\">float64</span></span><br><span class=\"line\">    F2 <span class=\"type\">float64</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    S1 <span class=\"type\">string</span></span><br><span class=\"line\">    S2 <span class=\"type\">string</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    B1 <span class=\"type\">bool</span></span><br><span class=\"line\">    B2 <span class=\"type\">bool</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Slice1 []<span class=\"type\">int</span></span><br><span class=\"line\">    Slice2 []<span class=\"type\">int</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    Slice3 []<span class=\"type\">int</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Map1 <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span></span><br><span class=\"line\">    Map2 <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    Map3 <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    O1 <span class=\"keyword\">interface</span>&#123;&#125;</span><br><span class=\"line\">    O2 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O3 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O4 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O5 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O6 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O7 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    O8 <span class=\"keyword\">interface</span>&#123;&#125; <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">    P1 *<span class=\"type\">int</span></span><br><span class=\"line\">    P2 *<span class=\"type\">int</span>               <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P3 *<span class=\"type\">int</span>               <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P4 *<span class=\"type\">float64</span>           <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P5 *<span class=\"type\">string</span>            <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P6 *<span class=\"type\">bool</span>              <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P7 *[]<span class=\"type\">int</span>             <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">    P8 *<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span> <span class=\"string\">`json:&quot;,omitempty&quot;`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    p3 := <span class=\"number\">0</span></span><br><span class=\"line\">    p4 := <span class=\"type\">float64</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">    p5 := <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    p6 := <span class=\"literal\">false</span></span><br><span class=\"line\">    p7 := []<span class=\"type\">int</span>&#123;&#125;</span><br><span class=\"line\">    p8 := <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    s1 := S1&#123;</span><br><span class=\"line\">        I1: <span class=\"number\">0</span>,</span><br><span class=\"line\">        I2: <span class=\"number\">0</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">        F1: <span class=\"number\">0</span>,</span><br><span class=\"line\">        F2: <span class=\"number\">0</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">        S1: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">        S2: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">        B1: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        B2: <span class=\"literal\">false</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">        Slice1: []<span class=\"type\">int</span>&#123;&#125;,</span><br><span class=\"line\">        Slice2: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        Slice3: []<span class=\"type\">int</span>&#123;&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        Map1: <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span>&#123;&#125;,</span><br><span class=\"line\">        Map2: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        Map3: <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span>&#123;&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        O1: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        O2: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        O3: <span class=\"type\">int</span>(<span class=\"number\">0</span>),</span><br><span class=\"line\">        O4: <span class=\"type\">float64</span>(<span class=\"number\">0</span>),</span><br><span class=\"line\">        O5: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">        O6: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        O7: []<span class=\"type\">int</span>&#123;&#125;,</span><br><span class=\"line\">        O8: <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">string</span>&#123;&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        P1: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        P2: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">        P3: &amp;p3,</span><br><span class=\"line\">        P4: &amp;p4,</span><br><span class=\"line\">        P5: &amp;p5,</span><br><span class=\"line\">        P6: &amp;p6,</span><br><span class=\"line\">        P7: &amp;p7,</span><br><span class=\"line\">        P8: &amp;p8,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    b, err := json.Marshal(s1)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        log.Printf(<span class=\"string\">&quot;marshal error: %v&quot;</span>, err)</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> out bytes.Buffer</span><br><span class=\"line\">    json.Indent(&amp;out, b, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;\\t&quot;</span>)</span><br><span class=\"line\">    out.WriteTo(os.Stdout)</span><br><span class=\"line\">    <span class=\"comment\">//Output:</span></span><br><span class=\"line\">    <span class=\"comment\">//&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;I1&quot;: 0,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;F1&quot;: 0,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;S1&quot;: &quot;&quot;,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;B1&quot;: false,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;Slice1&quot;: [],</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;Map1&quot;: &#123;&#125;,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O1&quot;: null,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O3&quot;: 0,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O4&quot;: 0,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O5&quot;: &quot;&quot;,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O6&quot;: false,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O7&quot;: [],</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;O8&quot;: &#123;&#125;,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;P1&quot;: null,</span></span><br><span class=\"line\">    <span class=\"comment\">//\t&quot;P2&quot;: 0</span></span><br><span class=\"line\">    <span class=\"comment\">//&#125;%</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/6y_m27r8EO\"></a></em></p>\n<p><code>empty value</code></p>\n<p>AppRestful APIResponse<code>User</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    ID        <span class=\"type\">int</span> <span class=\"string\">`json:&quot;id&quot;`</span>                  <span class=\"comment\">// id</span></span><br><span class=\"line\">    <span class=\"comment\">// field</span></span><br><span class=\"line\">    FansCount <span class=\"type\">int</span> <span class=\"string\">`json:&quot;fansCount,omitempty&quot;`</span> <span class=\"comment\">// </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>AppRestful APIResponse</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;id&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1000386</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ResponseUser<code>fansCount</code><code>fansCount</code><code>int</code>0<code>User</code><code>fansCount</code><strong></strong><strong></strong></p>\n<p><strong></strong><strong></strong><code>User</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    ID        <span class=\"type\">int</span>  <span class=\"string\">`json:&quot;id&quot;`</span>                  <span class=\"comment\">// id</span></span><br><span class=\"line\">    <span class=\"comment\">// field</span></span><br><span class=\"line\">    FansCount *<span class=\"type\">int</span> <span class=\"string\">`json:&quot;fansCount,omitempty&quot;`</span> <span class=\"comment\">// </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>FansCount</code><code>nil</code>0</p>\n<p><code>FansCount</code><code>FansCount</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// FansCountint</span></span><br><span class=\"line\">user := dataAccess.GetUserInfo(userId)</span><br><span class=\"line\">user.FansCount = dataAccess.GetFansCount(userId)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// FansCount*int</span></span><br><span class=\"line\">user := dataAccess.GetUserInfo(userId)</span><br><span class=\"line\">fansCount := dataAccess.GetFansCount(userId)</span><br><span class=\"line\">user.FansCount = &amp;fansCount</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2JSONinterface-Number\"><a href=\"#2JSONinterface-Number\" class=\"headerlink\" title=\"2JSONinterface{}Number\"></a>2JSONinterface{}Number</h2><p><a href=\"http://json.org/\">JSON</a></p>\n<p><img src=\"https://www.json.org/img/value.png\"></p>\n<p>JSON:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ethancai&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;fansCount&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">9223372036854775807</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Name      <span class=\"type\">string</span></span><br><span class=\"line\">    FansCount <span class=\"type\">int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> jsonStream = <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">        &#123;&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807&#125;</span></span><br><span class=\"line\"><span class=\"string\">    `</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> user User  <span class=\"comment\">// User</span></span><br><span class=\"line\">    err := json.Unmarshal([]<span class=\"type\">byte</span>(jsonStream), &amp;user)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, user)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">//  &#123;Name:ethancai FansCount:9223372036854775807&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/203egccrea\"></a></em></p>\n<p>JSON<code>float64</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;reflect&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> jsonStream = <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">        &#123;&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807&#125;</span></span><br><span class=\"line\"><span class=\"string\">    `</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> user <span class=\"keyword\">interface</span>&#123;&#125;  <span class=\"comment\">// </span></span><br><span class=\"line\">    err := json.Unmarshal([]<span class=\"type\">byte</span>(jsonStream), &amp;user)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    m := user.(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    fansCount := m[<span class=\"string\">&quot;fansCount&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, reflect.TypeOf(fansCount).Name())</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, fansCount.(<span class=\"type\">float64</span>))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">// \tfloat64</span></span><br><span class=\"line\"><span class=\"comment\">//  \t9.223372036854776e+18</span></span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/l4GzgA4WDA\"></a></em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> User <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Name      <span class=\"type\">string</span></span><br><span class=\"line\">    FansCount <span class=\"keyword\">interface</span>&#123;&#125;  <span class=\"comment\">// FansCount</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> jsonStream = <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">        &#123;&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807&#125;</span></span><br><span class=\"line\"><span class=\"string\">    `</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> user User</span><br><span class=\"line\">    err := json.Unmarshal([]<span class=\"type\">byte</span>(jsonStream), &amp;user)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, user)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">// \t&#123;Name:ethancai FansCount:9.223372036854776e+18&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/SoD6SOGuCM\"></a></em></p>\n<p><code>fansCount</code><code>float64</code></p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;reflect&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;strings&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> jsonStream = <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">        &#123;&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807&#125;</span></span><br><span class=\"line\"><span class=\"string\">    `</span></span><br><span class=\"line\"></span><br><span class=\"line\">    decoder := json.NewDecoder(strings.NewReader(jsonStream))</span><br><span class=\"line\">    decoder.UseNumber()    <span class=\"comment\">// UseNumber causes the Decoder to unmarshal a number into an interface&#123;&#125; as a Number instead of as a float64.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> user <span class=\"keyword\">interface</span>&#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err := decoder.Decode(&amp;user); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    m := user.(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"keyword\">interface</span>&#123;&#125;)</span><br><span class=\"line\">    fansCount := m[<span class=\"string\">&quot;fansCount&quot;</span>]</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, reflect.TypeOf(fansCount).PkgPath() + <span class=\"string\">&quot;.&quot;</span> + reflect.TypeOf(fansCount).Name())</span><br><span class=\"line\"></span><br><span class=\"line\">     v, err := fansCount.(json.Number).Int64()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;%+v \\n&quot;</span>, v)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">// \tencoding/json.Number</span></span><br><span class=\"line\"><span class=\"comment\">// \t9223372036854775807</span></span><br></pre></td></tr></table></figure>\n<p><em><a href=\"https://play.golang.org/p/KYrFshVMFD\"></a></em></p>\n<p><code>func (*Decoder) UseNumber</code>JSON<code>float64</code><code>json.Number</code><code>json.Number</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// A Number represents a JSON number literal.</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Number <span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// String returns the literal text of the number.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(n Number)</span></span> String() <span class=\"type\">string</span> &#123; <span class=\"keyword\">return</span> <span class=\"type\">string</span>(n) &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Float64 returns the number as a float64.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(n Number)</span></span> Float64() (<span class=\"type\">float64</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strconv.ParseFloat(<span class=\"type\">string</span>(n), <span class=\"number\">64</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Int64 returns the number as an int64.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(n Number)</span></span> Int64() (<span class=\"type\">int64</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strconv.ParseInt(<span class=\"type\">string</span>(n), <span class=\"number\">10</span>, <span class=\"number\">64</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>json.Number</code>JSON<code>json.Number</code><code>json.Number</code><code>float64</code><code>int64</code></p>\n<p>GolangJSON</p>\n<p>JavaScript<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Numbers_and_dates\"></a>JSONJSONJavaScript Object NotationJavaScriptDouglas CrockfordJavaScript<a href=\"http://www.infoq.com/cn/news/2010/02/qconbeijing2010-douglas\">Douglas Crockford</a></p>\n<p>C#JSONlibrary <a href=\"http://www.newtonsoft.com/json\">Json.NET</a>JSONGolang</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"><span class=\"keyword\">using</span> Newtonsoft.Json;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Program</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">string</span> json = <span class=\"string\">@&quot;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;Name&#x27;: &#x27;Ethan&#x27;,</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;FansCount&#x27;: 121211,</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;Price&#x27;: 99.99</span></span><br><span class=\"line\"><span class=\"string\">&#125;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        Product m = JsonConvert.DeserializeObject&lt;Product&gt;(json);</span><br><span class=\"line\"></span><br><span class=\"line\">        Console.WriteLine(m.FansCount);</span><br><span class=\"line\">        Console.WriteLine(m.FansCount.GetType().FullName);</span><br><span class=\"line\"></span><br><span class=\"line\">        Console.WriteLine(m.Price);</span><br><span class=\"line\">        Console.WriteLine(m.Price.GetType().FullName);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Product</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> Name</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span>;</span><br><span class=\"line\">        <span class=\"keyword\">set</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">object</span> FansCount</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span>;</span><br><span class=\"line\">        <span class=\"keyword\">set</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">object</span> Price</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span>;</span><br><span class=\"line\">        <span class=\"keyword\">set</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">//      121211</span></span><br><span class=\"line\"><span class=\"comment\">//      System.Int64</span></span><br><span class=\"line\"><span class=\"comment\">//      99.99</span></span><br><span class=\"line\"><span class=\"comment\">//      System.Double</span></span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://dotnetfiddle.net/IrlMae\"></a></em></p>\n<p><code>Json.NET</code></p>\n<h2 id=\"3\"><a href=\"#3\" class=\"headerlink\" title=\"3\"></a>3</h2><p>JSONlibrary</p>\n<p>Go</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;os&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> Product <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">        Name      <span class=\"type\">string</span></span><br><span class=\"line\">        CreatedAt time.Time</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    pdt := Product&#123;</span><br><span class=\"line\">        Name:      <span class=\"string\">&quot;Reds&quot;</span>,</span><br><span class=\"line\">        CreatedAt: time.Now(),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    b, err := json.Marshal(pdt)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;error:&quot;</span>, err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    os.Stdout.Write(b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Output</span></span><br><span class=\"line\"><span class=\"comment\">//      &#123;&quot;Name&quot;:&quot;Reds&quot;,&quot;CreatedAt&quot;:&quot;2016-06-27T07:40:54.69292134+08:00&quot;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>JavaScript</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ node</span><br><span class=\"line\">&gt; var jo = &#123; name: <span class=\"string\">&quot;ethan&quot;</span>, createdAt: Date.now() &#125;;</span><br><span class=\"line\">undefined</span><br><span class=\"line\">&gt; JSON.stringify(jo)</span><br><span class=\"line\"><span class=\"string\">&#x27;&#123;&quot;name&quot;:&quot;ethan&quot;,&quot;createdAt&quot;:1466984665633&#125;&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>C#</p>\n<figure class=\"highlight c#\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> System;</span><br><span class=\"line\"><span class=\"keyword\">using</span> Newtonsoft.Json;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Program</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Main</span>()</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Product product = <span class=\"keyword\">new</span> Product();</span><br><span class=\"line\">        product.Name = <span class=\"string\">&quot;Apple&quot;</span>;</span><br><span class=\"line\">        product.CreatedAt = DateTime.Now;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">string</span> json = JsonConvert.SerializeObject(product,</span><br><span class=\"line\">                            Newtonsoft.Json.Formatting.Indented,</span><br><span class=\"line\">                            <span class=\"keyword\">new</span> JsonSerializerSettings &#123;</span><br><span class=\"line\">                                NullValueHandling = NullValueHandling.Ignore</span><br><span class=\"line\">                            &#125;);</span><br><span class=\"line\">        Console.WriteLine(json);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title\">Product</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">string</span> Name</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span>;</span><br><span class=\"line\">        <span class=\"keyword\">set</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DateTime CreatedAt</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">get</span>;</span><br><span class=\"line\">        <span class=\"keyword\">set</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Output:</span></span><br><span class=\"line\"><span class=\"comment\">//      &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//        &quot;Name&quot;: &quot;Apple&quot;,</span></span><br><span class=\"line\"><span class=\"comment\">//        &quot;CreatedAt&quot;: &quot;2016-06-26T23:46:57.3244307+00:00&quot;</span></span><br><span class=\"line\"><span class=\"comment\">//      &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>Go<code>encoding/json</code> packageC#Json.NET<a href=\"http://www.w3.org/TR/NOTE-datetime\">ISO 8601</a>JavaScript<code>Date</code>197011000JavaScript<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString\"><code>dateObj.toISOString()</code></a>ISO<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Date/parse\"><code>Date.parse(dateString)</code></a>ISO</p>\n<p>ISOGo<code>time.Time</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Time <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// sec gives the number of seconds elapsed since</span></span><br><span class=\"line\">    <span class=\"comment\">// January 1, year 1 00:00:00 UTC.</span></span><br><span class=\"line\">    sec <span class=\"type\">int64</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// nsec specifies a non-negative nanosecond</span></span><br><span class=\"line\">    <span class=\"comment\">// offset within the second named by Seconds.</span></span><br><span class=\"line\">    <span class=\"comment\">// It must be in the range [0, 999999999].</span></span><br><span class=\"line\">    nsec <span class=\"type\">int32</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// loc specifies the Location that should be used to</span></span><br><span class=\"line\">    <span class=\"comment\">// determine the minute, hour, month, day, and year</span></span><br><span class=\"line\">    <span class=\"comment\">// that correspond to this Time.</span></span><br><span class=\"line\">    <span class=\"comment\">// Only the zero Time has a nil Location.</span></span><br><span class=\"line\">    <span class=\"comment\">// In that case it is interpreted to mean UTC.</span></span><br><span class=\"line\">    loc *Location</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>JSON</p>\n<ul>\n<li>.NET FrameworkJSON<code>&quot;\\/Date(1343660352227+0530)\\/&quot;</code></li>\n<li>ISO</li>\n<li><code>1970-1-1 00:00:00 UTC</code><code>1970-1-1 00:00:00</code></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ul>\n<li><a href=\"http://docs.studygolang.com/pkg/encoding/json/\">package encoding&#x2F;json in Go</a></li>\n<li><a href=\"http://docs.studygolang.com/src/encoding/json/example_test.go\">http://docs.studygolang.com/src/encoding/json/example_test.go</a></li>\n<li><a href=\"https://blog.golang.org/json-and-go\">The Go Blog: JSON and Go</a></li>\n<li><a href=\"https://gobyexample.com/json\">Go by example: JSON</a></li>\n<li><a href=\"http://attilaolah.eu/2013/11/29/json-decoding-in-go/\">JSON decoding in Go</a></li>\n<li><a href=\"https://eager.io/blog/go-and-json/\">go and json</a></li>\n<li><a href=\"https://www.goinggo.net/2014/01/decode-json-documents-in-go.html\">Decode JSON Documents In Go</a></li>\n<li><a href=\"https://journal.paul.querna.org/articles/2014/03/31/ffjson-faster-json-in-go/\">ffjson: faster JSON serialization for Golang</a></li>\n<li><a href=\"http://www.slideshare.net/albertstrasheim/serialization-in-go\">Serialization in Go</a></li>\n</ul>\n<p></p>\n<ul>\n<li><a href=\"https://github.com/pquerna/ffjson\">ffjson</a>: faster JSON serialization for Go</li>\n<li><a href=\"https://github.com/bitly/go-simplejson\">go-simplejson</a>: a Go package to interact with arbitrary JSON</li>\n<li><a href=\"https://github.com/antonholmquist/jason\">Jason</a>: Easy-to-use JSON Library for Go</li>\n<li><a href=\"https://github.com/mailru/easyjson\">easyjson</a></li>\n<li><a href=\"https://github.com/Jeffail/gabs\">gabs</a></li>\n<li><a href=\"https://github.com/buger/jsonparser\">jsonparser</a></li>\n</ul>\n<p></p>\n<ul>\n<li><a href=\"https://mholt.github.io/json-to-go/\">JSON-to-Go</a>: instantly converts JSON into a Go type definition</li>\n</ul>\n"},{"title":"Golang","date":"2016-04-19T18:09:39.000Z","_content":"\n\n# \n\n<!-- TOC depthFrom:1 depthTo:2 withLinks:0 updateOnSave:1 orderedList:0 -->\n\n- \n- `dlog`\n- `dlog`\n- \n    - `panic``return error`\n    - `logger``data log`\n    - `data log`\n    - `Logger.Log`\n    - `logger``msg``buf`AWS Kinesis\n    - \n    - `Setup``TearDown`\n    - `kinesisMock`\n    - AWS Kinesis\n    - `log.Print`\n- \n- \n- \n\n<!-- /TOC -->\n\n# \n\n[](https://segmentfault.com/a/1190000002416822)Golog[dlog](https://github.com/topicai/dlog)Go\n\n> Go\n\n# `dlog`\n\n**readme**`dlog`\n\n> dlog is a Go package for distributed structure logging using Amazon AWS Kinesis/Firehose.\n\n[readme](https://github.com/topicai/dlog/blob/develop/README.md)\n\n`dlog``data log`Golang package`data log`\n\n- `status log`Bug\n- `data log``data log`\n\n\n# `dlog`\n\n- `data log``logger``logger``data log`\n- `dlog`\n    - AWS Kinesis\n- `dlog``data log``dlog``dlog`\n- AWS KinesisAPI[PutRecord](http://docs.aws.amazon.com/kinesis/latest/APIReference/API_PutRecord.html), [PutRecords](http://docs.aws.amazon.com/kinesis/latest/APIReference/API_PutRecords.html)Kinesis`data log`\n    - `PutRecords``record``500``record`1MB`request`5MB\n    - Kinesis StreamTPSstreamshardshardTPS`1000 records per second` `1MB per second`\n- \n\n\n# \n\n## `panic``return error`\n\n`panic``return error`\n\n### `panic`\n\n`panic``goroutine``panic``recover`\n\n```go\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    go func() {\n        log.Panic(\"some error before work2\")\n        fmt.Println(\"do some work2\")\n    }()\n\n    time.Sleep(time.Second)\n    fmt.Println(\"do some work1\")\n}\n```\n\n_[](https://play.golang.org/p/off1y9tBax)_\n\n`recover``goroutine``panic`\n\n```go\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    go func() {\n        defer func() {\n            if err := recover(); err != nil {\n                log.Printf(\"error: %v\", err)\n            }\n        }()\n        log.Panic(\"some error before work2\")\n        fmt.Println(\"do some work2\")\n    }()\n\n    time.Sleep(time.Second)\n    fmt.Println(\"do some work1\")\n}\n```\n\n_[](https://play.golang.org/p/RLWyb813Uw)_\n\nGo`panic``recover`Java.NET`throw``try...catch`\n\n### `return error`\n\n`return error`Go`caller`\n\n`return error``return error``panic/recover`\n\n```go\npackage main\n\nimport (\n    \"errors\"\n    \"log\"\n)\n\ntype R struct {\n}\n\nfunc f1() (error, *R) {\n    return errors.New(\"an error\"), nil\n}\n\nfunc f2() (error, *R) {\n    err, r := f1()\n    if err != nil {\n        return err, nil\n    }\n\n    return nil, r\n}\n\nfunc f3() (error, *R) {\n    err, r := f2()\n    if err != nil {\n        return err, nil\n    }\n\n    return nil, r\n}\n\nfunc main() {\n    err, _ := f3()\n    if err != nil {\n        log.Print(err)\n    }\n}\n```\n\n_[](https://play.golang.org/p/GhE5JpzZvn)_\n\n### `dlog`\n\n`panic``return error``panic``return error`\n\n`dlog``package`\n\n- `func NewLogger(example interface{}, opts *Options) (*Logger, error)`\n- `func (l *Logger) Log(msg interface{}) error`\n\n\n\n- `NewLogger`data log`NewLogger``logger``panic``return error``caller`Golang package\n- `logger.Log``Log``panic`\n    - `logger.Log``return error``msg`\n    - `logger.Log`AWS KinesisAWS Kinesis`panic``return error``logger``handler``handler`\n\n## `logger``data log`\n\n`logger``data log`\n\n- `Logger``msgType reflect.Type`\n- `NewLogger``logger``logger`\n- `Log``msg``logger`\n\n\n\n```go\n// msgTypeLogger\ntype Logger struct {\n    ...\n    msgType    reflect.Type\n    ...\n}\n\n// msgreflect.Type\nfunc msgType(msg interface{}) (reflect.Type, error) {\n    t := reflect.TypeOf(msg)\n\n    if t.Kind() == reflect.Ptr {\n        t = t.Elem()\n    }\n\n    if t.Kind() != reflect.Struct {\n        return nil, fmt.Errorf(\"dlog message must be either *struct or struct\")\n    }\n\n    return t, nil\n}\n\nfunc NewLogger(example interface{}, opts *Options) (*Logger, error) {\n    t, e := msgType(example)\n    if e != nil {\n        return nil, e\n    }\n\n    ...\n\n    l := &Logger{\n        ...\n        msgType:    t,\n        ...\n    }\n\n    ...\n    return l, nil\n}\n\nfunc (l *Logger) Log(msg interface{}) error {\n    if t, e := msgType(msg); e != nil {\n        return e\n    } else if !t.AssignableTo(l.msgType) {\n        return fmt.Errorf(\"parameter (%+v) not assignable to %v\", msg, l.msgType)\n    }\n\n    ...\n}\n```\n\n`Log``AssignableTo``msg``struct``AssignableTo``True`\n\n```go\npackage main\n\nimport (\n    \"log\"\n    \"reflect\"\n)\n\nfunc main() {\n    type Fn func(int) int\n    id := func(x int) int {\n        return x\n    }\n    var zeroFn Fn\n    log.Println(reflect.TypeOf(id).AssignableTo(reflect.TypeOf(zeroFn)))\n\n    type MyInt int\n    mi := 1\n    log.Println(reflect.TypeOf(2).AssignableTo(reflect.TypeOf(mi)))\n\n    type S1 struct {\n        name string\n    }\n    type S2 S1\n\n    s1 := S1{\n        name: \"ethan\",\n    }\n    s2 := S2{\n        name: \"ethan\",\n    }\n    // s2 = s1\t// if uncomment this line, will report \"cannot use s1 (type S1) as type S2 in assignment\" when compile\n    log.Println(reflect.TypeOf(s1).AssignableTo(reflect.TypeOf(s2)))\n}\n```\n\n_[](https://play.golang.org/p/eDmzxW-ayk)_\n\n## `data log`\n\n`buffer``message``buffer`AWS Kinesis`buffer`(goroutine)`buffer`\n\n- `buffer`\n- `channel``buffer`\n\nJava.NETCSP(Communicating Sequential Processes)\n\n{% asset_img channel.png CSP Model %}\n\n`dlog``Log``msg``buffer``channel``goroutine``channel``buf := make([][]byte, 0)``buf`AWS Kinesis`flush`AWS Kinesis`goroutine``buf``buf`\n\n<!--\ndigraph G {\n    fontname=\"Microsoft YaHei\";\n    fontsize=10;\n    rankdir = LR;\n\n    \"buffer channel\" [shape=box];\n\n    \"Logger.Log goroutine 1\" -> \"buffer channel\";\n    \"Logger.Log goroutine 2\" -> \"buffer channel\";\n    \"Logger.Log goroutine 3\" -> \"buffer channel\";\n    \"buffer channel\" -> \"sync goroutine\";\n    \"sync goroutine\" -> \"AWS Kinesis Stream\";\n}\n-->\n\n<!-- ![Thread Model](http://g.gravizo.com/g?digraph%20G%20%7B%0A%20%20%20%20fontname%3D%22Microsoft%20YaHei%22%3B%0A%20%20%20%20fontsize%3D10%3B%0A%20%20%20%20rankdir%20%3D%20LR%3B%0A%0A%20%20%20%20%22buffer%20channel%22%20%5Bshape%3Dbox%5D%3B%0A%0A%20%20%20%20%22Logger.Log%20goroutine%201%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22Logger.Log%20goroutine%202%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22Logger.Log%20goroutine%203%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22buffer%20channel%22%20-%3E%20%22sync%20goroutine%22%3B%0A%20%20%20%20%22sync%20goroutine%22%20-%3E%20%22AWS%20Kinesis%20Stream%22%3B%0A%20%7D) -->\n\n{% asset_img use_channel.png Channel %}\n\n\n\n```go\nfunc NewLogger(example interface{}, opts *Options) (*Logger, error) {\n    ...\n\n    go l.sync()    // sync goroutine\n    return l, nil\n}\n\nfunc (l *Logger) Log(msg interface{}) error {\n    ...\n\n    en := encode(msg)       // msg\n    ...\n        select {\n        case l.buffer <- en:    // buffer channelmsg\n        ...\n        }\n    ...\n    return nil\n}\n\nfunc (l *Logger) sync() {\n    ...\n\n    buf := make([][]byte, 0) // buffer channel\n    bufSize := 0\n\n    for {\n        select {\n        case msg := <-l.buffer:\n            if bufSize+len(msg)+partitionKeySize >= maxBatchSize {  // buf\n                l.flush(&buf, &bufSize)                             // AWS Kinesis\n            }\n\n            buf = append(buf, msg)                                  // buffer channelbuf\n            bufSize += len(msg) + partitionKeySize\n\n        ...\n    }\n}\n```\n\n## `Logger.Log`\n\nIO`caller`\n\n`Logger.Log`Go`channel`\n\n```go\nfunc (l *Logger) Log(msg interface{}) error {\n    ...\n\n    var timeout <-chan time.Time\n    if l.WriteTimeout > 0 {\n        timeout = time.After(l.WriteTimeout)    // l.WriteTimeout\n    }\n\n    ...\n        select {\n        case l.buffer <- en:\n        case <-timeout: // timeoutcase\n            return fmt.Errorf(\"dlog writes %+v timeout after %v\", msg, l.WriteTimeout)\n        }\n    ...\n    return nil\n}\n```\n\nJava.NETGo\n\n- C#\n    - [Implementing .Net method timeout](http://weblogs.asp.net/israelio/159985)\n    - [How to implement Task Async for a timer in C#?](http://stackoverflow.com/questions/18646650/how-to-implement-task-async-for-a-timer-in-c)\n    - [Implementing a timeout in c#](http://stackoverflow.com/questions/10143980/implementing-a-timeout-in-c-sharp)\n- Java\n    - [How to implement timeout using threads](http://www.coderanch.com/t/232213/threads/java/implement-timeout-threads)\n    - [How to timeout a thread](http://stackoverflow.com/questions/2275443/how-to-timeout-a-thread)\n\n## `logger``msg``buf`AWS Kinesis\n\n`dlog``Logger.sync()``buf`AWS Kinesis\n\n```go\nfunc (l *Logger) sync() {\n    if l.SyncPeriod <= 0 {\n        l.SyncPeriod = time.Second\n    }\n    ticker := time.NewTicker(l.SyncPeriod)  // l.SyncPeriodticker\n\n    buf := make([][]byte, 0)\n    bufSize := 0\n\n    for {  // sync goroutine\n        select {\n        case msg := <-l.buffer:\n            ...\n\n        case <-ticker.C: // ticker.C<-chan Timel.SyncPeriodcase\n            if bufSize > 0 {\n                l.flush(&buf, &bufSize)\n            }\n        }\n    }\n}\n```\n\n`ticker``dlog``msg``buf``l.SyncPeriod`AWS Kinesis\n\n\n\n## \n\nGoPackage `expvar``expvar`HTTP`/debug/vars`JSON`expvar`\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"expvar\"\n    \"fmt\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\n// Stats is used to collect runtime metrics\ntype Stats struct {\n    sync.Mutex\n    TotalHit  int\n    ErrorNums int\n}\n\nfunc (s *Stats) IncreaseTotalHit(i int) {\n    s.Lock()\n    defer s.Unlock()\n\n    s.TotalHit += i\n}\n\nfunc (s *Stats) IncreaseErrorNums(i int) {\n    s.Lock()\n    defer s.Unlock()\n\n    s.ErrorNums += i\n}\n\nfunc (s *Stats) String() string {\n    s.Lock()\n    defer s.Unlock()\n\n    b, err := json.Marshal(*s)\n    if err != nil {\n        return \"{}\"\n    } else {\n        return string(b)\n    }\n}\n\nvar (\n    stats *Stats\n    hits  *expvar.Map\n)\n\nfunc init() {\n\n    expvar.Publish(\"now\", expvar.Func(func() interface{} {\n        return time.Now().Format(\"\\\"2006-01-02 15:04:05\\\"\")\n    }))\n\n    stats = &Stats{}\n    expvar.Publish(\"stats\", stats)\n\n    hits = expvar.NewMap(\"hits\").Init()\n}\n\nfunc homeHandler(w http.ResponseWriter, r *http.Request) {\n    p := r.URL.Path[1:]\n    hits.Add(p, 1)\n    stats.IncreaseTotalHit(1)\n    fmt.Fprintf(w, \"Hey! I love %s! hits: %v\\n\", p, hits.Get(p))\n}\n\nfunc errHandler(w http.ResponseWriter, r *http.Request) {\n    stats.IncreaseErrorNums(1)\n    fmt.Fprintf(w, \"Error Nums: %v\\n\", stats.ErrorNums)\n}\n\nfunc main() {\n    http.HandleFunc(\"/err\", errHandler)\n    http.HandleFunc(\"/\", homeHandler)\n    http.ListenAndServe(\":8080\", nil)\n}\n```\n\n\n\n- `go run expvarexample.go`\n- `http://localhost:8080/ethan`\n- `http://localhost:8080/err`\n- `http://localhost:8080/debug/vars`\n```json\n{\n    \"cmdline\": [\"/var/folders/jf/65ft181j33j_d75ktgv67bsc0000gn/T/go-build467453980/command-line-arguments/_obj/exe/expvarsample\"],\n    \"hits\": {\n        \"ethan\": 1,\n        \"favicon.ico\": 2\n    },\n    \"memstats\": { ... },\n    \"now\": \"\\\"2016-04-19 20:17:40\\\"\",\n    \"stats\": {\n        \"TotalHit\":3,\n        \"ErrorNums\":1\n    }\n}\n```\n\n[expvarmon](https://github.com/divan/expvarmon)`expvar`\n\n- `go get github.com/divan/expvarmon`\n- `expvarmon -ports=\"8080\" -vars=\"hits.ethan,stats.TotalHit,stats.ErrorNums,now\"`\n- \n{% asset_img expvarmon_screen.png expvarmon screen %}\n\n`dlog``expvar``dlog`\n\n- `writtenRecords`: AWS Kinesis`msg`\n- `writtenBatches`: AWS KinesisAPI\n- `failedRecords`: AWS Kinesis`msg`\n- `tooBigMesssages`: (partitionKeySize1MB)`msg`\n\n\n\n## `Setup``TearDown`\n\nGo****`go test``testing` package[](http://docs.studygolang.com/doc/code.html#Testing)Go\n\n```go\n//$GOPATH/src/github.com/user/stringutil/reverse_test.go\npackage stringutil\n\nimport \"testing\"\n\nfunc TestReverse(t *testing.T) {\n    cases := []struct {\n        in, want string\n    }{\n        {\"Hello, world\", \"dlrow ,olleH\"},\n        {\"Hello, \", \" ,olleH\"},\n        {\"\", \"\"},\n    }\n    for _, c := range cases {\n        got := Reverse(c.in)\n        if got != c.want {\n            t.Errorf(\"Reverse(%q) == %q, want %q\", c.in, got, c.want)\n        }\n    }\n}\n```\n\n\n\n```go\n$ go test github.com/user/stringutil\nok  \tgithub.com/user/stringutil 0.165s\n```\n\nIaaS[testify/suite](https://github.com/stretchr/testify/suite) package[testify/suite](https://github.com/stretchr/testify/suite)`struct``setup`()/`teardown`()`go test`\n\n[testify/suite](https://github.com/stretchr/testify/suite)\n\n```go\npackage suite\n\nimport (\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n)\n\ntype SuiteTester struct {\n    // Include our basic suite logic.\n    Suite\n\n    // Other properties\n    propertyN string\n}\n\n// The SetupSuite method will be run by testify once, at the very\n// start of the testing suite, before any tests are run.\nfunc (suite *SuiteTester) SetupSuite() {\n    // ...\n}\n\n// The TearDownSuite method will be run by testify once, at the very\n// end of the testing suite, after all tests have been run.\nfunc (suite *SuiteTester) TearDownSuite() {\n    // ...\n}\n\n// The SetupTest method will be run before every test in the suite.\nfunc (suite *SuiteTester) SetupTest() {\n    // ...\n}\n\n// The TearDownTest method will be run after every test in the suite.\nfunc (suite *SuiteTester) TearDownTest() {\n    // ...\n}\n\n// a test method\nfunc (suite *SuiteTester) TestOne() {\n    // ...\n}\n\n// another test method\nfunc (suite *SuiteTester) TestTwo() {\n    // ...\n}\n\n// TestRunSuite will be run by the 'go test' command, so within it, we\n// can run our suite using the Run(*testing.T, TestingSuite) function.\nfunc TestRunSuite(t *testing.T) {\n    suiteTester := new(SuiteTester)\n    Run(t, suiteTester)\n}\n```\n\n`dlog``Logger.Log`\n\n```go\npackage dlog\n\n//...\n\ntype WriteLogSuiteTester struct {\n    suite.Suite\n\n    options     *Options\n    seachLogger *Logger\n    clickLogger *Logger\n    streamNames []string // save the created AWS Kinesis Streams, which will be removed in TearDownSuite()\n}\n\n// The SetupSuite method will be run by testify once, at the very\n// start of the testing suite, before any tests are run.\nfunc (s *WriteLogSuiteTester) SetupSuite() {\n\n    //...\n\n    // create stream 1\n    err = s.seachLogger.kinesis.CreateStream(s.seachLogger.streamName, testingShardCount)\n    s.Nil(err)\n\n    // create stream 2\n    err = s.clickLogger.kinesis.CreateStream(s.clickLogger.streamName, testingShardCount)\n    s.Nil(err)\n\n    s.streamNames = []string{s.seachLogger.streamName, s.clickLogger.streamName}\n\n    for { // waiting created stream's status to be active\n        time.Sleep(1 * time.Second)\n        resp1, err1 := s.seachLogger.kinesis.DescribeStream(s.seachLogger.streamName)\n        s.Nil(err1)\n\n        resp2, err2 := s.seachLogger.kinesis.DescribeStream(s.clickLogger.streamName)\n        s.Nil(err2)\n\n        status1 := strings.ToLower(string(resp1.StreamStatus))\n        status2 := strings.ToLower(string(resp2.StreamStatus))\n        if status1 == \"active\" && status2 == \"active\" {\n            break\n        }\n    }\n}\n\n// The TearDownSuite method will be run by testify once, at the very\n// end of the testing suite, after all tests have been run.\nfunc (s *WriteLogSuiteTester) TearDownSuite() {\n    if s.streamNames == nil || len(s.streamNames) == 0 {\n        return\n    }\n\n    for _, streamName := range s.streamNames {\n        err := s.seachLogger.kinesis.DeleteStream(streamName)\n        s.Nil(err)\n    }\n}\n\nfunc (s *WriteLogSuiteTester) TestWriteLog() {\n    defer func() { // Recover if panicking to make sure TearDownSuite will be executed\n        if r := recover(); r != nil {\n            s.Fail(fmt.Sprint(r))\n        }\n    }()\n\n    //...\n}\n\nfunc TestRunWriteLogSuite(t *testing.T) {\n    suiteTester := new(WriteLogSuiteTester)\n    suite.Run(t, suiteTester)\n}\n```\n\n\n\n- \n- \n    - \n    - \n    - \n\n## `kinesisMock`\n\nMock\n\n`dlog``KinesisInterface`:\n\n```go\ntype KinesisInterface interface {\n    PutRecords(streamName string, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err error)\n    CreateStream(name string, shardCount int) error\n    DescribeStream(name string) (resp *kinesis.StreamDescription, err error)\n    DeleteStream(name string) error\n}\n```\n\n`KinesisInterface``dlog`[github.com/AdRoll/goamz/kinesis/kinesis](https://github.com/AdRoll/goamz/blob/master/kinesis/kinesis.go)Go`interface`****[github.com/AdRoll/goamz/kinesis/kinesis](https://github.com/AdRoll/goamz/blob/master/kinesis/kinesis.go)`KinesisInterface``kinesisMock``KinesisInterface`\n\n```go\ntype kinesisMock struct {\n    // Mapping from steam name to batches of batches\n    storage map[string][][]kinesis.PutRecordsRequestEntry\n\n    // simulate lantency that sync to Kinesis\n    putRecordLatency time.Duration\n\n    // created streams' names\n    streamNames []string\n\n    // lock to solve concurrent call\n    lock sync.RWMutex\n}\n\nfunc newKinesisMock(putRecordsLatency time.Duration) *kinesisMock {\n    return &kinesisMock{\n        storage:          make(map[string][][]kinesis.PutRecordsRequestEntry),\n        putRecordLatency: putRecordsLatency,\n        streamNames:      make([]string, 0),\n    }\n}\n\nfunc (mock *kinesisMock) PutRecords(streamName string, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err error) {\n    // ...\n}\n\nfunc (mock *kinesisMock) CreateStream(name string, shardCount int) error {\n    // ...\n}\n\nfunc (mock *kinesisMock) DescribeStream(name string) (resp *kinesis.StreamDescription, err error) {\n    // ...\n}\n\nfunc (mock *kinesisMock) DeleteStream(name string) error {\n    // ...\n}\n```\n\n`kinesis``KinesisInterface`\n\n```go\ntype Logger struct {\n    //...\n    kinesis    KinesisInterface\n    //...\n}\n```\n\n`Logger``kinesisMock``kinesis`\n\n```go\nfunc TestLoggingToMockKinesis(t *testing.T) {\n    assert := assert.New(t)\n\n    l, e := NewLogger(&impression{}, &Options{\n        // ...\n        UseMockKinesis: true,\n        MockKinesis:    newKinesisMock(0),\n    })\n\n    // ...\n}\n```\n\n## AWS Kinesis\n\n`kinesisMock``kinesis`\n\n`kinesisMock``putRecordLatency``PutRecords`\n\n```go\ntype kinesisMock struct {\n    // ...\n\n    // simulate lantency that sync to Kinesis\n    putRecordLatency time.Duration\n\n    // ...\n}\n\nfunc (mock *kinesisMock) PutRecords(streamName string, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err error) {\n    //...\n\n    time.Sleep(mock.putRecordLatency) // \n\n    //...\n}\n```\n\n`kinesis``brokenKinesisMock`\n\n```go\ntype brokenKinesisMock struct {\n    *kinesisMock\n}\n\nfunc newBrokenKinesisMock() *brokenKinesisMock {\n    return &brokenKinesisMock{\n        kinesisMock: newKinesisMock(0),\n    }\n}\n\nfunc (mock *brokenKinesisMock) PutRecords(streamName string, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err error) {\n    return nil, fmt.Errorf(\"Kinesis is broken\")\n}\n```\n\n`kinesisMock``brokenKinesisMock``struct``brokenKinesisMock``kinesisMock``KinesisInterface`\n\n## `log.Print`\n\n\n\n- `log.Print``stdout`\n- `go test``-v``log.Print``log.Print`\n\n\n# \n\n- [AWS Kinesis API - CreateStream](http://docs.aws.amazon.com/kinesis/latest/APIReference/API_CreateStream.html)Stream10+Stream\n- [github.com/AdRoll/goamz/aws/regions.go](https://github.com/AdRoll/goamz/blob/master/aws/regions.go)AWS KinesisURLAWS Kinesis\n- Travis CIKill1CI10\n\n\n# \n\n- \n- Kinesis`dlog`\n\n\n# \n\n- [Effective Go](http://docs.studygolang.com/doc/effective_go.html)\n- [Amazon Kinesis Documentation](https://aws.amazon.com/cn/documentation/kinesis/)\n- [Advanced Go Concurrency Patterns](http://blog.golang.org/advanced-go-concurrency-patterns)\n- [hystrix-go](https://github.com/afex/hystrix-go)\n\n\n# \n\n[](http://www.augmn.com)(ethancai@qq.com)\n\n{% asset_img 2016-04-21_07-12-24.png 1 %}\n\n{% asset_img 2016-04-21_07-12-40.png 2 %}\n\n** / Backend Engineer**\n\n\n\n- \n- micro-service\n- \n- Code Review\n\n\n\n- \n- GoNode.jsC++Python\n- RESTfulRPC\n- web serviceweb app\n- MysqlRedisMongoDB\n- \n- \n- \n- 53\n\n\n** / Senior Ops Engineer**\n\n\n\n- AWS\n- \n- \n- \n- 7*24\n- IT\n\n\n\n- Linux/UnixLinux\n- TCP/IPHTTP\n- NginxDNSNTP\n- ShellPythonPerl Ruby\n- Linuxgrepawksedtmuxvim\n- MySQL\n- \n-  2 AWS\n- DevOps\n- \n- \n- \n- \n","source":"_posts/2016-04-20-experiences-about-develop-dlog.md","raw":"---\ntitle: Golang\ncategories:\n  - \ntags:\n  - golang\ndate: 2016-04-20 02:09:39\n---\n\n\n# \n\n<!-- TOC depthFrom:1 depthTo:2 withLinks:0 updateOnSave:1 orderedList:0 -->\n\n- \n- `dlog`\n- `dlog`\n- \n    - `panic``return error`\n    - `logger``data log`\n    - `data log`\n    - `Logger.Log`\n    - `logger``msg``buf`AWS Kinesis\n    - \n    - `Setup``TearDown`\n    - `kinesisMock`\n    - AWS Kinesis\n    - `log.Print`\n- \n- \n- \n\n<!-- /TOC -->\n\n# \n\n[](https://segmentfault.com/a/1190000002416822)Golog[dlog](https://github.com/topicai/dlog)Go\n\n> Go\n\n# `dlog`\n\n**readme**`dlog`\n\n> dlog is a Go package for distributed structure logging using Amazon AWS Kinesis/Firehose.\n\n[readme](https://github.com/topicai/dlog/blob/develop/README.md)\n\n`dlog``data log`Golang package`data log`\n\n- `status log`Bug\n- `data log``data log`\n\n\n# `dlog`\n\n- `data log``logger``logger``data log`\n- `dlog`\n    - AWS Kinesis\n- `dlog``data log``dlog``dlog`\n- AWS KinesisAPI[PutRecord](http://docs.aws.amazon.com/kinesis/latest/APIReference/API_PutRecord.html), [PutRecords](http://docs.aws.amazon.com/kinesis/latest/APIReference/API_PutRecords.html)Kinesis`data log`\n    - `PutRecords``record``500``record`1MB`request`5MB\n    - Kinesis StreamTPSstreamshardshardTPS`1000 records per second` `1MB per second`\n- \n\n\n# \n\n## `panic``return error`\n\n`panic``return error`\n\n### `panic`\n\n`panic``goroutine``panic``recover`\n\n```go\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    go func() {\n        log.Panic(\"some error before work2\")\n        fmt.Println(\"do some work2\")\n    }()\n\n    time.Sleep(time.Second)\n    fmt.Println(\"do some work1\")\n}\n```\n\n_[](https://play.golang.org/p/off1y9tBax)_\n\n`recover``goroutine``panic`\n\n```go\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    go func() {\n        defer func() {\n            if err := recover(); err != nil {\n                log.Printf(\"error: %v\", err)\n            }\n        }()\n        log.Panic(\"some error before work2\")\n        fmt.Println(\"do some work2\")\n    }()\n\n    time.Sleep(time.Second)\n    fmt.Println(\"do some work1\")\n}\n```\n\n_[](https://play.golang.org/p/RLWyb813Uw)_\n\nGo`panic``recover`Java.NET`throw``try...catch`\n\n### `return error`\n\n`return error`Go`caller`\n\n`return error``return error``panic/recover`\n\n```go\npackage main\n\nimport (\n    \"errors\"\n    \"log\"\n)\n\ntype R struct {\n}\n\nfunc f1() (error, *R) {\n    return errors.New(\"an error\"), nil\n}\n\nfunc f2() (error, *R) {\n    err, r := f1()\n    if err != nil {\n        return err, nil\n    }\n\n    return nil, r\n}\n\nfunc f3() (error, *R) {\n    err, r := f2()\n    if err != nil {\n        return err, nil\n    }\n\n    return nil, r\n}\n\nfunc main() {\n    err, _ := f3()\n    if err != nil {\n        log.Print(err)\n    }\n}\n```\n\n_[](https://play.golang.org/p/GhE5JpzZvn)_\n\n### `dlog`\n\n`panic``return error``panic``return error`\n\n`dlog``package`\n\n- `func NewLogger(example interface{}, opts *Options) (*Logger, error)`\n- `func (l *Logger) Log(msg interface{}) error`\n\n\n\n- `NewLogger`data log`NewLogger``logger``panic``return error``caller`Golang package\n- `logger.Log``Log``panic`\n    - `logger.Log``return error``msg`\n    - `logger.Log`AWS KinesisAWS Kinesis`panic``return error``logger``handler``handler`\n\n## `logger``data log`\n\n`logger``data log`\n\n- `Logger``msgType reflect.Type`\n- `NewLogger``logger``logger`\n- `Log``msg``logger`\n\n\n\n```go\n// msgTypeLogger\ntype Logger struct {\n    ...\n    msgType    reflect.Type\n    ...\n}\n\n// msgreflect.Type\nfunc msgType(msg interface{}) (reflect.Type, error) {\n    t := reflect.TypeOf(msg)\n\n    if t.Kind() == reflect.Ptr {\n        t = t.Elem()\n    }\n\n    if t.Kind() != reflect.Struct {\n        return nil, fmt.Errorf(\"dlog message must be either *struct or struct\")\n    }\n\n    return t, nil\n}\n\nfunc NewLogger(example interface{}, opts *Options) (*Logger, error) {\n    t, e := msgType(example)\n    if e != nil {\n        return nil, e\n    }\n\n    ...\n\n    l := &Logger{\n        ...\n        msgType:    t,\n        ...\n    }\n\n    ...\n    return l, nil\n}\n\nfunc (l *Logger) Log(msg interface{}) error {\n    if t, e := msgType(msg); e != nil {\n        return e\n    } else if !t.AssignableTo(l.msgType) {\n        return fmt.Errorf(\"parameter (%+v) not assignable to %v\", msg, l.msgType)\n    }\n\n    ...\n}\n```\n\n`Log``AssignableTo``msg``struct``AssignableTo``True`\n\n```go\npackage main\n\nimport (\n    \"log\"\n    \"reflect\"\n)\n\nfunc main() {\n    type Fn func(int) int\n    id := func(x int) int {\n        return x\n    }\n    var zeroFn Fn\n    log.Println(reflect.TypeOf(id).AssignableTo(reflect.TypeOf(zeroFn)))\n\n    type MyInt int\n    mi := 1\n    log.Println(reflect.TypeOf(2).AssignableTo(reflect.TypeOf(mi)))\n\n    type S1 struct {\n        name string\n    }\n    type S2 S1\n\n    s1 := S1{\n        name: \"ethan\",\n    }\n    s2 := S2{\n        name: \"ethan\",\n    }\n    // s2 = s1\t// if uncomment this line, will report \"cannot use s1 (type S1) as type S2 in assignment\" when compile\n    log.Println(reflect.TypeOf(s1).AssignableTo(reflect.TypeOf(s2)))\n}\n```\n\n_[](https://play.golang.org/p/eDmzxW-ayk)_\n\n## `data log`\n\n`buffer``message``buffer`AWS Kinesis`buffer`(goroutine)`buffer`\n\n- `buffer`\n- `channel``buffer`\n\nJava.NETCSP(Communicating Sequential Processes)\n\n{% asset_img channel.png CSP Model %}\n\n`dlog``Log``msg``buffer``channel``goroutine``channel``buf := make([][]byte, 0)``buf`AWS Kinesis`flush`AWS Kinesis`goroutine``buf``buf`\n\n<!--\ndigraph G {\n    fontname=\"Microsoft YaHei\";\n    fontsize=10;\n    rankdir = LR;\n\n    \"buffer channel\" [shape=box];\n\n    \"Logger.Log goroutine 1\" -> \"buffer channel\";\n    \"Logger.Log goroutine 2\" -> \"buffer channel\";\n    \"Logger.Log goroutine 3\" -> \"buffer channel\";\n    \"buffer channel\" -> \"sync goroutine\";\n    \"sync goroutine\" -> \"AWS Kinesis Stream\";\n}\n-->\n\n<!-- ![Thread Model](http://g.gravizo.com/g?digraph%20G%20%7B%0A%20%20%20%20fontname%3D%22Microsoft%20YaHei%22%3B%0A%20%20%20%20fontsize%3D10%3B%0A%20%20%20%20rankdir%20%3D%20LR%3B%0A%0A%20%20%20%20%22buffer%20channel%22%20%5Bshape%3Dbox%5D%3B%0A%0A%20%20%20%20%22Logger.Log%20goroutine%201%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22Logger.Log%20goroutine%202%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22Logger.Log%20goroutine%203%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22buffer%20channel%22%20-%3E%20%22sync%20goroutine%22%3B%0A%20%20%20%20%22sync%20goroutine%22%20-%3E%20%22AWS%20Kinesis%20Stream%22%3B%0A%20%7D) -->\n\n{% asset_img use_channel.png Channel %}\n\n\n\n```go\nfunc NewLogger(example interface{}, opts *Options) (*Logger, error) {\n    ...\n\n    go l.sync()    // sync goroutine\n    return l, nil\n}\n\nfunc (l *Logger) Log(msg interface{}) error {\n    ...\n\n    en := encode(msg)       // msg\n    ...\n        select {\n        case l.buffer <- en:    // buffer channelmsg\n        ...\n        }\n    ...\n    return nil\n}\n\nfunc (l *Logger) sync() {\n    ...\n\n    buf := make([][]byte, 0) // buffer channel\n    bufSize := 0\n\n    for {\n        select {\n        case msg := <-l.buffer:\n            if bufSize+len(msg)+partitionKeySize >= maxBatchSize {  // buf\n                l.flush(&buf, &bufSize)                             // AWS Kinesis\n            }\n\n            buf = append(buf, msg)                                  // buffer channelbuf\n            bufSize += len(msg) + partitionKeySize\n\n        ...\n    }\n}\n```\n\n## `Logger.Log`\n\nIO`caller`\n\n`Logger.Log`Go`channel`\n\n```go\nfunc (l *Logger) Log(msg interface{}) error {\n    ...\n\n    var timeout <-chan time.Time\n    if l.WriteTimeout > 0 {\n        timeout = time.After(l.WriteTimeout)    // l.WriteTimeout\n    }\n\n    ...\n        select {\n        case l.buffer <- en:\n        case <-timeout: // timeoutcase\n            return fmt.Errorf(\"dlog writes %+v timeout after %v\", msg, l.WriteTimeout)\n        }\n    ...\n    return nil\n}\n```\n\nJava.NETGo\n\n- C#\n    - [Implementing .Net method timeout](http://weblogs.asp.net/israelio/159985)\n    - [How to implement Task Async for a timer in C#?](http://stackoverflow.com/questions/18646650/how-to-implement-task-async-for-a-timer-in-c)\n    - [Implementing a timeout in c#](http://stackoverflow.com/questions/10143980/implementing-a-timeout-in-c-sharp)\n- Java\n    - [How to implement timeout using threads](http://www.coderanch.com/t/232213/threads/java/implement-timeout-threads)\n    - [How to timeout a thread](http://stackoverflow.com/questions/2275443/how-to-timeout-a-thread)\n\n## `logger``msg``buf`AWS Kinesis\n\n`dlog``Logger.sync()``buf`AWS Kinesis\n\n```go\nfunc (l *Logger) sync() {\n    if l.SyncPeriod <= 0 {\n        l.SyncPeriod = time.Second\n    }\n    ticker := time.NewTicker(l.SyncPeriod)  // l.SyncPeriodticker\n\n    buf := make([][]byte, 0)\n    bufSize := 0\n\n    for {  // sync goroutine\n        select {\n        case msg := <-l.buffer:\n            ...\n\n        case <-ticker.C: // ticker.C<-chan Timel.SyncPeriodcase\n            if bufSize > 0 {\n                l.flush(&buf, &bufSize)\n            }\n        }\n    }\n}\n```\n\n`ticker``dlog``msg``buf``l.SyncPeriod`AWS Kinesis\n\n\n\n## \n\nGoPackage `expvar``expvar`HTTP`/debug/vars`JSON`expvar`\n\n```go\npackage main\n\nimport (\n    \"encoding/json\"\n    \"expvar\"\n    \"fmt\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\n// Stats is used to collect runtime metrics\ntype Stats struct {\n    sync.Mutex\n    TotalHit  int\n    ErrorNums int\n}\n\nfunc (s *Stats) IncreaseTotalHit(i int) {\n    s.Lock()\n    defer s.Unlock()\n\n    s.TotalHit += i\n}\n\nfunc (s *Stats) IncreaseErrorNums(i int) {\n    s.Lock()\n    defer s.Unlock()\n\n    s.ErrorNums += i\n}\n\nfunc (s *Stats) String() string {\n    s.Lock()\n    defer s.Unlock()\n\n    b, err := json.Marshal(*s)\n    if err != nil {\n        return \"{}\"\n    } else {\n        return string(b)\n    }\n}\n\nvar (\n    stats *Stats\n    hits  *expvar.Map\n)\n\nfunc init() {\n\n    expvar.Publish(\"now\", expvar.Func(func() interface{} {\n        return time.Now().Format(\"\\\"2006-01-02 15:04:05\\\"\")\n    }))\n\n    stats = &Stats{}\n    expvar.Publish(\"stats\", stats)\n\n    hits = expvar.NewMap(\"hits\").Init()\n}\n\nfunc homeHandler(w http.ResponseWriter, r *http.Request) {\n    p := r.URL.Path[1:]\n    hits.Add(p, 1)\n    stats.IncreaseTotalHit(1)\n    fmt.Fprintf(w, \"Hey! I love %s! hits: %v\\n\", p, hits.Get(p))\n}\n\nfunc errHandler(w http.ResponseWriter, r *http.Request) {\n    stats.IncreaseErrorNums(1)\n    fmt.Fprintf(w, \"Error Nums: %v\\n\", stats.ErrorNums)\n}\n\nfunc main() {\n    http.HandleFunc(\"/err\", errHandler)\n    http.HandleFunc(\"/\", homeHandler)\n    http.ListenAndServe(\":8080\", nil)\n}\n```\n\n\n\n- `go run expvarexample.go`\n- `http://localhost:8080/ethan`\n- `http://localhost:8080/err`\n- `http://localhost:8080/debug/vars`\n```json\n{\n    \"cmdline\": [\"/var/folders/jf/65ft181j33j_d75ktgv67bsc0000gn/T/go-build467453980/command-line-arguments/_obj/exe/expvarsample\"],\n    \"hits\": {\n        \"ethan\": 1,\n        \"favicon.ico\": 2\n    },\n    \"memstats\": { ... },\n    \"now\": \"\\\"2016-04-19 20:17:40\\\"\",\n    \"stats\": {\n        \"TotalHit\":3,\n        \"ErrorNums\":1\n    }\n}\n```\n\n[expvarmon](https://github.com/divan/expvarmon)`expvar`\n\n- `go get github.com/divan/expvarmon`\n- `expvarmon -ports=\"8080\" -vars=\"hits.ethan,stats.TotalHit,stats.ErrorNums,now\"`\n- \n{% asset_img expvarmon_screen.png expvarmon screen %}\n\n`dlog``expvar``dlog`\n\n- `writtenRecords`: AWS Kinesis`msg`\n- `writtenBatches`: AWS KinesisAPI\n- `failedRecords`: AWS Kinesis`msg`\n- `tooBigMesssages`: (partitionKeySize1MB)`msg`\n\n\n\n## `Setup``TearDown`\n\nGo****`go test``testing` package[](http://docs.studygolang.com/doc/code.html#Testing)Go\n\n```go\n//$GOPATH/src/github.com/user/stringutil/reverse_test.go\npackage stringutil\n\nimport \"testing\"\n\nfunc TestReverse(t *testing.T) {\n    cases := []struct {\n        in, want string\n    }{\n        {\"Hello, world\", \"dlrow ,olleH\"},\n        {\"Hello, \", \" ,olleH\"},\n        {\"\", \"\"},\n    }\n    for _, c := range cases {\n        got := Reverse(c.in)\n        if got != c.want {\n            t.Errorf(\"Reverse(%q) == %q, want %q\", c.in, got, c.want)\n        }\n    }\n}\n```\n\n\n\n```go\n$ go test github.com/user/stringutil\nok  \tgithub.com/user/stringutil 0.165s\n```\n\nIaaS[testify/suite](https://github.com/stretchr/testify/suite) package[testify/suite](https://github.com/stretchr/testify/suite)`struct``setup`()/`teardown`()`go test`\n\n[testify/suite](https://github.com/stretchr/testify/suite)\n\n```go\npackage suite\n\nimport (\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n)\n\ntype SuiteTester struct {\n    // Include our basic suite logic.\n    Suite\n\n    // Other properties\n    propertyN string\n}\n\n// The SetupSuite method will be run by testify once, at the very\n// start of the testing suite, before any tests are run.\nfunc (suite *SuiteTester) SetupSuite() {\n    // ...\n}\n\n// The TearDownSuite method will be run by testify once, at the very\n// end of the testing suite, after all tests have been run.\nfunc (suite *SuiteTester) TearDownSuite() {\n    // ...\n}\n\n// The SetupTest method will be run before every test in the suite.\nfunc (suite *SuiteTester) SetupTest() {\n    // ...\n}\n\n// The TearDownTest method will be run after every test in the suite.\nfunc (suite *SuiteTester) TearDownTest() {\n    // ...\n}\n\n// a test method\nfunc (suite *SuiteTester) TestOne() {\n    // ...\n}\n\n// another test method\nfunc (suite *SuiteTester) TestTwo() {\n    // ...\n}\n\n// TestRunSuite will be run by the 'go test' command, so within it, we\n// can run our suite using the Run(*testing.T, TestingSuite) function.\nfunc TestRunSuite(t *testing.T) {\n    suiteTester := new(SuiteTester)\n    Run(t, suiteTester)\n}\n```\n\n`dlog``Logger.Log`\n\n```go\npackage dlog\n\n//...\n\ntype WriteLogSuiteTester struct {\n    suite.Suite\n\n    options     *Options\n    seachLogger *Logger\n    clickLogger *Logger\n    streamNames []string // save the created AWS Kinesis Streams, which will be removed in TearDownSuite()\n}\n\n// The SetupSuite method will be run by testify once, at the very\n// start of the testing suite, before any tests are run.\nfunc (s *WriteLogSuiteTester) SetupSuite() {\n\n    //...\n\n    // create stream 1\n    err = s.seachLogger.kinesis.CreateStream(s.seachLogger.streamName, testingShardCount)\n    s.Nil(err)\n\n    // create stream 2\n    err = s.clickLogger.kinesis.CreateStream(s.clickLogger.streamName, testingShardCount)\n    s.Nil(err)\n\n    s.streamNames = []string{s.seachLogger.streamName, s.clickLogger.streamName}\n\n    for { // waiting created stream's status to be active\n        time.Sleep(1 * time.Second)\n        resp1, err1 := s.seachLogger.kinesis.DescribeStream(s.seachLogger.streamName)\n        s.Nil(err1)\n\n        resp2, err2 := s.seachLogger.kinesis.DescribeStream(s.clickLogger.streamName)\n        s.Nil(err2)\n\n        status1 := strings.ToLower(string(resp1.StreamStatus))\n        status2 := strings.ToLower(string(resp2.StreamStatus))\n        if status1 == \"active\" && status2 == \"active\" {\n            break\n        }\n    }\n}\n\n// The TearDownSuite method will be run by testify once, at the very\n// end of the testing suite, after all tests have been run.\nfunc (s *WriteLogSuiteTester) TearDownSuite() {\n    if s.streamNames == nil || len(s.streamNames) == 0 {\n        return\n    }\n\n    for _, streamName := range s.streamNames {\n        err := s.seachLogger.kinesis.DeleteStream(streamName)\n        s.Nil(err)\n    }\n}\n\nfunc (s *WriteLogSuiteTester) TestWriteLog() {\n    defer func() { // Recover if panicking to make sure TearDownSuite will be executed\n        if r := recover(); r != nil {\n            s.Fail(fmt.Sprint(r))\n        }\n    }()\n\n    //...\n}\n\nfunc TestRunWriteLogSuite(t *testing.T) {\n    suiteTester := new(WriteLogSuiteTester)\n    suite.Run(t, suiteTester)\n}\n```\n\n\n\n- \n- \n    - \n    - \n    - \n\n## `kinesisMock`\n\nMock\n\n`dlog``KinesisInterface`:\n\n```go\ntype KinesisInterface interface {\n    PutRecords(streamName string, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err error)\n    CreateStream(name string, shardCount int) error\n    DescribeStream(name string) (resp *kinesis.StreamDescription, err error)\n    DeleteStream(name string) error\n}\n```\n\n`KinesisInterface``dlog`[github.com/AdRoll/goamz/kinesis/kinesis](https://github.com/AdRoll/goamz/blob/master/kinesis/kinesis.go)Go`interface`****[github.com/AdRoll/goamz/kinesis/kinesis](https://github.com/AdRoll/goamz/blob/master/kinesis/kinesis.go)`KinesisInterface``kinesisMock``KinesisInterface`\n\n```go\ntype kinesisMock struct {\n    // Mapping from steam name to batches of batches\n    storage map[string][][]kinesis.PutRecordsRequestEntry\n\n    // simulate lantency that sync to Kinesis\n    putRecordLatency time.Duration\n\n    // created streams' names\n    streamNames []string\n\n    // lock to solve concurrent call\n    lock sync.RWMutex\n}\n\nfunc newKinesisMock(putRecordsLatency time.Duration) *kinesisMock {\n    return &kinesisMock{\n        storage:          make(map[string][][]kinesis.PutRecordsRequestEntry),\n        putRecordLatency: putRecordsLatency,\n        streamNames:      make([]string, 0),\n    }\n}\n\nfunc (mock *kinesisMock) PutRecords(streamName string, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err error) {\n    // ...\n}\n\nfunc (mock *kinesisMock) CreateStream(name string, shardCount int) error {\n    // ...\n}\n\nfunc (mock *kinesisMock) DescribeStream(name string) (resp *kinesis.StreamDescription, err error) {\n    // ...\n}\n\nfunc (mock *kinesisMock) DeleteStream(name string) error {\n    // ...\n}\n```\n\n`kinesis``KinesisInterface`\n\n```go\ntype Logger struct {\n    //...\n    kinesis    KinesisInterface\n    //...\n}\n```\n\n`Logger``kinesisMock``kinesis`\n\n```go\nfunc TestLoggingToMockKinesis(t *testing.T) {\n    assert := assert.New(t)\n\n    l, e := NewLogger(&impression{}, &Options{\n        // ...\n        UseMockKinesis: true,\n        MockKinesis:    newKinesisMock(0),\n    })\n\n    // ...\n}\n```\n\n## AWS Kinesis\n\n`kinesisMock``kinesis`\n\n`kinesisMock``putRecordLatency``PutRecords`\n\n```go\ntype kinesisMock struct {\n    // ...\n\n    // simulate lantency that sync to Kinesis\n    putRecordLatency time.Duration\n\n    // ...\n}\n\nfunc (mock *kinesisMock) PutRecords(streamName string, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err error) {\n    //...\n\n    time.Sleep(mock.putRecordLatency) // \n\n    //...\n}\n```\n\n`kinesis``brokenKinesisMock`\n\n```go\ntype brokenKinesisMock struct {\n    *kinesisMock\n}\n\nfunc newBrokenKinesisMock() *brokenKinesisMock {\n    return &brokenKinesisMock{\n        kinesisMock: newKinesisMock(0),\n    }\n}\n\nfunc (mock *brokenKinesisMock) PutRecords(streamName string, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err error) {\n    return nil, fmt.Errorf(\"Kinesis is broken\")\n}\n```\n\n`kinesisMock``brokenKinesisMock``struct``brokenKinesisMock``kinesisMock``KinesisInterface`\n\n## `log.Print`\n\n\n\n- `log.Print``stdout`\n- `go test``-v``log.Print``log.Print`\n\n\n# \n\n- [AWS Kinesis API - CreateStream](http://docs.aws.amazon.com/kinesis/latest/APIReference/API_CreateStream.html)Stream10+Stream\n- [github.com/AdRoll/goamz/aws/regions.go](https://github.com/AdRoll/goamz/blob/master/aws/regions.go)AWS KinesisURLAWS Kinesis\n- Travis CIKill1CI10\n\n\n# \n\n- \n- Kinesis`dlog`\n\n\n# \n\n- [Effective Go](http://docs.studygolang.com/doc/effective_go.html)\n- [Amazon Kinesis Documentation](https://aws.amazon.com/cn/documentation/kinesis/)\n- [Advanced Go Concurrency Patterns](http://blog.golang.org/advanced-go-concurrency-patterns)\n- [hystrix-go](https://github.com/afex/hystrix-go)\n\n\n# \n\n[](http://www.augmn.com)(ethancai@qq.com)\n\n{% asset_img 2016-04-21_07-12-24.png 1 %}\n\n{% asset_img 2016-04-21_07-12-40.png 2 %}\n\n** / Backend Engineer**\n\n\n\n- \n- micro-service\n- \n- Code Review\n\n\n\n- \n- GoNode.jsC++Python\n- RESTfulRPC\n- web serviceweb app\n- MysqlRedisMongoDB\n- \n- \n- \n- 53\n\n\n** / Senior Ops Engineer**\n\n\n\n- AWS\n- \n- \n- \n- 7*24\n- IT\n\n\n\n- Linux/UnixLinux\n- TCP/IPHTTP\n- NginxDNSNTP\n- ShellPythonPerl Ruby\n- Linuxgrepawksedtmuxvim\n- MySQL\n- \n-  2 AWS\n- DevOps\n- \n- \n- \n- \n","slug":"experiences-about-develop-dlog","published":1,"updated":"2025-04-27T17:04:49.536Z","comments":1,"layout":"post","photos":[],"_id":"cm9zwlzc60007fdjh02midzgz","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><!-- TOC depthFrom:1 depthTo:2 withLinks:0 updateOnSave:1 orderedList:0 -->\n\n<ul>\n<li></li>\n<li><code>dlog</code></li>\n<li><code>dlog</code></li>\n<li><ul>\n<li><code>panic</code><code>return error</code></li>\n<li><code>logger</code><code>data log</code></li>\n<li><code>data log</code></li>\n<li><code>Logger.Log</code></li>\n<li><code>logger</code><code>msg</code><code>buf</code>AWS Kinesis</li>\n<li></li>\n<li><code>Setup</code><code>TearDown</code></li>\n<li><code>kinesisMock</code></li>\n<li>AWS Kinesis</li>\n<li><code>log.Print</code></li>\n</ul>\n</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<!-- /TOC -->\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://segmentfault.com/a/1190000002416822\"></a>Golog<a href=\"https://github.com/topicai/dlog\">dlog</a>Go</p>\n<blockquote>\n<p>Go</p>\n</blockquote>\n<h1 id=\"dlog\"><a href=\"#dlog\" class=\"headerlink\" title=\"dlog\"></a><code>dlog</code></h1><p><strong>readme</strong><code>dlog</code></p>\n<blockquote>\n<p>dlog is a Go package for distributed structure logging using Amazon AWS Kinesis&#x2F;Firehose.</p>\n</blockquote>\n<p><a href=\"https://github.com/topicai/dlog/blob/develop/README.md\">readme</a></p>\n<p><code>dlog</code><code>data log</code>Golang package<code>data log</code></p>\n<ul>\n<li><code>status log</code>Bug</li>\n<li><code>data log</code><code>data log</code></li>\n</ul>\n<h1 id=\"dlog\"><a href=\"#dlog\" class=\"headerlink\" title=\"dlog\"></a><code>dlog</code></h1><ul>\n<li><code>data log</code><code>logger</code><code>logger</code><code>data log</code></li>\n<li><code>dlog</code><ul>\n<li>AWS Kinesis</li>\n</ul>\n</li>\n<li><code>dlog</code><code>data log</code><code>dlog</code><code>dlog</code></li>\n<li>AWS KinesisAPI<a href=\"http://docs.aws.amazon.com/kinesis/latest/APIReference/API_PutRecord.html\">PutRecord</a>, <a href=\"http://docs.aws.amazon.com/kinesis/latest/APIReference/API_PutRecords.html\">PutRecords</a>Kinesis<code>data log</code><ul>\n<li><code>PutRecords</code><code>record</code><code>500</code><code>record</code>1MB<code>request</code>5MB</li>\n<li>Kinesis StreamTPSstreamshardshardTPS<code>1000 records per second</code> <code>1MB per second</code></li>\n</ul>\n</li>\n<li></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"panicreturn-error\"><a href=\"#panicreturn-error\" class=\"headerlink\" title=\"panicreturn error\"></a><code>panic</code><code>return error</code></h2><p><code>panic</code><code>return error</code></p>\n<h3 id=\"panic\"><a href=\"#panic\" class=\"headerlink\" title=\"panic\"></a><code>panic</code></h3><p><code>panic</code><code>goroutine</code><code>panic</code><code>recover</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        log.Panic(<span class=\"string\">&quot;some error before work2&quot;</span>)</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;do some work2&quot;</span>)</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">    time.Sleep(time.Second)</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;do some work1&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/off1y9tBax\"></a></em></p>\n<p><code>recover</code><code>goroutine</code><code>panic</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> err := <span class=\"built_in\">recover</span>(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">                log.Printf(<span class=\"string\">&quot;error: %v&quot;</span>, err)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;()</span><br><span class=\"line\">        log.Panic(<span class=\"string\">&quot;some error before work2&quot;</span>)</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;do some work2&quot;</span>)</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">    time.Sleep(time.Second)</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;do some work1&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/RLWyb813Uw\"></a></em></p>\n<p>Go<code>panic</code><code>recover</code>Java.NET<code>throw</code><code>try...catch</code></p>\n<h3 id=\"return-error\"><a href=\"#return-error\" class=\"headerlink\" title=\"return error\"></a><code>return error</code></h3><p><code>return error</code>Go<code>caller</code></p>\n<p><code>return error</code><code>return error</code><code>panic/recover</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;errors&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> R <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f1</span><span class=\"params\">()</span></span> (<span class=\"type\">error</span>, *R) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;an error&quot;</span>), <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f2</span><span class=\"params\">()</span></span> (<span class=\"type\">error</span>, *R) &#123;</span><br><span class=\"line\">    err, r := f1()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> err, <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, r</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f3</span><span class=\"params\">()</span></span> (<span class=\"type\">error</span>, *R) &#123;</span><br><span class=\"line\">    err, r := f2()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> err, <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, r</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    err, _ := f3()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        log.Print(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/GhE5JpzZvn\"></a></em></p>\n<h3 id=\"dlog\"><a href=\"#dlog\" class=\"headerlink\" title=\"dlog\"></a><code>dlog</code></h3><p><code>panic</code><code>return error</code><code>panic</code><code>return error</code></p>\n<p><code>dlog</code><code>package</code></p>\n<ul>\n<li><code>func NewLogger(example interface&#123;&#125;, opts *Options) (*Logger, error)</code></li>\n<li><code>func (l *Logger) Log(msg interface&#123;&#125;) error</code></li>\n</ul>\n<p></p>\n<ul>\n<li><code>NewLogger</code>data log<code>NewLogger</code><code>logger</code><code>panic</code><code>return error</code><code>caller</code>Golang package</li>\n<li><code>logger.Log</code><code>Log</code><code>panic</code><ul>\n<li><code>logger.Log</code><code>return error</code><code>msg</code></li>\n<li><code>logger.Log</code>AWS KinesisAWS Kinesis<code>panic</code><code>return error</code><code>logger</code><code>handler</code><code>handler</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"loggerdata-log\"><a href=\"#loggerdata-log\" class=\"headerlink\" title=\"loggerdata log\"></a><code>logger</code><code>data log</code></h2><p><code>logger</code><code>data log</code></p>\n<ul>\n<li><code>Logger</code><code>msgType reflect.Type</code></li>\n<li><code>NewLogger</code><code>logger</code><code>logger</code></li>\n<li><code>Log</code><code>msg</code><code>logger</code></li>\n</ul>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// msgTypeLogger</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Logger <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    msgType    reflect.Type</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// msgreflect.Type</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">msgType</span><span class=\"params\">(msg <span class=\"keyword\">interface</span>&#123;&#125;)</span></span> (reflect.Type, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    t := reflect.TypeOf(msg)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> t.Kind() == reflect.Ptr &#123;</span><br><span class=\"line\">        t = t.Elem()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> t.Kind() != reflect.Struct &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, fmt.Errorf(<span class=\"string\">&quot;dlog message must be either *struct or struct&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> t, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewLogger</span><span class=\"params\">(example <span class=\"keyword\">interface</span>&#123;&#125;, opts *Options)</span></span> (*Logger, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    t, e := msgType(example)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> e != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, e</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    l := &amp;Logger&#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        msgType:    t,</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> l, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(l *Logger)</span></span> Log(msg <span class=\"keyword\">interface</span>&#123;&#125;) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> t, e := msgType(msg); e != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> e</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> !t.AssignableTo(l.msgType) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">&quot;parameter (%+v) not assignable to %v&quot;</span>, msg, l.msgType)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Log</code><code>AssignableTo</code><code>msg</code><code>struct</code><code>AssignableTo</code><code>True</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;reflect&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> Fn <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(<span class=\"type\">int</span>)</span></span> <span class=\"type\">int</span></span><br><span class=\"line\">    id := <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(x <span class=\"type\">int</span>)</span></span> <span class=\"type\">int</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> zeroFn Fn</span><br><span class=\"line\">    log.Println(reflect.TypeOf(id).AssignableTo(reflect.TypeOf(zeroFn)))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">type</span> MyInt <span class=\"type\">int</span></span><br><span class=\"line\">    mi := <span class=\"number\">1</span></span><br><span class=\"line\">    log.Println(reflect.TypeOf(<span class=\"number\">2</span>).AssignableTo(reflect.TypeOf(mi)))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">type</span> S1 <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">        name <span class=\"type\">string</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> S2 S1</span><br><span class=\"line\"></span><br><span class=\"line\">    s1 := S1&#123;</span><br><span class=\"line\">        name: <span class=\"string\">&quot;ethan&quot;</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    s2 := S2&#123;</span><br><span class=\"line\">        name: <span class=\"string\">&quot;ethan&quot;</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// s2 = s1\t// if uncomment this line, will report &quot;cannot use s1 (type S1) as type S2 in assignment&quot; when compile</span></span><br><span class=\"line\">    log.Println(reflect.TypeOf(s1).AssignableTo(reflect.TypeOf(s2)))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/eDmzxW-ayk\"></a></em></p>\n<h2 id=\"data-log\"><a href=\"#data-log\" class=\"headerlink\" title=\"data log\"></a><code>data log</code></h2><p><code>buffer</code><code>message</code><code>buffer</code>AWS Kinesis<code>buffer</code>(goroutine)<code>buffer</code></p>\n<ul>\n<li><code>buffer</code></li>\n<li><code>channel</code><code>buffer</code></li>\n</ul>\n<p>Java.NETCSP(Communicating Sequential Processes)</p>\n<img src=\"/2016/04/20/experiences-about-develop-dlog/channel.png\" class=\"\" title=\"CSP Model\">\n\n<p><code>dlog</code><code>Log</code><code>msg</code><code>buffer</code><code>channel</code><code>goroutine</code><code>channel</code><code>buf := make([][]byte, 0)</code><code>buf</code>AWS Kinesis<code>flush</code>AWS Kinesis<code>goroutine</code><code>buf</code><code>buf</code></p>\n<!--\ndigraph G {\n    fontname=\"Microsoft YaHei\";\n    fontsize=10;\n    rankdir = LR;\n\n    \"buffer channel\" [shape=box];\n\n    \"Logger.Log goroutine 1\" -> \"buffer channel\";\n    \"Logger.Log goroutine 2\" -> \"buffer channel\";\n    \"Logger.Log goroutine 3\" -> \"buffer channel\";\n    \"buffer channel\" -> \"sync goroutine\";\n    \"sync goroutine\" -> \"AWS Kinesis Stream\";\n}\n-->\n\n<!-- ![Thread Model](http://g.gravizo.com/g?digraph%20G%20%7B%0A%20%20%20%20fontname%3D%22Microsoft%20YaHei%22%3B%0A%20%20%20%20fontsize%3D10%3B%0A%20%20%20%20rankdir%20%3D%20LR%3B%0A%0A%20%20%20%20%22buffer%20channel%22%20%5Bshape%3Dbox%5D%3B%0A%0A%20%20%20%20%22Logger.Log%20goroutine%201%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22Logger.Log%20goroutine%202%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22Logger.Log%20goroutine%203%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22buffer%20channel%22%20-%3E%20%22sync%20goroutine%22%3B%0A%20%20%20%20%22sync%20goroutine%22%20-%3E%20%22AWS%20Kinesis%20Stream%22%3B%0A%20%7D) -->\n\n<img src=\"/2016/04/20/experiences-about-develop-dlog/use_channel.png\" class=\"\" title=\"Channel\">\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewLogger</span><span class=\"params\">(example <span class=\"keyword\">interface</span>&#123;&#125;, opts *Options)</span></span> (*Logger, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">go</span> l.sync()    <span class=\"comment\">// sync goroutine</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> l, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(l *Logger)</span></span> Log(msg <span class=\"keyword\">interface</span>&#123;&#125;) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    en := encode(msg)       <span class=\"comment\">// msg</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">        <span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> l.buffer &lt;- en:    <span class=\"comment\">// buffer channelmsg</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(l *Logger)</span></span> sync() &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    buf := <span class=\"built_in\">make</span>([][]<span class=\"type\">byte</span>, <span class=\"number\">0</span>) <span class=\"comment\">// buffer channel</span></span><br><span class=\"line\">    bufSize := <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> msg := &lt;-l.buffer:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> bufSize+<span class=\"built_in\">len</span>(msg)+partitionKeySize &gt;= maxBatchSize &#123;  <span class=\"comment\">// buf</span></span><br><span class=\"line\">                l.flush(&amp;buf, &amp;bufSize)                             <span class=\"comment\">// AWS Kinesis</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            buf = <span class=\"built_in\">append</span>(buf, msg)                                  <span class=\"comment\">// buffer channelbuf</span></span><br><span class=\"line\">            bufSize += <span class=\"built_in\">len</span>(msg) + partitionKeySize</span><br><span class=\"line\"></span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Logger-Log\"><a href=\"#Logger-Log\" class=\"headerlink\" title=\"Logger.Log\"></a><code>Logger.Log</code></h2><p>IO<code>caller</code></p>\n<p><code>Logger.Log</code>Go<code>channel</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(l *Logger)</span></span> Log(msg <span class=\"keyword\">interface</span>&#123;&#125;) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> timeout &lt;-<span class=\"keyword\">chan</span> time.Time</span><br><span class=\"line\">    <span class=\"keyword\">if</span> l.WriteTimeout &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        timeout = time.After(l.WriteTimeout)    <span class=\"comment\">// l.WriteTimeout</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">        <span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> l.buffer &lt;- en:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> &lt;-timeout: <span class=\"comment\">// timeoutcase</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">&quot;dlog writes %+v timeout after %v&quot;</span>, msg, l.WriteTimeout)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Java.NETGo</p>\n<ul>\n<li>C#<ul>\n<li><a href=\"http://weblogs.asp.net/israelio/159985\">Implementing .Net method timeout</a></li>\n<li><a href=\"http://stackoverflow.com/questions/18646650/how-to-implement-task-async-for-a-timer-in-c\">How to implement Task Async for a timer in C#?</a></li>\n<li><a href=\"http://stackoverflow.com/questions/10143980/implementing-a-timeout-in-c-sharp\">Implementing a timeout in c#</a></li>\n</ul>\n</li>\n<li>Java<ul>\n<li><a href=\"http://www.coderanch.com/t/232213/threads/java/implement-timeout-threads\">How to implement timeout using threads</a></li>\n<li><a href=\"http://stackoverflow.com/questions/2275443/how-to-timeout-a-thread\">How to timeout a thread</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"loggermsgbufAWS-Kinesis\"><a href=\"#loggermsgbufAWS-Kinesis\" class=\"headerlink\" title=\"loggermsgbufAWS Kinesis\"></a><code>logger</code><code>msg</code><code>buf</code>AWS Kinesis</h2><p><code>dlog</code><code>Logger.sync()</code><code>buf</code>AWS Kinesis</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(l *Logger)</span></span> sync() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> l.SyncPeriod &lt;= <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        l.SyncPeriod = time.Second</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ticker := time.NewTicker(l.SyncPeriod)  <span class=\"comment\">// l.SyncPeriodticker</span></span><br><span class=\"line\"></span><br><span class=\"line\">    buf := <span class=\"built_in\">make</span>([][]<span class=\"type\">byte</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">    bufSize := <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> &#123;  <span class=\"comment\">// sync goroutine</span></span><br><span class=\"line\">        <span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> msg := &lt;-l.buffer:</span><br><span class=\"line\">            ...</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">case</span> &lt;-ticker.C: <span class=\"comment\">// ticker.C&lt;-chan Timel.SyncPeriodcase</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> bufSize &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">                l.flush(&amp;buf, &amp;bufSize)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>ticker</code><code>dlog</code><code>msg</code><code>buf</code><code>l.SyncPeriod</code>AWS Kinesis</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>GoPackage <code>expvar</code><code>expvar</code>HTTP<code>/debug/vars</code>JSON<code>expvar</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;expvar&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Stats is used to collect runtime metrics</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Stats <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    sync.Mutex</span><br><span class=\"line\">    TotalHit  <span class=\"type\">int</span></span><br><span class=\"line\">    ErrorNums <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *Stats)</span></span> IncreaseTotalHit(i <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">    s.Lock()</span><br><span class=\"line\">    <span class=\"keyword\">defer</span> s.Unlock()</span><br><span class=\"line\"></span><br><span class=\"line\">    s.TotalHit += i</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *Stats)</span></span> IncreaseErrorNums(i <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">    s.Lock()</span><br><span class=\"line\">    <span class=\"keyword\">defer</span> s.Unlock()</span><br><span class=\"line\"></span><br><span class=\"line\">    s.ErrorNums += i</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *Stats)</span></span> String() <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">    s.Lock()</span><br><span class=\"line\">    <span class=\"keyword\">defer</span> s.Unlock()</span><br><span class=\"line\"></span><br><span class=\"line\">    b, err := json.Marshal(*s)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&#123;&#125;&quot;</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">string</span>(b)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">    stats *Stats</span><br><span class=\"line\">    hits  *expvar.Map</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    expvar.Publish(<span class=\"string\">&quot;now&quot;</span>, expvar.Func(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"keyword\">interface</span>&#123;&#125; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> time.Now().Format(<span class=\"string\">&quot;\\&quot;2006-01-02 15:04:05\\&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;))</span><br><span class=\"line\"></span><br><span class=\"line\">    stats = &amp;Stats&#123;&#125;</span><br><span class=\"line\">    expvar.Publish(<span class=\"string\">&quot;stats&quot;</span>, stats)</span><br><span class=\"line\"></span><br><span class=\"line\">    hits = expvar.NewMap(<span class=\"string\">&quot;hits&quot;</span>).Init()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">homeHandler</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">    p := r.URL.Path[<span class=\"number\">1</span>:]</span><br><span class=\"line\">    hits.Add(p, <span class=\"number\">1</span>)</span><br><span class=\"line\">    stats.IncreaseTotalHit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    fmt.Fprintf(w, <span class=\"string\">&quot;Hey! I love %s! hits: %v\\n&quot;</span>, p, hits.Get(p))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">errHandler</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">    stats.IncreaseErrorNums(<span class=\"number\">1</span>)</span><br><span class=\"line\">    fmt.Fprintf(w, <span class=\"string\">&quot;Error Nums: %v\\n&quot;</span>, stats.ErrorNums)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    http.HandleFunc(<span class=\"string\">&quot;/err&quot;</span>, errHandler)</span><br><span class=\"line\">    http.HandleFunc(<span class=\"string\">&quot;/&quot;</span>, homeHandler)</span><br><span class=\"line\">    http.ListenAndServe(<span class=\"string\">&quot;:8080&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li><code>go run expvarexample.go</code></li>\n<li><code>http://localhost:8080/ethan</code></li>\n<li><code>http://localhost:8080/err</code></li>\n<li><code>http://localhost:8080/debug/vars</code></li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;cmdline&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;/var/folders/jf/65ft181j33j_d75ktgv67bsc0000gn/T/go-build467453980/command-line-arguments/_obj/exe/expvarsample&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;ethan&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;favicon.ico&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;memstats&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span> ... <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;now&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;\\&quot;2016-04-19 20:17:40\\&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;stats&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;TotalHit&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;ErrorNums&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://github.com/divan/expvarmon\">expvarmon</a><code>expvar</code></p>\n<ul>\n<li><code>go get github.com/divan/expvarmon</code></li>\n<li><code>expvarmon -ports=&quot;8080&quot; -vars=&quot;hits.ethan,stats.TotalHit,stats.ErrorNums,now&quot;</code></li>\n<li></li>\n</ul>\n<img src=\"/2016/04/20/experiences-about-develop-dlog/expvarmon_screen.png\" class=\"\" title=\"expvarmon screen\">\n\n<p><code>dlog</code><code>expvar</code><code>dlog</code></p>\n<ul>\n<li><code>writtenRecords</code>: AWS Kinesis<code>msg</code></li>\n<li><code>writtenBatches</code>: AWS KinesisAPI</li>\n<li><code>failedRecords</code>: AWS Kinesis<code>msg</code></li>\n<li><code>tooBigMesssages</code>: (partitionKeySize1MB)<code>msg</code></li>\n</ul>\n<p></p>\n<h2 id=\"SetupTearDown\"><a href=\"#SetupTearDown\" class=\"headerlink\" title=\"SetupTearDown\"></a><code>Setup</code><code>TearDown</code></h2><p>Go<strong></strong><code>go test</code><code>testing</code> package<a href=\"http://docs.studygolang.com/doc/code.html#Testing\"></a>Go</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//$GOPATH/src/github.com/user/stringutil/reverse_test.go</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> stringutil</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;testing&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestReverse</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    cases := []<span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">        in, want <span class=\"type\">string</span></span><br><span class=\"line\">    &#125;&#123;</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;Hello, world&quot;</span>, <span class=\"string\">&quot;dlrow ,olleH&quot;</span>&#125;,</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;Hello, &quot;</span>, <span class=\"string\">&quot; ,olleH&quot;</span>&#125;,</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>&#125;,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> _, c := <span class=\"keyword\">range</span> cases &#123;</span><br><span class=\"line\">        got := Reverse(c.in)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> got != c.want &#123;</span><br><span class=\"line\">            t.Errorf(<span class=\"string\">&quot;Reverse(%q) == %q, want %q&quot;</span>, c.in, got, c.want)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"keyword\">go</span> test github.com/user/stringutil</span><br><span class=\"line\">ok  \tgithub.com/user/stringutil <span class=\"number\">0.165</span>s</span><br></pre></td></tr></table></figure>\n\n<p>IaaS<a href=\"https://github.com/stretchr/testify/suite\">testify&#x2F;suite</a> package<a href=\"https://github.com/stretchr/testify/suite\">testify&#x2F;suite</a><code>struct</code><code>setup</code>()&#x2F;<code>teardown</code>()<code>go test</code></p>\n<p><a href=\"https://github.com/stretchr/testify/suite\">testify&#x2F;suite</a></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> suite</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;testing&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&quot;github.com/stretchr/testify/assert&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> SuiteTester <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Include our basic suite logic.</span></span><br><span class=\"line\">    Suite</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Other properties</span></span><br><span class=\"line\">    propertyN <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The SetupSuite method will be run by testify once, at the very</span></span><br><span class=\"line\"><span class=\"comment\">// start of the testing suite, before any tests are run.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> SetupSuite() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The TearDownSuite method will be run by testify once, at the very</span></span><br><span class=\"line\"><span class=\"comment\">// end of the testing suite, after all tests have been run.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> TearDownSuite() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The SetupTest method will be run before every test in the suite.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> SetupTest() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The TearDownTest method will be run after every test in the suite.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> TearDownTest() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// a test method</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> TestOne() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// another test method</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> TestTwo() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// TestRunSuite will be run by the &#x27;go test&#x27; command, so within it, we</span></span><br><span class=\"line\"><span class=\"comment\">// can run our suite using the Run(*testing.T, TestingSuite) function.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestRunSuite</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    suiteTester := <span class=\"built_in\">new</span>(SuiteTester)</span><br><span class=\"line\">    Run(t, suiteTester)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>dlog</code><code>Logger.Log</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> dlog</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> WriteLogSuiteTester <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    suite.Suite</span><br><span class=\"line\"></span><br><span class=\"line\">    options     *Options</span><br><span class=\"line\">    seachLogger *Logger</span><br><span class=\"line\">    clickLogger *Logger</span><br><span class=\"line\">    streamNames []<span class=\"type\">string</span> <span class=\"comment\">// save the created AWS Kinesis Streams, which will be removed in TearDownSuite()</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The SetupSuite method will be run by testify once, at the very</span></span><br><span class=\"line\"><span class=\"comment\">// start of the testing suite, before any tests are run.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *WriteLogSuiteTester)</span></span> SetupSuite() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// create stream 1</span></span><br><span class=\"line\">    err = s.seachLogger.kinesis.CreateStream(s.seachLogger.streamName, testingShardCount)</span><br><span class=\"line\">    s.Nil(err)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// create stream 2</span></span><br><span class=\"line\">    err = s.clickLogger.kinesis.CreateStream(s.clickLogger.streamName, testingShardCount)</span><br><span class=\"line\">    s.Nil(err)</span><br><span class=\"line\"></span><br><span class=\"line\">    s.streamNames = []<span class=\"type\">string</span>&#123;s.seachLogger.streamName, s.clickLogger.streamName&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> &#123; <span class=\"comment\">// waiting created stream&#x27;s status to be active</span></span><br><span class=\"line\">        time.Sleep(<span class=\"number\">1</span> * time.Second)</span><br><span class=\"line\">        resp1, err1 := s.seachLogger.kinesis.DescribeStream(s.seachLogger.streamName)</span><br><span class=\"line\">        s.Nil(err1)</span><br><span class=\"line\"></span><br><span class=\"line\">        resp2, err2 := s.seachLogger.kinesis.DescribeStream(s.clickLogger.streamName)</span><br><span class=\"line\">        s.Nil(err2)</span><br><span class=\"line\"></span><br><span class=\"line\">        status1 := strings.ToLower(<span class=\"type\">string</span>(resp1.StreamStatus))</span><br><span class=\"line\">        status2 := strings.ToLower(<span class=\"type\">string</span>(resp2.StreamStatus))</span><br><span class=\"line\">        <span class=\"keyword\">if</span> status1 == <span class=\"string\">&quot;active&quot;</span> &amp;&amp; status2 == <span class=\"string\">&quot;active&quot;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The TearDownSuite method will be run by testify once, at the very</span></span><br><span class=\"line\"><span class=\"comment\">// end of the testing suite, after all tests have been run.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *WriteLogSuiteTester)</span></span> TearDownSuite() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> s.streamNames == <span class=\"literal\">nil</span> || <span class=\"built_in\">len</span>(s.streamNames) == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> _, streamName := <span class=\"keyword\">range</span> s.streamNames &#123;</span><br><span class=\"line\">        err := s.seachLogger.kinesis.DeleteStream(streamName)</span><br><span class=\"line\">        s.Nil(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *WriteLogSuiteTester)</span></span> TestWriteLog() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123; <span class=\"comment\">// Recover if panicking to make sure TearDownSuite will be executed</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> r := <span class=\"built_in\">recover</span>(); r != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">            s.Fail(fmt.Sprint(r))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestRunWriteLogSuite</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    suiteTester := <span class=\"built_in\">new</span>(WriteLogSuiteTester)</span><br><span class=\"line\">    suite.Run(t, suiteTester)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li></li>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"kinesisMock\"><a href=\"#kinesisMock\" class=\"headerlink\" title=\"kinesisMock\"></a><code>kinesisMock</code></h2><p>Mock</p>\n<p><code>dlog</code><code>KinesisInterface</code>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> KinesisInterface <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">    PutRecords(streamName <span class=\"type\">string</span>, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err <span class=\"type\">error</span>)</span><br><span class=\"line\">    CreateStream(name <span class=\"type\">string</span>, shardCount <span class=\"type\">int</span>) <span class=\"type\">error</span></span><br><span class=\"line\">    DescribeStream(name <span class=\"type\">string</span>) (resp *kinesis.StreamDescription, err <span class=\"type\">error</span>)</span><br><span class=\"line\">    DeleteStream(name <span class=\"type\">string</span>) <span class=\"type\">error</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>KinesisInterface</code><code>dlog</code><a href=\"https://github.com/AdRoll/goamz/blob/master/kinesis/kinesis.go\">github.com&#x2F;AdRoll&#x2F;goamz&#x2F;kinesis&#x2F;kinesis</a>Go<code>interface</code><strong></strong><a href=\"https://github.com/AdRoll/goamz/blob/master/kinesis/kinesis.go\">github.com&#x2F;AdRoll&#x2F;goamz&#x2F;kinesis&#x2F;kinesis</a><code>KinesisInterface</code><code>kinesisMock</code><code>KinesisInterface</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> kinesisMock <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Mapping from steam name to batches of batches</span></span><br><span class=\"line\">    storage <span class=\"keyword\">map</span>[<span class=\"type\">string</span>][][]kinesis.PutRecordsRequestEntry</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// simulate lantency that sync to Kinesis</span></span><br><span class=\"line\">    putRecordLatency time.Duration</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// created streams&#x27; names</span></span><br><span class=\"line\">    streamNames []<span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// lock to solve concurrent call</span></span><br><span class=\"line\">    lock sync.RWMutex</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newKinesisMock</span><span class=\"params\">(putRecordsLatency time.Duration)</span></span> *kinesisMock &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;kinesisMock&#123;</span><br><span class=\"line\">        storage:          <span class=\"built_in\">make</span>(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>][][]kinesis.PutRecordsRequestEntry),</span><br><span class=\"line\">        putRecordLatency: putRecordsLatency,</span><br><span class=\"line\">        streamNames:      <span class=\"built_in\">make</span>([]<span class=\"type\">string</span>, <span class=\"number\">0</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *kinesisMock)</span></span> PutRecords(streamName <span class=\"type\">string</span>, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *kinesisMock)</span></span> CreateStream(name <span class=\"type\">string</span>, shardCount <span class=\"type\">int</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *kinesisMock)</span></span> DescribeStream(name <span class=\"type\">string</span>) (resp *kinesis.StreamDescription, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *kinesisMock)</span></span> DeleteStream(name <span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>kinesis</code><code>KinesisInterface</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Logger <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">    kinesis    KinesisInterface</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Logger</code><code>kinesisMock</code><code>kinesis</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestLoggingToMockKinesis</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    assert := assert.New(t)</span><br><span class=\"line\"></span><br><span class=\"line\">    l, e := NewLogger(&amp;impression&#123;&#125;, &amp;Options&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">        UseMockKinesis: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        MockKinesis:    newKinesisMock(<span class=\"number\">0</span>),</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"AWS-Kinesis\"><a href=\"#AWS-Kinesis\" class=\"headerlink\" title=\"AWS Kinesis\"></a>AWS Kinesis</h2><p><code>kinesisMock</code><code>kinesis</code></p>\n<p><code>kinesisMock</code><code>putRecordLatency</code><code>PutRecords</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> kinesisMock <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// simulate lantency that sync to Kinesis</span></span><br><span class=\"line\">    putRecordLatency time.Duration</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *kinesisMock)</span></span> PutRecords(streamName <span class=\"type\">string</span>, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\">    time.Sleep(mock.putRecordLatency) <span class=\"comment\">// </span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>kinesis</code><code>brokenKinesisMock</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> brokenKinesisMock <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    *kinesisMock</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newBrokenKinesisMock</span><span class=\"params\">()</span></span> *brokenKinesisMock &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;brokenKinesisMock&#123;</span><br><span class=\"line\">        kinesisMock: newKinesisMock(<span class=\"number\">0</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *brokenKinesisMock)</span></span> PutRecords(streamName <span class=\"type\">string</span>, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, fmt.Errorf(<span class=\"string\">&quot;Kinesis is broken&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>kinesisMock</code><code>brokenKinesisMock</code><code>struct</code><code>brokenKinesisMock</code><code>kinesisMock</code><code>KinesisInterface</code></p>\n<h2 id=\"log-Print\"><a href=\"#log-Print\" class=\"headerlink\" title=\"log.Print\"></a><code>log.Print</code></h2><p></p>\n<ul>\n<li><code>log.Print</code><code>stdout</code></li>\n<li><code>go test</code><code>-v</code><code>log.Print</code><code>log.Print</code></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li><a href=\"http://docs.aws.amazon.com/kinesis/latest/APIReference/API_CreateStream.html\">AWS Kinesis API - CreateStream</a>Stream10+Stream</li>\n<li><a href=\"https://github.com/AdRoll/goamz/blob/master/aws/regions.go\">github.com&#x2F;AdRoll&#x2F;goamz&#x2F;aws&#x2F;regions.go</a>AWS KinesisURLAWS Kinesis</li>\n<li>Travis CIKill1CI10</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li></li>\n<li>Kinesis<code>dlog</code></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li><a href=\"http://docs.studygolang.com/doc/effective_go.html\">Effective Go</a></li>\n<li><a href=\"https://aws.amazon.com/cn/documentation/kinesis/\">Amazon Kinesis Documentation</a></li>\n<li><a href=\"http://blog.golang.org/advanced-go-concurrency-patterns\">Advanced Go Concurrency Patterns</a></li>\n<li><a href=\"https://github.com/afex/hystrix-go\">hystrix-go</a></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"http://www.augmn.com/\"></a>(<a href=\"mailto:&#x65;&#x74;&#104;&#x61;&#110;&#99;&#x61;&#105;&#x40;&#x71;&#113;&#x2e;&#x63;&#111;&#x6d;\">ethancai@qq.com</a>)</p>\n<img src=\"/2016/04/20/experiences-about-develop-dlog/2016-04-21_07-12-24.png\" class=\"\" title=\"1\">\n\n<img src=\"/2016/04/20/experiences-about-develop-dlog/2016-04-21_07-12-40.png\" class=\"\" title=\"2\">\n\n<p><strong> &#x2F; Backend Engineer</strong></p>\n<p></p>\n<ul>\n<li></li>\n<li>micro-service</li>\n<li></li>\n<li>Code Review</li>\n</ul>\n<p></p>\n<ul>\n<li></li>\n<li>GoNode.jsC++Python</li>\n<li>RESTfulRPC</li>\n<li>web serviceweb app</li>\n<li>MysqlRedisMongoDB</li>\n<li></li>\n<li></li>\n<li></li>\n<li>53</li>\n</ul>\n<p><strong> &#x2F; Senior Ops Engineer</strong></p>\n<p></p>\n<ul>\n<li>AWS</li>\n<li></li>\n<li></li>\n<li></li>\n<li>7*24</li>\n<li>IT</li>\n</ul>\n<p></p>\n<ul>\n<li>Linux&#x2F;UnixLinux</li>\n<li>TCP&#x2F;IPHTTP</li>\n<li>NginxDNSNTP</li>\n<li>ShellPythonPerl Ruby</li>\n<li>Linuxgrepawksedtmuxvim</li>\n<li>MySQL</li>\n<li></li>\n<li> 2 AWS</li>\n<li>DevOps</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n","excerpt":"","more":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><!-- TOC depthFrom:1 depthTo:2 withLinks:0 updateOnSave:1 orderedList:0 -->\n\n<ul>\n<li></li>\n<li><code>dlog</code></li>\n<li><code>dlog</code></li>\n<li><ul>\n<li><code>panic</code><code>return error</code></li>\n<li><code>logger</code><code>data log</code></li>\n<li><code>data log</code></li>\n<li><code>Logger.Log</code></li>\n<li><code>logger</code><code>msg</code><code>buf</code>AWS Kinesis</li>\n<li></li>\n<li><code>Setup</code><code>TearDown</code></li>\n<li><code>kinesisMock</code></li>\n<li>AWS Kinesis</li>\n<li><code>log.Print</code></li>\n</ul>\n</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<!-- /TOC -->\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://segmentfault.com/a/1190000002416822\"></a>Golog<a href=\"https://github.com/topicai/dlog\">dlog</a>Go</p>\n<blockquote>\n<p>Go</p>\n</blockquote>\n<h1 id=\"dlog\"><a href=\"#dlog\" class=\"headerlink\" title=\"dlog\"></a><code>dlog</code></h1><p><strong>readme</strong><code>dlog</code></p>\n<blockquote>\n<p>dlog is a Go package for distributed structure logging using Amazon AWS Kinesis&#x2F;Firehose.</p>\n</blockquote>\n<p><a href=\"https://github.com/topicai/dlog/blob/develop/README.md\">readme</a></p>\n<p><code>dlog</code><code>data log</code>Golang package<code>data log</code></p>\n<ul>\n<li><code>status log</code>Bug</li>\n<li><code>data log</code><code>data log</code></li>\n</ul>\n<h1 id=\"dlog\"><a href=\"#dlog\" class=\"headerlink\" title=\"dlog\"></a><code>dlog</code></h1><ul>\n<li><code>data log</code><code>logger</code><code>logger</code><code>data log</code></li>\n<li><code>dlog</code><ul>\n<li>AWS Kinesis</li>\n</ul>\n</li>\n<li><code>dlog</code><code>data log</code><code>dlog</code><code>dlog</code></li>\n<li>AWS KinesisAPI<a href=\"http://docs.aws.amazon.com/kinesis/latest/APIReference/API_PutRecord.html\">PutRecord</a>, <a href=\"http://docs.aws.amazon.com/kinesis/latest/APIReference/API_PutRecords.html\">PutRecords</a>Kinesis<code>data log</code><ul>\n<li><code>PutRecords</code><code>record</code><code>500</code><code>record</code>1MB<code>request</code>5MB</li>\n<li>Kinesis StreamTPSstreamshardshardTPS<code>1000 records per second</code> <code>1MB per second</code></li>\n</ul>\n</li>\n<li></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"panicreturn-error\"><a href=\"#panicreturn-error\" class=\"headerlink\" title=\"panicreturn error\"></a><code>panic</code><code>return error</code></h2><p><code>panic</code><code>return error</code></p>\n<h3 id=\"panic\"><a href=\"#panic\" class=\"headerlink\" title=\"panic\"></a><code>panic</code></h3><p><code>panic</code><code>goroutine</code><code>panic</code><code>recover</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        log.Panic(<span class=\"string\">&quot;some error before work2&quot;</span>)</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;do some work2&quot;</span>)</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">    time.Sleep(time.Second)</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;do some work1&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/off1y9tBax\"></a></em></p>\n<p><code>recover</code><code>goroutine</code><code>panic</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> err := <span class=\"built_in\">recover</span>(); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">                log.Printf(<span class=\"string\">&quot;error: %v&quot;</span>, err)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;()</span><br><span class=\"line\">        log.Panic(<span class=\"string\">&quot;some error before work2&quot;</span>)</span><br><span class=\"line\">        fmt.Println(<span class=\"string\">&quot;do some work2&quot;</span>)</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">    time.Sleep(time.Second)</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;do some work1&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/RLWyb813Uw\"></a></em></p>\n<p>Go<code>panic</code><code>recover</code>Java.NET<code>throw</code><code>try...catch</code></p>\n<h3 id=\"return-error\"><a href=\"#return-error\" class=\"headerlink\" title=\"return error\"></a><code>return error</code></h3><p><code>return error</code>Go<code>caller</code></p>\n<p><code>return error</code><code>return error</code><code>panic/recover</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;errors&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> R <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f1</span><span class=\"params\">()</span></span> (<span class=\"type\">error</span>, *R) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> errors.New(<span class=\"string\">&quot;an error&quot;</span>), <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f2</span><span class=\"params\">()</span></span> (<span class=\"type\">error</span>, *R) &#123;</span><br><span class=\"line\">    err, r := f1()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> err, <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, r</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">f3</span><span class=\"params\">()</span></span> (<span class=\"type\">error</span>, *R) &#123;</span><br><span class=\"line\">    err, r := f2()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> err, <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, r</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    err, _ := f3()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        log.Print(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/GhE5JpzZvn\"></a></em></p>\n<h3 id=\"dlog\"><a href=\"#dlog\" class=\"headerlink\" title=\"dlog\"></a><code>dlog</code></h3><p><code>panic</code><code>return error</code><code>panic</code><code>return error</code></p>\n<p><code>dlog</code><code>package</code></p>\n<ul>\n<li><code>func NewLogger(example interface&#123;&#125;, opts *Options) (*Logger, error)</code></li>\n<li><code>func (l *Logger) Log(msg interface&#123;&#125;) error</code></li>\n</ul>\n<p></p>\n<ul>\n<li><code>NewLogger</code>data log<code>NewLogger</code><code>logger</code><code>panic</code><code>return error</code><code>caller</code>Golang package</li>\n<li><code>logger.Log</code><code>Log</code><code>panic</code><ul>\n<li><code>logger.Log</code><code>return error</code><code>msg</code></li>\n<li><code>logger.Log</code>AWS KinesisAWS Kinesis<code>panic</code><code>return error</code><code>logger</code><code>handler</code><code>handler</code></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"loggerdata-log\"><a href=\"#loggerdata-log\" class=\"headerlink\" title=\"loggerdata log\"></a><code>logger</code><code>data log</code></h2><p><code>logger</code><code>data log</code></p>\n<ul>\n<li><code>Logger</code><code>msgType reflect.Type</code></li>\n<li><code>NewLogger</code><code>logger</code><code>logger</code></li>\n<li><code>Log</code><code>msg</code><code>logger</code></li>\n</ul>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// msgTypeLogger</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Logger <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    msgType    reflect.Type</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// msgreflect.Type</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">msgType</span><span class=\"params\">(msg <span class=\"keyword\">interface</span>&#123;&#125;)</span></span> (reflect.Type, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    t := reflect.TypeOf(msg)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> t.Kind() == reflect.Ptr &#123;</span><br><span class=\"line\">        t = t.Elem()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> t.Kind() != reflect.Struct &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, fmt.Errorf(<span class=\"string\">&quot;dlog message must be either *struct or struct&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> t, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewLogger</span><span class=\"params\">(example <span class=\"keyword\">interface</span>&#123;&#125;, opts *Options)</span></span> (*Logger, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    t, e := msgType(example)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> e != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, e</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    l := &amp;Logger&#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        msgType:    t,</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> l, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(l *Logger)</span></span> Log(msg <span class=\"keyword\">interface</span>&#123;&#125;) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> t, e := msgType(msg); e != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> e</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> !t.AssignableTo(l.msgType) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">&quot;parameter (%+v) not assignable to %v&quot;</span>, msg, l.msgType)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Log</code><code>AssignableTo</code><code>msg</code><code>struct</code><code>AssignableTo</code><code>True</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;log&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;reflect&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> Fn <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(<span class=\"type\">int</span>)</span></span> <span class=\"type\">int</span></span><br><span class=\"line\">    id := <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(x <span class=\"type\">int</span>)</span></span> <span class=\"type\">int</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> zeroFn Fn</span><br><span class=\"line\">    log.Println(reflect.TypeOf(id).AssignableTo(reflect.TypeOf(zeroFn)))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">type</span> MyInt <span class=\"type\">int</span></span><br><span class=\"line\">    mi := <span class=\"number\">1</span></span><br><span class=\"line\">    log.Println(reflect.TypeOf(<span class=\"number\">2</span>).AssignableTo(reflect.TypeOf(mi)))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">type</span> S1 <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">        name <span class=\"type\">string</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">type</span> S2 S1</span><br><span class=\"line\"></span><br><span class=\"line\">    s1 := S1&#123;</span><br><span class=\"line\">        name: <span class=\"string\">&quot;ethan&quot;</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    s2 := S2&#123;</span><br><span class=\"line\">        name: <span class=\"string\">&quot;ethan&quot;</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// s2 = s1\t// if uncomment this line, will report &quot;cannot use s1 (type S1) as type S2 in assignment&quot; when compile</span></span><br><span class=\"line\">    log.Println(reflect.TypeOf(s1).AssignableTo(reflect.TypeOf(s2)))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em><a href=\"https://play.golang.org/p/eDmzxW-ayk\"></a></em></p>\n<h2 id=\"data-log\"><a href=\"#data-log\" class=\"headerlink\" title=\"data log\"></a><code>data log</code></h2><p><code>buffer</code><code>message</code><code>buffer</code>AWS Kinesis<code>buffer</code>(goroutine)<code>buffer</code></p>\n<ul>\n<li><code>buffer</code></li>\n<li><code>channel</code><code>buffer</code></li>\n</ul>\n<p>Java.NETCSP(Communicating Sequential Processes)</p>\n<img src=\"/2016/04/20/experiences-about-develop-dlog/channel.png\" class=\"\" title=\"CSP Model\">\n\n<p><code>dlog</code><code>Log</code><code>msg</code><code>buffer</code><code>channel</code><code>goroutine</code><code>channel</code><code>buf := make([][]byte, 0)</code><code>buf</code>AWS Kinesis<code>flush</code>AWS Kinesis<code>goroutine</code><code>buf</code><code>buf</code></p>\n<!--\ndigraph G {\n    fontname=\"Microsoft YaHei\";\n    fontsize=10;\n    rankdir = LR;\n\n    \"buffer channel\" [shape=box];\n\n    \"Logger.Log goroutine 1\" -> \"buffer channel\";\n    \"Logger.Log goroutine 2\" -> \"buffer channel\";\n    \"Logger.Log goroutine 3\" -> \"buffer channel\";\n    \"buffer channel\" -> \"sync goroutine\";\n    \"sync goroutine\" -> \"AWS Kinesis Stream\";\n}\n-->\n\n<!-- ![Thread Model](http://g.gravizo.com/g?digraph%20G%20%7B%0A%20%20%20%20fontname%3D%22Microsoft%20YaHei%22%3B%0A%20%20%20%20fontsize%3D10%3B%0A%20%20%20%20rankdir%20%3D%20LR%3B%0A%0A%20%20%20%20%22buffer%20channel%22%20%5Bshape%3Dbox%5D%3B%0A%0A%20%20%20%20%22Logger.Log%20goroutine%201%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22Logger.Log%20goroutine%202%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22Logger.Log%20goroutine%203%22%20-%3E%20%22buffer%20channel%22%3B%0A%20%20%20%20%22buffer%20channel%22%20-%3E%20%22sync%20goroutine%22%3B%0A%20%20%20%20%22sync%20goroutine%22%20-%3E%20%22AWS%20Kinesis%20Stream%22%3B%0A%20%7D) -->\n\n<img src=\"/2016/04/20/experiences-about-develop-dlog/use_channel.png\" class=\"\" title=\"Channel\">\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewLogger</span><span class=\"params\">(example <span class=\"keyword\">interface</span>&#123;&#125;, opts *Options)</span></span> (*Logger, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">go</span> l.sync()    <span class=\"comment\">// sync goroutine</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> l, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(l *Logger)</span></span> Log(msg <span class=\"keyword\">interface</span>&#123;&#125;) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    en := encode(msg)       <span class=\"comment\">// msg</span></span><br><span class=\"line\">    ...</span><br><span class=\"line\">        <span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> l.buffer &lt;- en:    <span class=\"comment\">// buffer channelmsg</span></span><br><span class=\"line\">        ...</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(l *Logger)</span></span> sync() &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    buf := <span class=\"built_in\">make</span>([][]<span class=\"type\">byte</span>, <span class=\"number\">0</span>) <span class=\"comment\">// buffer channel</span></span><br><span class=\"line\">    bufSize := <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> msg := &lt;-l.buffer:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> bufSize+<span class=\"built_in\">len</span>(msg)+partitionKeySize &gt;= maxBatchSize &#123;  <span class=\"comment\">// buf</span></span><br><span class=\"line\">                l.flush(&amp;buf, &amp;bufSize)                             <span class=\"comment\">// AWS Kinesis</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            buf = <span class=\"built_in\">append</span>(buf, msg)                                  <span class=\"comment\">// buffer channelbuf</span></span><br><span class=\"line\">            bufSize += <span class=\"built_in\">len</span>(msg) + partitionKeySize</span><br><span class=\"line\"></span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Logger-Log\"><a href=\"#Logger-Log\" class=\"headerlink\" title=\"Logger.Log\"></a><code>Logger.Log</code></h2><p>IO<code>caller</code></p>\n<p><code>Logger.Log</code>Go<code>channel</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(l *Logger)</span></span> Log(msg <span class=\"keyword\">interface</span>&#123;&#125;) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> timeout &lt;-<span class=\"keyword\">chan</span> time.Time</span><br><span class=\"line\">    <span class=\"keyword\">if</span> l.WriteTimeout &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        timeout = time.After(l.WriteTimeout)    <span class=\"comment\">// l.WriteTimeout</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">        <span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> l.buffer &lt;- en:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> &lt;-timeout: <span class=\"comment\">// timeoutcase</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">&quot;dlog writes %+v timeout after %v&quot;</span>, msg, l.WriteTimeout)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Java.NETGo</p>\n<ul>\n<li>C#<ul>\n<li><a href=\"http://weblogs.asp.net/israelio/159985\">Implementing .Net method timeout</a></li>\n<li><a href=\"http://stackoverflow.com/questions/18646650/how-to-implement-task-async-for-a-timer-in-c\">How to implement Task Async for a timer in C#?</a></li>\n<li><a href=\"http://stackoverflow.com/questions/10143980/implementing-a-timeout-in-c-sharp\">Implementing a timeout in c#</a></li>\n</ul>\n</li>\n<li>Java<ul>\n<li><a href=\"http://www.coderanch.com/t/232213/threads/java/implement-timeout-threads\">How to implement timeout using threads</a></li>\n<li><a href=\"http://stackoverflow.com/questions/2275443/how-to-timeout-a-thread\">How to timeout a thread</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"loggermsgbufAWS-Kinesis\"><a href=\"#loggermsgbufAWS-Kinesis\" class=\"headerlink\" title=\"loggermsgbufAWS Kinesis\"></a><code>logger</code><code>msg</code><code>buf</code>AWS Kinesis</h2><p><code>dlog</code><code>Logger.sync()</code><code>buf</code>AWS Kinesis</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(l *Logger)</span></span> sync() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> l.SyncPeriod &lt;= <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        l.SyncPeriod = time.Second</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ticker := time.NewTicker(l.SyncPeriod)  <span class=\"comment\">// l.SyncPeriodticker</span></span><br><span class=\"line\"></span><br><span class=\"line\">    buf := <span class=\"built_in\">make</span>([][]<span class=\"type\">byte</span>, <span class=\"number\">0</span>)</span><br><span class=\"line\">    bufSize := <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> &#123;  <span class=\"comment\">// sync goroutine</span></span><br><span class=\"line\">        <span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> msg := &lt;-l.buffer:</span><br><span class=\"line\">            ...</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">case</span> &lt;-ticker.C: <span class=\"comment\">// ticker.C&lt;-chan Timel.SyncPeriodcase</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> bufSize &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">                l.flush(&amp;buf, &amp;bufSize)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>ticker</code><code>dlog</code><code>msg</code><code>buf</code><code>l.SyncPeriod</code>AWS Kinesis</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>GoPackage <code>expvar</code><code>expvar</code>HTTP<code>/debug/vars</code>JSON<code>expvar</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;encoding/json&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;expvar&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;net/http&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">    <span class=\"string\">&quot;time&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Stats is used to collect runtime metrics</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Stats <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    sync.Mutex</span><br><span class=\"line\">    TotalHit  <span class=\"type\">int</span></span><br><span class=\"line\">    ErrorNums <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *Stats)</span></span> IncreaseTotalHit(i <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">    s.Lock()</span><br><span class=\"line\">    <span class=\"keyword\">defer</span> s.Unlock()</span><br><span class=\"line\"></span><br><span class=\"line\">    s.TotalHit += i</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *Stats)</span></span> IncreaseErrorNums(i <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">    s.Lock()</span><br><span class=\"line\">    <span class=\"keyword\">defer</span> s.Unlock()</span><br><span class=\"line\"></span><br><span class=\"line\">    s.ErrorNums += i</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *Stats)</span></span> String() <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">    s.Lock()</span><br><span class=\"line\">    <span class=\"keyword\">defer</span> s.Unlock()</span><br><span class=\"line\"></span><br><span class=\"line\">    b, err := json.Marshal(*s)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&#123;&#125;&quot;</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">string</span>(b)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> (</span><br><span class=\"line\">    stats *Stats</span><br><span class=\"line\">    hits  *expvar.Map</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">init</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    expvar.Publish(<span class=\"string\">&quot;now&quot;</span>, expvar.Func(<span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> <span class=\"keyword\">interface</span>&#123;&#125; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> time.Now().Format(<span class=\"string\">&quot;\\&quot;2006-01-02 15:04:05\\&quot;&quot;</span>)</span><br><span class=\"line\">    &#125;))</span><br><span class=\"line\"></span><br><span class=\"line\">    stats = &amp;Stats&#123;&#125;</span><br><span class=\"line\">    expvar.Publish(<span class=\"string\">&quot;stats&quot;</span>, stats)</span><br><span class=\"line\"></span><br><span class=\"line\">    hits = expvar.NewMap(<span class=\"string\">&quot;hits&quot;</span>).Init()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">homeHandler</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">    p := r.URL.Path[<span class=\"number\">1</span>:]</span><br><span class=\"line\">    hits.Add(p, <span class=\"number\">1</span>)</span><br><span class=\"line\">    stats.IncreaseTotalHit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    fmt.Fprintf(w, <span class=\"string\">&quot;Hey! I love %s! hits: %v\\n&quot;</span>, p, hits.Get(p))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">errHandler</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">    stats.IncreaseErrorNums(<span class=\"number\">1</span>)</span><br><span class=\"line\">    fmt.Fprintf(w, <span class=\"string\">&quot;Error Nums: %v\\n&quot;</span>, stats.ErrorNums)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    http.HandleFunc(<span class=\"string\">&quot;/err&quot;</span>, errHandler)</span><br><span class=\"line\">    http.HandleFunc(<span class=\"string\">&quot;/&quot;</span>, homeHandler)</span><br><span class=\"line\">    http.ListenAndServe(<span class=\"string\">&quot;:8080&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li><code>go run expvarexample.go</code></li>\n<li><code>http://localhost:8080/ethan</code></li>\n<li><code>http://localhost:8080/err</code></li>\n<li><code>http://localhost:8080/debug/vars</code></li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;cmdline&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"string\">&quot;/var/folders/jf/65ft181j33j_d75ktgv67bsc0000gn/T/go-build467453980/command-line-arguments/_obj/exe/expvarsample&quot;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;ethan&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;favicon.ico&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;memstats&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span> ... <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;now&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;\\&quot;2016-04-19 20:17:40\\&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;stats&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;TotalHit&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;ErrorNums&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://github.com/divan/expvarmon\">expvarmon</a><code>expvar</code></p>\n<ul>\n<li><code>go get github.com/divan/expvarmon</code></li>\n<li><code>expvarmon -ports=&quot;8080&quot; -vars=&quot;hits.ethan,stats.TotalHit,stats.ErrorNums,now&quot;</code></li>\n<li></li>\n</ul>\n<img src=\"/2016/04/20/experiences-about-develop-dlog/expvarmon_screen.png\" class=\"\" title=\"expvarmon screen\">\n\n<p><code>dlog</code><code>expvar</code><code>dlog</code></p>\n<ul>\n<li><code>writtenRecords</code>: AWS Kinesis<code>msg</code></li>\n<li><code>writtenBatches</code>: AWS KinesisAPI</li>\n<li><code>failedRecords</code>: AWS Kinesis<code>msg</code></li>\n<li><code>tooBigMesssages</code>: (partitionKeySize1MB)<code>msg</code></li>\n</ul>\n<p></p>\n<h2 id=\"SetupTearDown\"><a href=\"#SetupTearDown\" class=\"headerlink\" title=\"SetupTearDown\"></a><code>Setup</code><code>TearDown</code></h2><p>Go<strong></strong><code>go test</code><code>testing</code> package<a href=\"http://docs.studygolang.com/doc/code.html#Testing\"></a>Go</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//$GOPATH/src/github.com/user/stringutil/reverse_test.go</span></span><br><span class=\"line\"><span class=\"keyword\">package</span> stringutil</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;testing&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestReverse</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    cases := []<span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">        in, want <span class=\"type\">string</span></span><br><span class=\"line\">    &#125;&#123;</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;Hello, world&quot;</span>, <span class=\"string\">&quot;dlrow ,olleH&quot;</span>&#125;,</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;Hello, &quot;</span>, <span class=\"string\">&quot; ,olleH&quot;</span>&#125;,</span><br><span class=\"line\">        &#123;<span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>&#125;,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> _, c := <span class=\"keyword\">range</span> cases &#123;</span><br><span class=\"line\">        got := Reverse(c.in)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> got != c.want &#123;</span><br><span class=\"line\">            t.Errorf(<span class=\"string\">&quot;Reverse(%q) == %q, want %q&quot;</span>, c.in, got, c.want)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"keyword\">go</span> test github.com/user/stringutil</span><br><span class=\"line\">ok  \tgithub.com/user/stringutil <span class=\"number\">0.165</span>s</span><br></pre></td></tr></table></figure>\n\n<p>IaaS<a href=\"https://github.com/stretchr/testify/suite\">testify&#x2F;suite</a> package<a href=\"https://github.com/stretchr/testify/suite\">testify&#x2F;suite</a><code>struct</code><code>setup</code>()&#x2F;<code>teardown</code>()<code>go test</code></p>\n<p><a href=\"https://github.com/stretchr/testify/suite\">testify&#x2F;suite</a></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> suite</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">    <span class=\"string\">&quot;testing&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"string\">&quot;github.com/stretchr/testify/assert&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> SuiteTester <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Include our basic suite logic.</span></span><br><span class=\"line\">    Suite</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Other properties</span></span><br><span class=\"line\">    propertyN <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The SetupSuite method will be run by testify once, at the very</span></span><br><span class=\"line\"><span class=\"comment\">// start of the testing suite, before any tests are run.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> SetupSuite() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The TearDownSuite method will be run by testify once, at the very</span></span><br><span class=\"line\"><span class=\"comment\">// end of the testing suite, after all tests have been run.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> TearDownSuite() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The SetupTest method will be run before every test in the suite.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> SetupTest() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The TearDownTest method will be run after every test in the suite.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> TearDownTest() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// a test method</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> TestOne() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// another test method</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(suite *SuiteTester)</span></span> TestTwo() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// TestRunSuite will be run by the &#x27;go test&#x27; command, so within it, we</span></span><br><span class=\"line\"><span class=\"comment\">// can run our suite using the Run(*testing.T, TestingSuite) function.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestRunSuite</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    suiteTester := <span class=\"built_in\">new</span>(SuiteTester)</span><br><span class=\"line\">    Run(t, suiteTester)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>dlog</code><code>Logger.Log</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> dlog</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> WriteLogSuiteTester <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    suite.Suite</span><br><span class=\"line\"></span><br><span class=\"line\">    options     *Options</span><br><span class=\"line\">    seachLogger *Logger</span><br><span class=\"line\">    clickLogger *Logger</span><br><span class=\"line\">    streamNames []<span class=\"type\">string</span> <span class=\"comment\">// save the created AWS Kinesis Streams, which will be removed in TearDownSuite()</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The SetupSuite method will be run by testify once, at the very</span></span><br><span class=\"line\"><span class=\"comment\">// start of the testing suite, before any tests are run.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *WriteLogSuiteTester)</span></span> SetupSuite() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// create stream 1</span></span><br><span class=\"line\">    err = s.seachLogger.kinesis.CreateStream(s.seachLogger.streamName, testingShardCount)</span><br><span class=\"line\">    s.Nil(err)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// create stream 2</span></span><br><span class=\"line\">    err = s.clickLogger.kinesis.CreateStream(s.clickLogger.streamName, testingShardCount)</span><br><span class=\"line\">    s.Nil(err)</span><br><span class=\"line\"></span><br><span class=\"line\">    s.streamNames = []<span class=\"type\">string</span>&#123;s.seachLogger.streamName, s.clickLogger.streamName&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> &#123; <span class=\"comment\">// waiting created stream&#x27;s status to be active</span></span><br><span class=\"line\">        time.Sleep(<span class=\"number\">1</span> * time.Second)</span><br><span class=\"line\">        resp1, err1 := s.seachLogger.kinesis.DescribeStream(s.seachLogger.streamName)</span><br><span class=\"line\">        s.Nil(err1)</span><br><span class=\"line\"></span><br><span class=\"line\">        resp2, err2 := s.seachLogger.kinesis.DescribeStream(s.clickLogger.streamName)</span><br><span class=\"line\">        s.Nil(err2)</span><br><span class=\"line\"></span><br><span class=\"line\">        status1 := strings.ToLower(<span class=\"type\">string</span>(resp1.StreamStatus))</span><br><span class=\"line\">        status2 := strings.ToLower(<span class=\"type\">string</span>(resp2.StreamStatus))</span><br><span class=\"line\">        <span class=\"keyword\">if</span> status1 == <span class=\"string\">&quot;active&quot;</span> &amp;&amp; status2 == <span class=\"string\">&quot;active&quot;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// The TearDownSuite method will be run by testify once, at the very</span></span><br><span class=\"line\"><span class=\"comment\">// end of the testing suite, after all tests have been run.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *WriteLogSuiteTester)</span></span> TearDownSuite() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> s.streamNames == <span class=\"literal\">nil</span> || <span class=\"built_in\">len</span>(s.streamNames) == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> _, streamName := <span class=\"keyword\">range</span> s.streamNames &#123;</span><br><span class=\"line\">        err := s.seachLogger.kinesis.DeleteStream(streamName)</span><br><span class=\"line\">        s.Nil(err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(s *WriteLogSuiteTester)</span></span> TestWriteLog() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123; <span class=\"comment\">// Recover if panicking to make sure TearDownSuite will be executed</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> r := <span class=\"built_in\">recover</span>(); r != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">            s.Fail(fmt.Sprint(r))</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestRunWriteLogSuite</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    suiteTester := <span class=\"built_in\">new</span>(WriteLogSuiteTester)</span><br><span class=\"line\">    suite.Run(t, suiteTester)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<ul>\n<li></li>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"kinesisMock\"><a href=\"#kinesisMock\" class=\"headerlink\" title=\"kinesisMock\"></a><code>kinesisMock</code></h2><p>Mock</p>\n<p><code>dlog</code><code>KinesisInterface</code>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> KinesisInterface <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">    PutRecords(streamName <span class=\"type\">string</span>, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err <span class=\"type\">error</span>)</span><br><span class=\"line\">    CreateStream(name <span class=\"type\">string</span>, shardCount <span class=\"type\">int</span>) <span class=\"type\">error</span></span><br><span class=\"line\">    DescribeStream(name <span class=\"type\">string</span>) (resp *kinesis.StreamDescription, err <span class=\"type\">error</span>)</span><br><span class=\"line\">    DeleteStream(name <span class=\"type\">string</span>) <span class=\"type\">error</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>KinesisInterface</code><code>dlog</code><a href=\"https://github.com/AdRoll/goamz/blob/master/kinesis/kinesis.go\">github.com&#x2F;AdRoll&#x2F;goamz&#x2F;kinesis&#x2F;kinesis</a>Go<code>interface</code><strong></strong><a href=\"https://github.com/AdRoll/goamz/blob/master/kinesis/kinesis.go\">github.com&#x2F;AdRoll&#x2F;goamz&#x2F;kinesis&#x2F;kinesis</a><code>KinesisInterface</code><code>kinesisMock</code><code>KinesisInterface</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> kinesisMock <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Mapping from steam name to batches of batches</span></span><br><span class=\"line\">    storage <span class=\"keyword\">map</span>[<span class=\"type\">string</span>][][]kinesis.PutRecordsRequestEntry</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// simulate lantency that sync to Kinesis</span></span><br><span class=\"line\">    putRecordLatency time.Duration</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// created streams&#x27; names</span></span><br><span class=\"line\">    streamNames []<span class=\"type\">string</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// lock to solve concurrent call</span></span><br><span class=\"line\">    lock sync.RWMutex</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newKinesisMock</span><span class=\"params\">(putRecordsLatency time.Duration)</span></span> *kinesisMock &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;kinesisMock&#123;</span><br><span class=\"line\">        storage:          <span class=\"built_in\">make</span>(<span class=\"keyword\">map</span>[<span class=\"type\">string</span>][][]kinesis.PutRecordsRequestEntry),</span><br><span class=\"line\">        putRecordLatency: putRecordsLatency,</span><br><span class=\"line\">        streamNames:      <span class=\"built_in\">make</span>([]<span class=\"type\">string</span>, <span class=\"number\">0</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *kinesisMock)</span></span> PutRecords(streamName <span class=\"type\">string</span>, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *kinesisMock)</span></span> CreateStream(name <span class=\"type\">string</span>, shardCount <span class=\"type\">int</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *kinesisMock)</span></span> DescribeStream(name <span class=\"type\">string</span>) (resp *kinesis.StreamDescription, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *kinesisMock)</span></span> DeleteStream(name <span class=\"type\">string</span>) <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>kinesis</code><code>KinesisInterface</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Logger <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">    kinesis    KinesisInterface</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Logger</code><code>kinesisMock</code><code>kinesis</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">TestLoggingToMockKinesis</span><span class=\"params\">(t *testing.T)</span></span> &#123;</span><br><span class=\"line\">    assert := assert.New(t)</span><br><span class=\"line\"></span><br><span class=\"line\">    l, e := NewLogger(&amp;impression&#123;&#125;, &amp;Options&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">        UseMockKinesis: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        MockKinesis:    newKinesisMock(<span class=\"number\">0</span>),</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"AWS-Kinesis\"><a href=\"#AWS-Kinesis\" class=\"headerlink\" title=\"AWS Kinesis\"></a>AWS Kinesis</h2><p><code>kinesisMock</code><code>kinesis</code></p>\n<p><code>kinesisMock</code><code>putRecordLatency</code><code>PutRecords</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> kinesisMock <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// simulate lantency that sync to Kinesis</span></span><br><span class=\"line\">    putRecordLatency time.Duration</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *kinesisMock)</span></span> PutRecords(streamName <span class=\"type\">string</span>, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\"></span><br><span class=\"line\">    time.Sleep(mock.putRecordLatency) <span class=\"comment\">// </span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>kinesis</code><code>brokenKinesisMock</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> brokenKinesisMock <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    *kinesisMock</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newBrokenKinesisMock</span><span class=\"params\">()</span></span> *brokenKinesisMock &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;brokenKinesisMock&#123;</span><br><span class=\"line\">        kinesisMock: newKinesisMock(<span class=\"number\">0</span>),</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(mock *brokenKinesisMock)</span></span> PutRecords(streamName <span class=\"type\">string</span>, records []kinesis.PutRecordsRequestEntry) (resp *kinesis.PutRecordsResponse, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, fmt.Errorf(<span class=\"string\">&quot;Kinesis is broken&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>kinesisMock</code><code>brokenKinesisMock</code><code>struct</code><code>brokenKinesisMock</code><code>kinesisMock</code><code>KinesisInterface</code></p>\n<h2 id=\"log-Print\"><a href=\"#log-Print\" class=\"headerlink\" title=\"log.Print\"></a><code>log.Print</code></h2><p></p>\n<ul>\n<li><code>log.Print</code><code>stdout</code></li>\n<li><code>go test</code><code>-v</code><code>log.Print</code><code>log.Print</code></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li><a href=\"http://docs.aws.amazon.com/kinesis/latest/APIReference/API_CreateStream.html\">AWS Kinesis API - CreateStream</a>Stream10+Stream</li>\n<li><a href=\"https://github.com/AdRoll/goamz/blob/master/aws/regions.go\">github.com&#x2F;AdRoll&#x2F;goamz&#x2F;aws&#x2F;regions.go</a>AWS KinesisURLAWS Kinesis</li>\n<li>Travis CIKill1CI10</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li></li>\n<li>Kinesis<code>dlog</code></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li><a href=\"http://docs.studygolang.com/doc/effective_go.html\">Effective Go</a></li>\n<li><a href=\"https://aws.amazon.com/cn/documentation/kinesis/\">Amazon Kinesis Documentation</a></li>\n<li><a href=\"http://blog.golang.org/advanced-go-concurrency-patterns\">Advanced Go Concurrency Patterns</a></li>\n<li><a href=\"https://github.com/afex/hystrix-go\">hystrix-go</a></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"http://www.augmn.com/\"></a>(<a href=\"mailto:&#x65;&#x74;&#104;&#x61;&#110;&#99;&#x61;&#105;&#x40;&#x71;&#113;&#x2e;&#x63;&#111;&#x6d;\">ethancai@qq.com</a>)</p>\n<img src=\"/2016/04/20/experiences-about-develop-dlog/2016-04-21_07-12-24.png\" class=\"\" title=\"1\">\n\n<img src=\"/2016/04/20/experiences-about-develop-dlog/2016-04-21_07-12-40.png\" class=\"\" title=\"2\">\n\n<p><strong> &#x2F; Backend Engineer</strong></p>\n<p></p>\n<ul>\n<li></li>\n<li>micro-service</li>\n<li></li>\n<li>Code Review</li>\n</ul>\n<p></p>\n<ul>\n<li></li>\n<li>GoNode.jsC++Python</li>\n<li>RESTfulRPC</li>\n<li>web serviceweb app</li>\n<li>MysqlRedisMongoDB</li>\n<li></li>\n<li></li>\n<li></li>\n<li>53</li>\n</ul>\n<p><strong> &#x2F; Senior Ops Engineer</strong></p>\n<p></p>\n<ul>\n<li>AWS</li>\n<li></li>\n<li></li>\n<li></li>\n<li>7*24</li>\n<li>IT</li>\n</ul>\n<p></p>\n<ul>\n<li>Linux&#x2F;UnixLinux</li>\n<li>TCP&#x2F;IPHTTP</li>\n<li>NginxDNSNTP</li>\n<li>ShellPythonPerl Ruby</li>\n<li>Linuxgrepawksedtmuxvim</li>\n<li>MySQL</li>\n<li></li>\n<li> 2 AWS</li>\n<li>DevOps</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n"},{"title":"GoError Handling in Go","date":"2017-12-29T02:23:06.000Z","_content":"\n\n\n{% asset_img d2a2d12e1a00f819d7fd7af4b536efa2.png %}\n<small>_ {% link \"go proverbs\" https://go-proverbs.github.io/ %}_</small>\n\n\n# \n\n\n\nGoJavaC#`try...catch`\n\n\n\n\n# Go\n\n`error``interface`:\n\n```go\ntype error interface {\n    Error() string\n}\n```\n\n`error`:\n\n```go\n// example 1\nfunc Sqrt(f float64) (float64, error) {\n    if f < 0 {\n        return 0, errors.New(\"math: square root of negative number\")\n    }\n    // implementation\n}\n\n// example 2\nif f < 0 {\n    return 0, fmt.Errorf(\"math: square root of negative number %g\", f)\n}\n```\n\n`error`:\n\n```go\n// errorString is a trivial implementation of error.\ntype errorString struct {\n    s string\n}\n\nfunc (e *errorString) Error() string {\n    return e.s\n}\n```\n\n`error``net.Error`\n\n```go\npackage net\n\ntype Error interface {\n    error\n    Timeout() bool   // Is the error a timeout?\n    Temporary() bool // Is the error temporary?\n}\n```\n\n\n\n```go\nif nerr, ok := err.(net.Error); ok && nerr.Temporary() {\n    time.Sleep(1e9)\n    continue\n}\nif err != nil {\n    log.Fatal(err)\n}\n```\n\n# \n\n\n\n- \n- \n- \n- stack strace\n\nGo\n\n\n## \n\nGo\n\n- ****`func`\n- ****\n- ****\n\n\n### \n\n[C Error Codes in Linux](http://www.virtsync.com/c-error-codes-include-errno)\n\ngo\n\n- `io.EOF`: [](https://github.com/golang/go/blob/master/src/io/io.go#L38)\n- `syscall.ENOENT`: [](https://github.com/golang/go/blob/master/src/syscall/zerrors_linux_amd64.go#L1280)\n- `go/build.NoGoError`: [](https://github.com/golang/go/blob/master/src/go/build/build.go#L446)\n- `path/filepath.SkipDir`: [](https://github.com/golang/go/blob/master/src/path/filepath/path.go#L331)\n\n<u></u>\n\n```go\nbuf := make([]byte, 100)\nn, err := r.Read(buf)   //  r.Read error io.END io.EOF r.Read \nbuf = buf[:n]\nif err == io.EOF {\n    log.Fatal(\"read failed:\", err)\n}\n```\n\n`Error()`\n\n```go\nfunc readfile(path string) error {\n    err := openfile(path)\n    if err != nil {\n        return fmt.Errorf(\"cannot open file: %v\", err)\n    }\n    //...\n}\n\nfunc main() {\n    err := readfile(\".bashrc\")\n    if strings.Contains(error.Error(), \"not found\") {\n        // handle error\n    }\n}\n```\n\n> **`error` interface  `Error` `Error``Error`**\n\nAPI`public`\n\n\n\n\n### \n\n\n\n```go\n// \ntype MyError struct {\n    Msg string\n    File string\n    Line int\n}\n\nfunc (e *MyError) Error() string {\n    return fmt.Sprintf(\"%s:%d: %s\", e.File, e.Line, e.Msg)\n}\n\n\n// \nfunc doSomething() {\n    // do something\n    return &MyError{\"Something happened\", \"server.go\", 42}\n}\n\n// \nerr := doSomething()\nif err, ok := err.(SomeType); ok {    //   \n    //...\n}\n```\n\n  `os.PathError`\n\n```go\n// PathError records an error and the operation\n// and file path that caused it.\ntype PathError struct {\n    Op string\n    Path string\n    Err error\n}\n\nfunc (e *PathError) Error() string\n```\n\n\n\n\n### \n\n\n\n**** \n\n```go\nimport github.com/quux/bar\n\nfunc fn() error {\n    x, err := bar.Foo()\n    if err != nil {\n        return err\n    }\n    // use x\n}\n```\n\n`Foo``Foo``Foo`\n\n\n## \n\n\n\n- `stack trace`\n- \n    - \n    - \n\n\n### \n\n```go\nfunc AuthenticateRequest(r *Request) error {\n    err := authenticate(r.User)\n    if err != nil {\n        return err  // No such file or directory\n    }\n    return nil\n}\n```\n\n\"No such file or directory\"\n\n\n\n```go\nfunc AuthenticateRequest(r *Request) error {\n    err := authenticate(r.User)\n    if err != nil {\n        return fmt.Errorf(\"authenticate failed: %v\", err)    // authenticate failed: No such file or directory\n    }\n    return nil\n}\n```\n\n`fmt.Errorf`\n\ngoErrorHandlingSample](https://github.com/EthanCai/goErrorHandlingSample)repo\n\n```\n> go run sample1/main.go\n\nopen ~/.settings.xml: no such file or directory\nexit status 1\n```\n\n```\n> go run sample2/main.go\n\ncould not read config: open failed: open ~/.settings.xml: no such file or directory\nexit status 1\n```\n\n```\n> go run sample3/main.go\n\ncould not read config: open failed: open ~/.settings.xml: no such file or directory\nexit status 1\n```\n\n```\n> go run sample4/main.go\n\nopen ~/.settings.xml: no such file or directory\nopen failed\nmain.ReadFile\n        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:15\nmain.ReadConfig\n        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:27\nmain.main\n        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:32\nruntime.main\n        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/proc.go:195\nruntime.goexit\n        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/asm_amd64.s:2337\ncould not read config\nmain.ReadConfig\n        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:28\nmain.main\n        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:32\nruntime.main\n        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/proc.go:195\nruntime.goexit\n        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/asm_amd64.s:2337\nexit status 1\n\n```\n\n`sample4/main.go`\n\n\n### \n\n\n\n<u></u>\n\n```go\ntype temporary interface {\n    Temporary() bool    // IsTemporary returns true if err is temporary.\n}\n\nfunc IsTemporary(err error) bool {\n    te, ok := err.(temporary)\n    return ok && te.Temporary()\n}\n```\n\n`package``error``error``package`\n\n\n### \n\n\n\n```go\nfunc Write(w io.Writer, buf []byte) {\n    w.Write(buf)    // Write(p []byte) (n int, err error)Write https://golang.org/pkg/io/#Writer\n}\n```\n\n\n\n```go\nfunc Write(w io.Writer, buf []byte) error {\n    _, err := w.Write(buf)\n    if err != nil {\n        log.Println(\"unable to write:\", err)    // 1\n\n        return err\n    }\n    return nil\n}\n\nfunc main() {\n    // create writer and read data into buf\n\n    err := Write(w, buf)\n    if err != nil {\n        log.Println(\"Write error:\", err)        // 2\n        os.Exit(1)\n    }\n\n    os.Exit(0)\n}\n```\n\n## \n\n\n\n* \n* metrics\n\n# Package `github.com/pkg/errors` \n\n [`github.com/pkg/errors`](https://github.com/pkg/errors) API\n\n```go\n// errors.go\n\n// New returns an error with the supplied message.\n// New also records the stack trace at the point it was called.\nfunc New(message string) error\n\n// Errorf formats according to a format specifier and returns the string\n// as a value that satisfies error.\n// Errorf also records the stack trace at the point it was called.\nfunc Errorf(format string, args ...interface{}) error\n\n// WithStack annotates err with a stack trace at the point WithStack was called.\n// If err is nil, WithStack returns nil.\nfunc WithStack(err error) error\n\n// Wrap returns an error annotating err with a stack trace\n// at the point Wrap is called, and the supplied message.\n// If err is nil, Wrap returns nil.\nfunc Wrap(err error, message string) error\n\n// Wrapf returns an error annotating err with a stack trace\n// at the point Wrapf is called, and the format specifier.\n// If err is nil, Wrapf returns nil.\nfunc Wrapf(err error, format string, args ...interface{}) error\n\n// WithMessage annotates err with a new message.\n// If err is nil, WithMessage returns nil.\nfunc WithMessage(err error, message string) error\n\n// WithMessagef annotates err with the format specifier.\n// If err is nil, WithMessagef returns nil.\nfunc WithMessagef(err error, format string, args ...interface{}) error\n\n// Cause returns the underlying cause of the error, if possible.\n// An error value has a cause if it implements the following\n// interface:\n//\n//     type causer interface {\n//            Cause() error\n//     }\n//\n// If the error does not implement Cause, the original error will\n// be returned. If the error is nil, nil will be returned without further\n// investigation.\nfunc Cause(err error) error\n\n\n\n//  go113.go \n\n// Is reports whether any error in err's chain matches target.\n//\n// The chain consists of err itself followed by the sequence of errors obtained by\n// repeatedly calling Unwrap.\n//\n// An error is considered to match a target if it is equal to that target or if\n// it implements a method Is(error) bool such that Is(target) returns true.\nfunc Is(err, target error) bool\n\n// As finds the first error in err's chain that matches target, and if so, sets\n// target to that error value and returns true.\n//\n// The chain consists of err itself followed by the sequence of errors obtained by\n// repeatedly calling Unwrap.\n//\n// An error matches target if the error's concrete value is assignable to the value\n// pointed to by target, or if the error has a method As(interface{}) bool such that\n// As(target) returns true. In the latter case, the As method is responsible for\n// setting target.\n//\n// As will panic if target is not a non-nil pointer to either a type that implements\n// error, or to any interface type. As returns false if err is nil.\nfunc As(err error, target interface{}) bool\n\n// Unwrap returns the result of calling the Unwrap method on err, if err's\n// type contains an Unwrap method returning error.\n// Otherwise, Unwrap returns nil.\nfunc Unwrap(err error) error\n```\n\n[`example_test.go`](https://github.com/pkg/errors/blob/master/example_test.go)\n\n# \n\n## error\n\nerror\n\n****\n\n*Bad*\n\n```go\nif err == EOF {\n}\n```\n\n*Good*\n\n```go\nif errors.Is(err, EOF) {\t// it will succeed if err wraps EOF\n}\n```\n\n## error\n\nerror\n\n****\n\n*Bad*\n\n```go\nnerr, ok := err.(*CError)\nif ok {\n}\n```\n\n*Good*\n\n```go\nvar nerr *CError\nif errors.As(err, &nerr) {\t// it will succeed if err wraps an *CError\n  \t// nerr is set as *CError\n  ...\n}\n```\n\n## error\n\n****\n\n*Bad*\n\n```go\n// package io\nvar FileNotFoundErr = fmt.Errorf(\"file not found\")\n\n// package service\nif errors.Is(err, io.FileNotFoundErr) {\n}\n```\n\n*Good*\n\n```go\n// package io\nvar fileNotFoundErr = fmt.Errorf(\"file not found\")\nfunc IsFileNotFoundErr(err) bool {\n  return errors.Is(err, fileNotFoundErr)\n}\n\n// package service\nif io.IsFileNotFoundErr(err) {\n}\n```\n\n##   \n\n\n\n*  DB `panic`\n*  `panic`\n\n## AB\n\nB`message``stack trace` \n\nB\n\n* AC webB`stack trace`\n* ABB `message``stack trace`\n\n## gormormerror\n\ngormormerror\n\n*   \n* `err != gorm.errnotfound`\n\n\n\n```go\n// Dao\nfunc GetByID(id int) (*Object, error) {\n\t\t// \n\n    if err != nil && err != gorm.ErrRecordNotFound {\n        return nil, err//  err ErrRecordNotFound\n    }\n\n    if err == gorm.ErrRecordNotFound {\n        return nil, nil\n    }\n\n    return &result, nil\n}\n```\n\n# \n\n\n\n- \n\n- \n\n\n\n\n# \n\n- The Go Blog\n    - [Error handling in Go](https://blog.golang.org/error-handling-and-go)\n    - [Defer, Panic, and Recover](https://blog.golang.org/defer-panic-and-recover)\n- Dave Cheney\n    - [presentation on my philosophy for error handling](https://dave.cheney.net/paste/gocon-spring-2016.pdf)\n    - [Dont just check errors, handle them gracefully](https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully)\n    - [Stack traces and the errors package](https://dave.cheney.net/2016/06/12/stack-traces-and-the-errors-package)\n- Go Packages\n    - [errors](https://golang.org/pkg/errors/)\n    - [runtime](https://golang.org/pkg/runtime/)\n- pkg: Artisanal, hand crafted, barrel aged, Go packages\n    - [github.com/pkg/errors](https://godoc.org/github.com/pkg/errors)\n- [Go 2 Draft Designs](https://go.googlesource.com/proposal/+/master/design/go2draft.md)\n    + [go2draft-error-handling-overview.md](https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-handling-overview.md)\n    + [go2draft-error-handling.md](https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-handling.md)\n    + [go2draft-error-inspection.md](https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-inspection.md)\n    + [go2draft-error-printing.md](https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-printing.md)\n    + [go2draft-error-values-overview.md](https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-values-overview.md)\n\n","source":"_posts/2017-12-29-error-handling-in-go.md","raw":"---\ntitle: GoError Handling in Go\ncategories:\n  - \ntags:\n  - golang\ndate: 2017-12-29 10:23:06\n---\n\n\n\n{% asset_img d2a2d12e1a00f819d7fd7af4b536efa2.png %}\n<small>_ {% link \"go proverbs\" https://go-proverbs.github.io/ %}_</small>\n\n\n# \n\n\n\nGoJavaC#`try...catch`\n\n\n\n\n# Go\n\n`error``interface`:\n\n```go\ntype error interface {\n    Error() string\n}\n```\n\n`error`:\n\n```go\n// example 1\nfunc Sqrt(f float64) (float64, error) {\n    if f < 0 {\n        return 0, errors.New(\"math: square root of negative number\")\n    }\n    // implementation\n}\n\n// example 2\nif f < 0 {\n    return 0, fmt.Errorf(\"math: square root of negative number %g\", f)\n}\n```\n\n`error`:\n\n```go\n// errorString is a trivial implementation of error.\ntype errorString struct {\n    s string\n}\n\nfunc (e *errorString) Error() string {\n    return e.s\n}\n```\n\n`error``net.Error`\n\n```go\npackage net\n\ntype Error interface {\n    error\n    Timeout() bool   // Is the error a timeout?\n    Temporary() bool // Is the error temporary?\n}\n```\n\n\n\n```go\nif nerr, ok := err.(net.Error); ok && nerr.Temporary() {\n    time.Sleep(1e9)\n    continue\n}\nif err != nil {\n    log.Fatal(err)\n}\n```\n\n# \n\n\n\n- \n- \n- \n- stack strace\n\nGo\n\n\n## \n\nGo\n\n- ****`func`\n- ****\n- ****\n\n\n### \n\n[C Error Codes in Linux](http://www.virtsync.com/c-error-codes-include-errno)\n\ngo\n\n- `io.EOF`: [](https://github.com/golang/go/blob/master/src/io/io.go#L38)\n- `syscall.ENOENT`: [](https://github.com/golang/go/blob/master/src/syscall/zerrors_linux_amd64.go#L1280)\n- `go/build.NoGoError`: [](https://github.com/golang/go/blob/master/src/go/build/build.go#L446)\n- `path/filepath.SkipDir`: [](https://github.com/golang/go/blob/master/src/path/filepath/path.go#L331)\n\n<u></u>\n\n```go\nbuf := make([]byte, 100)\nn, err := r.Read(buf)   //  r.Read error io.END io.EOF r.Read \nbuf = buf[:n]\nif err == io.EOF {\n    log.Fatal(\"read failed:\", err)\n}\n```\n\n`Error()`\n\n```go\nfunc readfile(path string) error {\n    err := openfile(path)\n    if err != nil {\n        return fmt.Errorf(\"cannot open file: %v\", err)\n    }\n    //...\n}\n\nfunc main() {\n    err := readfile(\".bashrc\")\n    if strings.Contains(error.Error(), \"not found\") {\n        // handle error\n    }\n}\n```\n\n> **`error` interface  `Error` `Error``Error`**\n\nAPI`public`\n\n\n\n\n### \n\n\n\n```go\n// \ntype MyError struct {\n    Msg string\n    File string\n    Line int\n}\n\nfunc (e *MyError) Error() string {\n    return fmt.Sprintf(\"%s:%d: %s\", e.File, e.Line, e.Msg)\n}\n\n\n// \nfunc doSomething() {\n    // do something\n    return &MyError{\"Something happened\", \"server.go\", 42}\n}\n\n// \nerr := doSomething()\nif err, ok := err.(SomeType); ok {    //   \n    //...\n}\n```\n\n  `os.PathError`\n\n```go\n// PathError records an error and the operation\n// and file path that caused it.\ntype PathError struct {\n    Op string\n    Path string\n    Err error\n}\n\nfunc (e *PathError) Error() string\n```\n\n\n\n\n### \n\n\n\n**** \n\n```go\nimport github.com/quux/bar\n\nfunc fn() error {\n    x, err := bar.Foo()\n    if err != nil {\n        return err\n    }\n    // use x\n}\n```\n\n`Foo``Foo``Foo`\n\n\n## \n\n\n\n- `stack trace`\n- \n    - \n    - \n\n\n### \n\n```go\nfunc AuthenticateRequest(r *Request) error {\n    err := authenticate(r.User)\n    if err != nil {\n        return err  // No such file or directory\n    }\n    return nil\n}\n```\n\n\"No such file or directory\"\n\n\n\n```go\nfunc AuthenticateRequest(r *Request) error {\n    err := authenticate(r.User)\n    if err != nil {\n        return fmt.Errorf(\"authenticate failed: %v\", err)    // authenticate failed: No such file or directory\n    }\n    return nil\n}\n```\n\n`fmt.Errorf`\n\ngoErrorHandlingSample](https://github.com/EthanCai/goErrorHandlingSample)repo\n\n```\n> go run sample1/main.go\n\nopen ~/.settings.xml: no such file or directory\nexit status 1\n```\n\n```\n> go run sample2/main.go\n\ncould not read config: open failed: open ~/.settings.xml: no such file or directory\nexit status 1\n```\n\n```\n> go run sample3/main.go\n\ncould not read config: open failed: open ~/.settings.xml: no such file or directory\nexit status 1\n```\n\n```\n> go run sample4/main.go\n\nopen ~/.settings.xml: no such file or directory\nopen failed\nmain.ReadFile\n        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:15\nmain.ReadConfig\n        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:27\nmain.main\n        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:32\nruntime.main\n        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/proc.go:195\nruntime.goexit\n        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/asm_amd64.s:2337\ncould not read config\nmain.ReadConfig\n        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:28\nmain.main\n        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:32\nruntime.main\n        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/proc.go:195\nruntime.goexit\n        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/asm_amd64.s:2337\nexit status 1\n\n```\n\n`sample4/main.go`\n\n\n### \n\n\n\n<u></u>\n\n```go\ntype temporary interface {\n    Temporary() bool    // IsTemporary returns true if err is temporary.\n}\n\nfunc IsTemporary(err error) bool {\n    te, ok := err.(temporary)\n    return ok && te.Temporary()\n}\n```\n\n`package``error``error``package`\n\n\n### \n\n\n\n```go\nfunc Write(w io.Writer, buf []byte) {\n    w.Write(buf)    // Write(p []byte) (n int, err error)Write https://golang.org/pkg/io/#Writer\n}\n```\n\n\n\n```go\nfunc Write(w io.Writer, buf []byte) error {\n    _, err := w.Write(buf)\n    if err != nil {\n        log.Println(\"unable to write:\", err)    // 1\n\n        return err\n    }\n    return nil\n}\n\nfunc main() {\n    // create writer and read data into buf\n\n    err := Write(w, buf)\n    if err != nil {\n        log.Println(\"Write error:\", err)        // 2\n        os.Exit(1)\n    }\n\n    os.Exit(0)\n}\n```\n\n## \n\n\n\n* \n* metrics\n\n# Package `github.com/pkg/errors` \n\n [`github.com/pkg/errors`](https://github.com/pkg/errors) API\n\n```go\n// errors.go\n\n// New returns an error with the supplied message.\n// New also records the stack trace at the point it was called.\nfunc New(message string) error\n\n// Errorf formats according to a format specifier and returns the string\n// as a value that satisfies error.\n// Errorf also records the stack trace at the point it was called.\nfunc Errorf(format string, args ...interface{}) error\n\n// WithStack annotates err with a stack trace at the point WithStack was called.\n// If err is nil, WithStack returns nil.\nfunc WithStack(err error) error\n\n// Wrap returns an error annotating err with a stack trace\n// at the point Wrap is called, and the supplied message.\n// If err is nil, Wrap returns nil.\nfunc Wrap(err error, message string) error\n\n// Wrapf returns an error annotating err with a stack trace\n// at the point Wrapf is called, and the format specifier.\n// If err is nil, Wrapf returns nil.\nfunc Wrapf(err error, format string, args ...interface{}) error\n\n// WithMessage annotates err with a new message.\n// If err is nil, WithMessage returns nil.\nfunc WithMessage(err error, message string) error\n\n// WithMessagef annotates err with the format specifier.\n// If err is nil, WithMessagef returns nil.\nfunc WithMessagef(err error, format string, args ...interface{}) error\n\n// Cause returns the underlying cause of the error, if possible.\n// An error value has a cause if it implements the following\n// interface:\n//\n//     type causer interface {\n//            Cause() error\n//     }\n//\n// If the error does not implement Cause, the original error will\n// be returned. If the error is nil, nil will be returned without further\n// investigation.\nfunc Cause(err error) error\n\n\n\n//  go113.go \n\n// Is reports whether any error in err's chain matches target.\n//\n// The chain consists of err itself followed by the sequence of errors obtained by\n// repeatedly calling Unwrap.\n//\n// An error is considered to match a target if it is equal to that target or if\n// it implements a method Is(error) bool such that Is(target) returns true.\nfunc Is(err, target error) bool\n\n// As finds the first error in err's chain that matches target, and if so, sets\n// target to that error value and returns true.\n//\n// The chain consists of err itself followed by the sequence of errors obtained by\n// repeatedly calling Unwrap.\n//\n// An error matches target if the error's concrete value is assignable to the value\n// pointed to by target, or if the error has a method As(interface{}) bool such that\n// As(target) returns true. In the latter case, the As method is responsible for\n// setting target.\n//\n// As will panic if target is not a non-nil pointer to either a type that implements\n// error, or to any interface type. As returns false if err is nil.\nfunc As(err error, target interface{}) bool\n\n// Unwrap returns the result of calling the Unwrap method on err, if err's\n// type contains an Unwrap method returning error.\n// Otherwise, Unwrap returns nil.\nfunc Unwrap(err error) error\n```\n\n[`example_test.go`](https://github.com/pkg/errors/blob/master/example_test.go)\n\n# \n\n## error\n\nerror\n\n****\n\n*Bad*\n\n```go\nif err == EOF {\n}\n```\n\n*Good*\n\n```go\nif errors.Is(err, EOF) {\t// it will succeed if err wraps EOF\n}\n```\n\n## error\n\nerror\n\n****\n\n*Bad*\n\n```go\nnerr, ok := err.(*CError)\nif ok {\n}\n```\n\n*Good*\n\n```go\nvar nerr *CError\nif errors.As(err, &nerr) {\t// it will succeed if err wraps an *CError\n  \t// nerr is set as *CError\n  ...\n}\n```\n\n## error\n\n****\n\n*Bad*\n\n```go\n// package io\nvar FileNotFoundErr = fmt.Errorf(\"file not found\")\n\n// package service\nif errors.Is(err, io.FileNotFoundErr) {\n}\n```\n\n*Good*\n\n```go\n// package io\nvar fileNotFoundErr = fmt.Errorf(\"file not found\")\nfunc IsFileNotFoundErr(err) bool {\n  return errors.Is(err, fileNotFoundErr)\n}\n\n// package service\nif io.IsFileNotFoundErr(err) {\n}\n```\n\n##   \n\n\n\n*  DB `panic`\n*  `panic`\n\n## AB\n\nB`message``stack trace` \n\nB\n\n* AC webB`stack trace`\n* ABB `message``stack trace`\n\n## gormormerror\n\ngormormerror\n\n*   \n* `err != gorm.errnotfound`\n\n\n\n```go\n// Dao\nfunc GetByID(id int) (*Object, error) {\n\t\t// \n\n    if err != nil && err != gorm.ErrRecordNotFound {\n        return nil, err//  err ErrRecordNotFound\n    }\n\n    if err == gorm.ErrRecordNotFound {\n        return nil, nil\n    }\n\n    return &result, nil\n}\n```\n\n# \n\n\n\n- \n\n- \n\n\n\n\n# \n\n- The Go Blog\n    - [Error handling in Go](https://blog.golang.org/error-handling-and-go)\n    - [Defer, Panic, and Recover](https://blog.golang.org/defer-panic-and-recover)\n- Dave Cheney\n    - [presentation on my philosophy for error handling](https://dave.cheney.net/paste/gocon-spring-2016.pdf)\n    - [Dont just check errors, handle them gracefully](https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully)\n    - [Stack traces and the errors package](https://dave.cheney.net/2016/06/12/stack-traces-and-the-errors-package)\n- Go Packages\n    - [errors](https://golang.org/pkg/errors/)\n    - [runtime](https://golang.org/pkg/runtime/)\n- pkg: Artisanal, hand crafted, barrel aged, Go packages\n    - [github.com/pkg/errors](https://godoc.org/github.com/pkg/errors)\n- [Go 2 Draft Designs](https://go.googlesource.com/proposal/+/master/design/go2draft.md)\n    + [go2draft-error-handling-overview.md](https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-handling-overview.md)\n    + [go2draft-error-handling.md](https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-handling.md)\n    + [go2draft-error-inspection.md](https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-inspection.md)\n    + [go2draft-error-printing.md](https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-printing.md)\n    + [go2draft-error-values-overview.md](https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-values-overview.md)\n\n","slug":"error-handling-in-go","published":1,"updated":"2025-05-19T15:07:15.842Z","_id":"cm9zwlzc60008fdjh0wb5efet","comments":1,"layout":"post","photos":[],"content":"<img src=\"/2017/12/29/error-handling-in-go/d2a2d12e1a00f819d7fd7af4b536efa2.png\" class=\"\">\n<p><small><em> <a href=\"https://go-proverbs.github.io/\" title=\"\" target=\"\">go proverbs</a></em></small></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p>GoJavaC#<code>try...catch</code></p>\n<p></p>\n<h1 id=\"Go\"><a href=\"#Go\" class=\"headerlink\" title=\"Go\"></a>Go</h1><p><code>error</code><code>interface</code>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"type\">error</span> <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">    Error() <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>error</code>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// example 1</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Sqrt</span><span class=\"params\">(f <span class=\"type\">float64</span>)</span></span> (<span class=\"type\">float64</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> f &lt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>, errors.New(<span class=\"string\">&quot;math: square root of negative number&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// implementation</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// example 2</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> f &lt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>, fmt.Errorf(<span class=\"string\">&quot;math: square root of negative number %g&quot;</span>, f)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>error</code>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// errorString is a trivial implementation of error.</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> errorString <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    s <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(e *errorString)</span></span> Error() <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> e.s</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>error</code><code>net.Error</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Error <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">error</span></span><br><span class=\"line\">    Timeout() <span class=\"type\">bool</span>   <span class=\"comment\">// Is the error a timeout?</span></span><br><span class=\"line\">    Temporary() <span class=\"type\">bool</span> <span class=\"comment\">// Is the error temporary?</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> nerr, ok := err.(net.Error); ok &amp;&amp; nerr.Temporary() &#123;</span><br><span class=\"line\">    time.Sleep(<span class=\"number\">1e9</span>)</span><br><span class=\"line\">    <span class=\"keyword\">continue</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    log.Fatal(err)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li>stack strace</li>\n</ul>\n<p>Go</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Go</p>\n<ul>\n<li><strong></strong><code>func</code></li>\n<li><strong></strong></li>\n<li><strong></strong></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://www.virtsync.com/c-error-codes-include-errno\">C Error Codes in Linux</a></p>\n<p>go</p>\n<ul>\n<li><code>io.EOF</code>: <a href=\"https://github.com/golang/go/blob/master/src/io/io.go#L38\"></a></li>\n<li><code>syscall.ENOENT</code>: <a href=\"https://github.com/golang/go/blob/master/src/syscall/zerrors_linux_amd64.go#L1280\"></a></li>\n<li><code>go/build.NoGoError</code>: <a href=\"https://github.com/golang/go/blob/master/src/go/build/build.go#L446\"></a></li>\n<li><code>path/filepath.SkipDir</code>: <a href=\"https://github.com/golang/go/blob/master/src/path/filepath/path.go#L331\"></a></li>\n</ul>\n<p><u></u></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buf := <span class=\"built_in\">make</span>([]<span class=\"type\">byte</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">n, err := r.Read(buf)   <span class=\"comment\">//  r.Read error io.END io.EOF r.Read </span></span><br><span class=\"line\">buf = buf[:n]</span><br><span class=\"line\"><span class=\"keyword\">if</span> err == io.EOF &#123;</span><br><span class=\"line\">    log.Fatal(<span class=\"string\">&quot;read failed:&quot;</span>, err)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Error()</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">readfile</span><span class=\"params\">(path <span class=\"type\">string</span>)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    err := openfile(path)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">&quot;cannot open file: %v&quot;</span>, err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    err := readfile(<span class=\"string\">&quot;.bashrc&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> strings.Contains(<span class=\"type\">error</span>.Error(), <span class=\"string\">&quot;not found&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// handle error</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><strong><code>error</code> interface  <code>Error</code> <code>Error</code><code>Error</code></strong></p>\n</blockquote>\n<p>API<code>public</code></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyError <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Msg <span class=\"type\">string</span></span><br><span class=\"line\">    File <span class=\"type\">string</span></span><br><span class=\"line\">    Line <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(e *MyError)</span></span> Error() <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> fmt.Sprintf(<span class=\"string\">&quot;%s:%d: %s&quot;</span>, e.File, e.Line, e.Msg)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;MyError&#123;<span class=\"string\">&quot;Something happened&quot;</span>, <span class=\"string\">&quot;server.go&quot;</span>, <span class=\"number\">42</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">err := doSomething()</span><br><span class=\"line\"><span class=\"keyword\">if</span> err, ok := err.(SomeType); ok &#123;    <span class=\"comment\">//   </span></span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  <code>os.PathError</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// PathError records an error and the operation</span></span><br><span class=\"line\"><span class=\"comment\">// and file path that caused it.</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> PathError <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Op <span class=\"type\">string</span></span><br><span class=\"line\">    Path <span class=\"type\">string</span></span><br><span class=\"line\">    Err <span class=\"type\">error</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(e *PathError)</span></span> Error() <span class=\"type\">string</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><strong></strong> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> github.com/quux/bar</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">fn</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    x, err := bar.Foo()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> err</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// use x</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Foo</code><code>Foo</code><code>Foo</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li><code>stack trace</code></li>\n<li><ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">AuthenticateRequest</span><span class=\"params\">(r *Request)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    err := authenticate(r.User)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> err  <span class=\"comment\">// No such file or directory</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>No such file or directory</p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">AuthenticateRequest</span><span class=\"params\">(r *Request)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    err := authenticate(r.User)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">&quot;authenticate failed: %v&quot;</span>, err)    <span class=\"comment\">// authenticate failed: No such file or directory</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>fmt.Errorf</code></p>\n<p>goErrorHandlingSample](<a href=\"https://github.com/EthanCai/goErrorHandlingSample)%E8%BF%99%E4%B8%AArepo%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90%E6%BC%94%E7%A4%BA%E4%BA%86%EF%BC%8C%E4%B8%8D%E5%90%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F%EF%BC%8C%E8%BE%93%E5%87%BA%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8C%BA%E5%88%AB%E3%80%82\">https://github.com/EthanCai/goErrorHandlingSample)repo</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; go run sample1/main.go</span><br><span class=\"line\"></span><br><span class=\"line\">open ~/.settings.xml: no such file or directory</span><br><span class=\"line\">exit status 1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; go run sample2/main.go</span><br><span class=\"line\"></span><br><span class=\"line\">could not read config: open failed: open ~/.settings.xml: no such file or directory</span><br><span class=\"line\">exit status 1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; go run sample3/main.go</span><br><span class=\"line\"></span><br><span class=\"line\">could not read config: open failed: open ~/.settings.xml: no such file or directory</span><br><span class=\"line\">exit status 1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; go run sample4/main.go</span><br><span class=\"line\"></span><br><span class=\"line\">open ~/.settings.xml: no such file or directory</span><br><span class=\"line\">open failed</span><br><span class=\"line\">main.ReadFile</span><br><span class=\"line\">        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:15</span><br><span class=\"line\">main.ReadConfig</span><br><span class=\"line\">        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:27</span><br><span class=\"line\">main.main</span><br><span class=\"line\">        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:32</span><br><span class=\"line\">runtime.main</span><br><span class=\"line\">        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/proc.go:195</span><br><span class=\"line\">runtime.goexit</span><br><span class=\"line\">        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/asm_amd64.s:2337</span><br><span class=\"line\">could not read config</span><br><span class=\"line\">main.ReadConfig</span><br><span class=\"line\">        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:28</span><br><span class=\"line\">main.main</span><br><span class=\"line\">        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:32</span><br><span class=\"line\">runtime.main</span><br><span class=\"line\">        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/proc.go:195</span><br><span class=\"line\">runtime.goexit</span><br><span class=\"line\">        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/asm_amd64.s:2337</span><br><span class=\"line\">exit status 1</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>sample4/main.go</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><u></u></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> temporary <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">    Temporary() <span class=\"type\">bool</span>    <span class=\"comment\">// IsTemporary returns true if err is temporary.</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">IsTemporary</span><span class=\"params\">(err <span class=\"type\">error</span>)</span></span> <span class=\"type\">bool</span> &#123;</span><br><span class=\"line\">    te, ok := err.(temporary)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ok &amp;&amp; te.Temporary()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>package</code><code>error</code><code>error</code><code>package</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Write</span><span class=\"params\">(w io.Writer, buf []<span class=\"type\">byte</span>)</span></span> &#123;</span><br><span class=\"line\">    w.Write(buf)    <span class=\"comment\">// Write(p []byte) (n int, err error)Write https://golang.org/pkg/io/#Writer</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Write</span><span class=\"params\">(w io.Writer, buf []<span class=\"type\">byte</span>)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    _, err := w.Write(buf)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        log.Println(<span class=\"string\">&quot;unable to write:&quot;</span>, err)    <span class=\"comment\">// 1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> err</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// create writer and read data into buf</span></span><br><span class=\"line\"></span><br><span class=\"line\">    err := Write(w, buf)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        log.Println(<span class=\"string\">&quot;Write error:&quot;</span>, err)        <span class=\"comment\">// 2</span></span><br><span class=\"line\">        os.Exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    os.Exit(<span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li></li>\n<li>metrics</li>\n</ul>\n<h1 id=\"Package-github-com-pkg-errors\"><a href=\"#Package-github-com-pkg-errors\" class=\"headerlink\" title=\"Package github.com/pkg/errors\"></a>Package <code>github.com/pkg/errors</code></h1><p> <a href=\"https://github.com/pkg/errors\"><code>github.com/pkg/errors</code></a> API</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// errors.go</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// New returns an error with the supplied message.</span></span><br><span class=\"line\"><span class=\"comment\">// New also records the stack trace at the point it was called.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">New</span><span class=\"params\">(message <span class=\"type\">string</span>)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Errorf formats according to a format specifier and returns the string</span></span><br><span class=\"line\"><span class=\"comment\">// as a value that satisfies error.</span></span><br><span class=\"line\"><span class=\"comment\">// Errorf also records the stack trace at the point it was called.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Errorf</span><span class=\"params\">(format <span class=\"type\">string</span>, args ...<span class=\"keyword\">interface</span>&#123;&#125;)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// WithStack annotates err with a stack trace at the point WithStack was called.</span></span><br><span class=\"line\"><span class=\"comment\">// If err is nil, WithStack returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">WithStack</span><span class=\"params\">(err <span class=\"type\">error</span>)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Wrap returns an error annotating err with a stack trace</span></span><br><span class=\"line\"><span class=\"comment\">// at the point Wrap is called, and the supplied message.</span></span><br><span class=\"line\"><span class=\"comment\">// If err is nil, Wrap returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Wrap</span><span class=\"params\">(err <span class=\"type\">error</span>, message <span class=\"type\">string</span>)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Wrapf returns an error annotating err with a stack trace</span></span><br><span class=\"line\"><span class=\"comment\">// at the point Wrapf is called, and the format specifier.</span></span><br><span class=\"line\"><span class=\"comment\">// If err is nil, Wrapf returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Wrapf</span><span class=\"params\">(err <span class=\"type\">error</span>, format <span class=\"type\">string</span>, args ...<span class=\"keyword\">interface</span>&#123;&#125;)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// WithMessage annotates err with a new message.</span></span><br><span class=\"line\"><span class=\"comment\">// If err is nil, WithMessage returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">WithMessage</span><span class=\"params\">(err <span class=\"type\">error</span>, message <span class=\"type\">string</span>)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// WithMessagef annotates err with the format specifier.</span></span><br><span class=\"line\"><span class=\"comment\">// If err is nil, WithMessagef returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">WithMessagef</span><span class=\"params\">(err <span class=\"type\">error</span>, format <span class=\"type\">string</span>, args ...<span class=\"keyword\">interface</span>&#123;&#125;)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Cause returns the underlying cause of the error, if possible.</span></span><br><span class=\"line\"><span class=\"comment\">// An error value has a cause if it implements the following</span></span><br><span class=\"line\"><span class=\"comment\">// interface:</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//     type causer interface &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//            Cause() error</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// If the error does not implement Cause, the original error will</span></span><br><span class=\"line\"><span class=\"comment\">// be returned. If the error is nil, nil will be returned without further</span></span><br><span class=\"line\"><span class=\"comment\">// investigation.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Cause</span><span class=\"params\">(err <span class=\"type\">error</span>)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  go113.go </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is reports whether any error in err&#x27;s chain matches target.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// The chain consists of err itself followed by the sequence of errors obtained by</span></span><br><span class=\"line\"><span class=\"comment\">// repeatedly calling Unwrap.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// An error is considered to match a target if it is equal to that target or if</span></span><br><span class=\"line\"><span class=\"comment\">// it implements a method Is(error) bool such that Is(target) returns true.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Is</span><span class=\"params\">(err, target <span class=\"type\">error</span>)</span></span> <span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// As finds the first error in err&#x27;s chain that matches target, and if so, sets</span></span><br><span class=\"line\"><span class=\"comment\">// target to that error value and returns true.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// The chain consists of err itself followed by the sequence of errors obtained by</span></span><br><span class=\"line\"><span class=\"comment\">// repeatedly calling Unwrap.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// An error matches target if the error&#x27;s concrete value is assignable to the value</span></span><br><span class=\"line\"><span class=\"comment\">// pointed to by target, or if the error has a method As(interface&#123;&#125;) bool such that</span></span><br><span class=\"line\"><span class=\"comment\">// As(target) returns true. In the latter case, the As method is responsible for</span></span><br><span class=\"line\"><span class=\"comment\">// setting target.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// As will panic if target is not a non-nil pointer to either a type that implements</span></span><br><span class=\"line\"><span class=\"comment\">// error, or to any interface type. As returns false if err is nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">As</span><span class=\"params\">(err <span class=\"type\">error</span>, target <span class=\"keyword\">interface</span>&#123;&#125;)</span></span> <span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Unwrap returns the result of calling the Unwrap method on err, if err&#x27;s</span></span><br><span class=\"line\"><span class=\"comment\">// type contains an Unwrap method returning error.</span></span><br><span class=\"line\"><span class=\"comment\">// Otherwise, Unwrap returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Unwrap</span><span class=\"params\">(err <span class=\"type\">error</span>)</span></span> <span class=\"type\">error</span></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://github.com/pkg/errors/blob/master/example_test.go\"><code>example_test.go</code></a></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"error\"><a href=\"#error\" class=\"headerlink\" title=\"error\"></a>error</h2><p>error</p>\n<p><strong></strong></p>\n<p><em>Bad</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> err == EOF &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em>Good</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> errors.Is(err, EOF) &#123;\t<span class=\"comment\">// it will succeed if err wraps EOF</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"error\"><a href=\"#error\" class=\"headerlink\" title=\"error\"></a>error</h2><p>error</p>\n<p><strong></strong></p>\n<p><em>Bad</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nerr, ok := err.(*CError)</span><br><span class=\"line\"><span class=\"keyword\">if</span> ok &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em>Good</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> nerr *CError</span><br><span class=\"line\"><span class=\"keyword\">if</span> errors.As(err, &amp;nerr) &#123;\t<span class=\"comment\">// it will succeed if err wraps an *CError</span></span><br><span class=\"line\">  \t<span class=\"comment\">// nerr is set as *CError</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"error\"><a href=\"#error\" class=\"headerlink\" title=\"error\"></a>error</h2><p><strong></strong></p>\n<p><em>Bad</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// package io</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> FileNotFoundErr = fmt.Errorf(<span class=\"string\">&quot;file not found&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// package service</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> errors.Is(err, io.FileNotFoundErr) &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em>Good</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// package io</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fileNotFoundErr = fmt.Errorf(<span class=\"string\">&quot;file not found&quot;</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">IsFileNotFoundErr</span><span class=\"params\">(err)</span></span> <span class=\"type\">bool</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> errors.Is(err, fileNotFoundErr)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// package service</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> io.IsFileNotFoundErr(err) &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"--\"><a href=\"#--\" class=\"headerlink\" title=\"  \"></a>  </h2><p></p>\n<ul>\n<li> DB <code>panic</code></li>\n<li> <code>panic</code></li>\n</ul>\n<h2 id=\"AB\"><a href=\"#AB\" class=\"headerlink\" title=\"AB\"></a>AB</h2><p>B<code>message</code><code>stack trace</code> </p>\n<p>B</p>\n<ul>\n<li>AC webB<code>stack trace</code></li>\n<li>ABB <code>message</code><code>stack trace</code></li>\n</ul>\n<h2 id=\"gormormerror\"><a href=\"#gormormerror\" class=\"headerlink\" title=\"gormormerror\"></a>gormormerror</h2><p>gormormerror</p>\n<ul>\n<li>  </li>\n<li><code>err != gorm.errnotfound</code></li>\n</ul>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Dao</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetByID</span><span class=\"params\">(id <span class=\"type\">int</span>)</span></span> (*Object, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &amp;&amp; err != gorm.ErrRecordNotFound &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, err<span class=\"comment\">//  err ErrRecordNotFound</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err == gorm.ErrRecordNotFound &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;result, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ul>\n<li><p></p>\n</li>\n<li><p></p>\n</li>\n</ul>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li>The Go Blog<ul>\n<li><a href=\"https://blog.golang.org/error-handling-and-go\">Error handling in Go</a></li>\n<li><a href=\"https://blog.golang.org/defer-panic-and-recover\">Defer, Panic, and Recover</a></li>\n</ul>\n</li>\n<li>Dave Cheney<ul>\n<li><a href=\"https://dave.cheney.net/paste/gocon-spring-2016.pdf\">presentation on my philosophy for error handling</a></li>\n<li><a href=\"https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully\">Dont just check errors, handle them gracefully</a></li>\n<li><a href=\"https://dave.cheney.net/2016/06/12/stack-traces-and-the-errors-package\">Stack traces and the errors package</a></li>\n</ul>\n</li>\n<li>Go Packages<ul>\n<li><a href=\"https://golang.org/pkg/errors/\">errors</a></li>\n<li><a href=\"https://golang.org/pkg/runtime/\">runtime</a></li>\n</ul>\n</li>\n<li>pkg: Artisanal, hand crafted, barrel aged, Go packages<ul>\n<li><a href=\"https://godoc.org/github.com/pkg/errors\">github.com&#x2F;pkg&#x2F;errors</a></li>\n</ul>\n</li>\n<li><a href=\"https://go.googlesource.com/proposal/+/master/design/go2draft.md\">Go 2 Draft Designs</a><ul>\n<li><a href=\"https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-handling-overview.md\">go2draft-error-handling-overview.md</a></li>\n<li><a href=\"https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-handling.md\">go2draft-error-handling.md</a></li>\n<li><a href=\"https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-inspection.md\">go2draft-error-inspection.md</a></li>\n<li><a href=\"https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-printing.md\">go2draft-error-printing.md</a></li>\n<li><a href=\"https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-values-overview.md\">go2draft-error-values-overview.md</a></li>\n</ul>\n</li>\n</ul>\n","excerpt":"","more":"<img src=\"/2017/12/29/error-handling-in-go/d2a2d12e1a00f819d7fd7af4b536efa2.png\" class=\"\">\n<p><small><em> <a href=\"https://go-proverbs.github.io/\" title=\"\" target=\"\">go proverbs</a></em></small></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p>GoJavaC#<code>try...catch</code></p>\n<p></p>\n<h1 id=\"Go\"><a href=\"#Go\" class=\"headerlink\" title=\"Go\"></a>Go</h1><p><code>error</code><code>interface</code>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"type\">error</span> <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">    Error() <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>error</code>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// example 1</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Sqrt</span><span class=\"params\">(f <span class=\"type\">float64</span>)</span></span> (<span class=\"type\">float64</span>, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> f &lt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>, errors.New(<span class=\"string\">&quot;math: square root of negative number&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// implementation</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// example 2</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> f &lt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>, fmt.Errorf(<span class=\"string\">&quot;math: square root of negative number %g&quot;</span>, f)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>error</code>:</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// errorString is a trivial implementation of error.</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> errorString <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    s <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(e *errorString)</span></span> Error() <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> e.s</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>error</code><code>net.Error</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Error <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">error</span></span><br><span class=\"line\">    Timeout() <span class=\"type\">bool</span>   <span class=\"comment\">// Is the error a timeout?</span></span><br><span class=\"line\">    Temporary() <span class=\"type\">bool</span> <span class=\"comment\">// Is the error temporary?</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> nerr, ok := err.(net.Error); ok &amp;&amp; nerr.Temporary() &#123;</span><br><span class=\"line\">    time.Sleep(<span class=\"number\">1e9</span>)</span><br><span class=\"line\">    <span class=\"keyword\">continue</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">    log.Fatal(err)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li>stack strace</li>\n</ul>\n<p>Go</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Go</p>\n<ul>\n<li><strong></strong><code>func</code></li>\n<li><strong></strong></li>\n<li><strong></strong></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://www.virtsync.com/c-error-codes-include-errno\">C Error Codes in Linux</a></p>\n<p>go</p>\n<ul>\n<li><code>io.EOF</code>: <a href=\"https://github.com/golang/go/blob/master/src/io/io.go#L38\"></a></li>\n<li><code>syscall.ENOENT</code>: <a href=\"https://github.com/golang/go/blob/master/src/syscall/zerrors_linux_amd64.go#L1280\"></a></li>\n<li><code>go/build.NoGoError</code>: <a href=\"https://github.com/golang/go/blob/master/src/go/build/build.go#L446\"></a></li>\n<li><code>path/filepath.SkipDir</code>: <a href=\"https://github.com/golang/go/blob/master/src/path/filepath/path.go#L331\"></a></li>\n</ul>\n<p><u></u></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buf := <span class=\"built_in\">make</span>([]<span class=\"type\">byte</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">n, err := r.Read(buf)   <span class=\"comment\">//  r.Read error io.END io.EOF r.Read </span></span><br><span class=\"line\">buf = buf[:n]</span><br><span class=\"line\"><span class=\"keyword\">if</span> err == io.EOF &#123;</span><br><span class=\"line\">    log.Fatal(<span class=\"string\">&quot;read failed:&quot;</span>, err)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Error()</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">readfile</span><span class=\"params\">(path <span class=\"type\">string</span>)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    err := openfile(path)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">&quot;cannot open file: %v&quot;</span>, err)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    err := readfile(<span class=\"string\">&quot;.bashrc&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> strings.Contains(<span class=\"type\">error</span>.Error(), <span class=\"string\">&quot;not found&quot;</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// handle error</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><strong><code>error</code> interface  <code>Error</code> <code>Error</code><code>Error</code></strong></p>\n</blockquote>\n<p>API<code>public</code></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">type</span> MyError <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Msg <span class=\"type\">string</span></span><br><span class=\"line\">    File <span class=\"type\">string</span></span><br><span class=\"line\">    Line <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(e *MyError)</span></span> Error() <span class=\"type\">string</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> fmt.Sprintf(<span class=\"string\">&quot;%s:%d: %s&quot;</span>, e.File, e.Line, e.Msg)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">doSomething</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;MyError&#123;<span class=\"string\">&quot;Something happened&quot;</span>, <span class=\"string\">&quot;server.go&quot;</span>, <span class=\"number\">42</span>&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">err := doSomething()</span><br><span class=\"line\"><span class=\"keyword\">if</span> err, ok := err.(SomeType); ok &#123;    <span class=\"comment\">//   </span></span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  <code>os.PathError</code></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// PathError records an error and the operation</span></span><br><span class=\"line\"><span class=\"comment\">// and file path that caused it.</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> PathError <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Op <span class=\"type\">string</span></span><br><span class=\"line\">    Path <span class=\"type\">string</span></span><br><span class=\"line\">    Err <span class=\"type\">error</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(e *PathError)</span></span> Error() <span class=\"type\">string</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><strong></strong> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> github.com/quux/bar</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">fn</span><span class=\"params\">()</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    x, err := bar.Foo()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> err</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// use x</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Foo</code><code>Foo</code><code>Foo</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li><code>stack trace</code></li>\n<li><ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">AuthenticateRequest</span><span class=\"params\">(r *Request)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    err := authenticate(r.User)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> err  <span class=\"comment\">// No such file or directory</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>No such file or directory</p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">AuthenticateRequest</span><span class=\"params\">(r *Request)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    err := authenticate(r.User)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fmt.Errorf(<span class=\"string\">&quot;authenticate failed: %v&quot;</span>, err)    <span class=\"comment\">// authenticate failed: No such file or directory</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>fmt.Errorf</code></p>\n<p>goErrorHandlingSample](<a href=\"https://github.com/EthanCai/goErrorHandlingSample)%E8%BF%99%E4%B8%AArepo%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90%E6%BC%94%E7%A4%BA%E4%BA%86%EF%BC%8C%E4%B8%8D%E5%90%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F%EF%BC%8C%E8%BE%93%E5%87%BA%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E7%9A%84%E5%8C%BA%E5%88%AB%E3%80%82\">https://github.com/EthanCai/goErrorHandlingSample)repo</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; go run sample1/main.go</span><br><span class=\"line\"></span><br><span class=\"line\">open ~/.settings.xml: no such file or directory</span><br><span class=\"line\">exit status 1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; go run sample2/main.go</span><br><span class=\"line\"></span><br><span class=\"line\">could not read config: open failed: open ~/.settings.xml: no such file or directory</span><br><span class=\"line\">exit status 1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; go run sample3/main.go</span><br><span class=\"line\"></span><br><span class=\"line\">could not read config: open failed: open ~/.settings.xml: no such file or directory</span><br><span class=\"line\">exit status 1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; go run sample4/main.go</span><br><span class=\"line\"></span><br><span class=\"line\">open ~/.settings.xml: no such file or directory</span><br><span class=\"line\">open failed</span><br><span class=\"line\">main.ReadFile</span><br><span class=\"line\">        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:15</span><br><span class=\"line\">main.ReadConfig</span><br><span class=\"line\">        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:27</span><br><span class=\"line\">main.main</span><br><span class=\"line\">        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:32</span><br><span class=\"line\">runtime.main</span><br><span class=\"line\">        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/proc.go:195</span><br><span class=\"line\">runtime.goexit</span><br><span class=\"line\">        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/asm_amd64.s:2337</span><br><span class=\"line\">could not read config</span><br><span class=\"line\">main.ReadConfig</span><br><span class=\"line\">        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:28</span><br><span class=\"line\">main.main</span><br><span class=\"line\">        ~/go/src/github.com/ethancai/goErrorHandlingSample/sample4/main.go:32</span><br><span class=\"line\">runtime.main</span><br><span class=\"line\">        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/proc.go:195</span><br><span class=\"line\">runtime.goexit</span><br><span class=\"line\">        /usr/local/Cellar/go/1.9.2/libexec/src/runtime/asm_amd64.s:2337</span><br><span class=\"line\">exit status 1</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>sample4/main.go</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><u></u></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> temporary <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">    Temporary() <span class=\"type\">bool</span>    <span class=\"comment\">// IsTemporary returns true if err is temporary.</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">IsTemporary</span><span class=\"params\">(err <span class=\"type\">error</span>)</span></span> <span class=\"type\">bool</span> &#123;</span><br><span class=\"line\">    te, ok := err.(temporary)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ok &amp;&amp; te.Temporary()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>package</code><code>error</code><code>error</code><code>package</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Write</span><span class=\"params\">(w io.Writer, buf []<span class=\"type\">byte</span>)</span></span> &#123;</span><br><span class=\"line\">    w.Write(buf)    <span class=\"comment\">// Write(p []byte) (n int, err error)Write https://golang.org/pkg/io/#Writer</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Write</span><span class=\"params\">(w io.Writer, buf []<span class=\"type\">byte</span>)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    _, err := w.Write(buf)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        log.Println(<span class=\"string\">&quot;unable to write:&quot;</span>, err)    <span class=\"comment\">// 1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> err</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// create writer and read data into buf</span></span><br><span class=\"line\"></span><br><span class=\"line\">    err := Write(w, buf)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">        log.Println(<span class=\"string\">&quot;Write error:&quot;</span>, err)        <span class=\"comment\">// 2</span></span><br><span class=\"line\">        os.Exit(<span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    os.Exit(<span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li></li>\n<li>metrics</li>\n</ul>\n<h1 id=\"Package-github-com-pkg-errors\"><a href=\"#Package-github-com-pkg-errors\" class=\"headerlink\" title=\"Package github.com/pkg/errors\"></a>Package <code>github.com/pkg/errors</code></h1><p> <a href=\"https://github.com/pkg/errors\"><code>github.com/pkg/errors</code></a> API</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// errors.go</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// New returns an error with the supplied message.</span></span><br><span class=\"line\"><span class=\"comment\">// New also records the stack trace at the point it was called.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">New</span><span class=\"params\">(message <span class=\"type\">string</span>)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Errorf formats according to a format specifier and returns the string</span></span><br><span class=\"line\"><span class=\"comment\">// as a value that satisfies error.</span></span><br><span class=\"line\"><span class=\"comment\">// Errorf also records the stack trace at the point it was called.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Errorf</span><span class=\"params\">(format <span class=\"type\">string</span>, args ...<span class=\"keyword\">interface</span>&#123;&#125;)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// WithStack annotates err with a stack trace at the point WithStack was called.</span></span><br><span class=\"line\"><span class=\"comment\">// If err is nil, WithStack returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">WithStack</span><span class=\"params\">(err <span class=\"type\">error</span>)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Wrap returns an error annotating err with a stack trace</span></span><br><span class=\"line\"><span class=\"comment\">// at the point Wrap is called, and the supplied message.</span></span><br><span class=\"line\"><span class=\"comment\">// If err is nil, Wrap returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Wrap</span><span class=\"params\">(err <span class=\"type\">error</span>, message <span class=\"type\">string</span>)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Wrapf returns an error annotating err with a stack trace</span></span><br><span class=\"line\"><span class=\"comment\">// at the point Wrapf is called, and the format specifier.</span></span><br><span class=\"line\"><span class=\"comment\">// If err is nil, Wrapf returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Wrapf</span><span class=\"params\">(err <span class=\"type\">error</span>, format <span class=\"type\">string</span>, args ...<span class=\"keyword\">interface</span>&#123;&#125;)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// WithMessage annotates err with a new message.</span></span><br><span class=\"line\"><span class=\"comment\">// If err is nil, WithMessage returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">WithMessage</span><span class=\"params\">(err <span class=\"type\">error</span>, message <span class=\"type\">string</span>)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// WithMessagef annotates err with the format specifier.</span></span><br><span class=\"line\"><span class=\"comment\">// If err is nil, WithMessagef returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">WithMessagef</span><span class=\"params\">(err <span class=\"type\">error</span>, format <span class=\"type\">string</span>, args ...<span class=\"keyword\">interface</span>&#123;&#125;)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Cause returns the underlying cause of the error, if possible.</span></span><br><span class=\"line\"><span class=\"comment\">// An error value has a cause if it implements the following</span></span><br><span class=\"line\"><span class=\"comment\">// interface:</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//     type causer interface &#123;</span></span><br><span class=\"line\"><span class=\"comment\">//            Cause() error</span></span><br><span class=\"line\"><span class=\"comment\">//     &#125;</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// If the error does not implement Cause, the original error will</span></span><br><span class=\"line\"><span class=\"comment\">// be returned. If the error is nil, nil will be returned without further</span></span><br><span class=\"line\"><span class=\"comment\">// investigation.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Cause</span><span class=\"params\">(err <span class=\"type\">error</span>)</span></span> <span class=\"type\">error</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  go113.go </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Is reports whether any error in err&#x27;s chain matches target.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// The chain consists of err itself followed by the sequence of errors obtained by</span></span><br><span class=\"line\"><span class=\"comment\">// repeatedly calling Unwrap.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// An error is considered to match a target if it is equal to that target or if</span></span><br><span class=\"line\"><span class=\"comment\">// it implements a method Is(error) bool such that Is(target) returns true.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Is</span><span class=\"params\">(err, target <span class=\"type\">error</span>)</span></span> <span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// As finds the first error in err&#x27;s chain that matches target, and if so, sets</span></span><br><span class=\"line\"><span class=\"comment\">// target to that error value and returns true.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// The chain consists of err itself followed by the sequence of errors obtained by</span></span><br><span class=\"line\"><span class=\"comment\">// repeatedly calling Unwrap.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// An error matches target if the error&#x27;s concrete value is assignable to the value</span></span><br><span class=\"line\"><span class=\"comment\">// pointed to by target, or if the error has a method As(interface&#123;&#125;) bool such that</span></span><br><span class=\"line\"><span class=\"comment\">// As(target) returns true. In the latter case, the As method is responsible for</span></span><br><span class=\"line\"><span class=\"comment\">// setting target.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">// As will panic if target is not a non-nil pointer to either a type that implements</span></span><br><span class=\"line\"><span class=\"comment\">// error, or to any interface type. As returns false if err is nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">As</span><span class=\"params\">(err <span class=\"type\">error</span>, target <span class=\"keyword\">interface</span>&#123;&#125;)</span></span> <span class=\"type\">bool</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Unwrap returns the result of calling the Unwrap method on err, if err&#x27;s</span></span><br><span class=\"line\"><span class=\"comment\">// type contains an Unwrap method returning error.</span></span><br><span class=\"line\"><span class=\"comment\">// Otherwise, Unwrap returns nil.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Unwrap</span><span class=\"params\">(err <span class=\"type\">error</span>)</span></span> <span class=\"type\">error</span></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"https://github.com/pkg/errors/blob/master/example_test.go\"><code>example_test.go</code></a></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"error\"><a href=\"#error\" class=\"headerlink\" title=\"error\"></a>error</h2><p>error</p>\n<p><strong></strong></p>\n<p><em>Bad</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> err == EOF &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em>Good</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> errors.Is(err, EOF) &#123;\t<span class=\"comment\">// it will succeed if err wraps EOF</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"error\"><a href=\"#error\" class=\"headerlink\" title=\"error\"></a>error</h2><p>error</p>\n<p><strong></strong></p>\n<p><em>Bad</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nerr, ok := err.(*CError)</span><br><span class=\"line\"><span class=\"keyword\">if</span> ok &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em>Good</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> nerr *CError</span><br><span class=\"line\"><span class=\"keyword\">if</span> errors.As(err, &amp;nerr) &#123;\t<span class=\"comment\">// it will succeed if err wraps an *CError</span></span><br><span class=\"line\">  \t<span class=\"comment\">// nerr is set as *CError</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"error\"><a href=\"#error\" class=\"headerlink\" title=\"error\"></a>error</h2><p><strong></strong></p>\n<p><em>Bad</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// package io</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> FileNotFoundErr = fmt.Errorf(<span class=\"string\">&quot;file not found&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// package service</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> errors.Is(err, io.FileNotFoundErr) &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><em>Good</em></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// package io</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fileNotFoundErr = fmt.Errorf(<span class=\"string\">&quot;file not found&quot;</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">IsFileNotFoundErr</span><span class=\"params\">(err)</span></span> <span class=\"type\">bool</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> errors.Is(err, fileNotFoundErr)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// package service</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> io.IsFileNotFoundErr(err) &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"--\"><a href=\"#--\" class=\"headerlink\" title=\"  \"></a>  </h2><p></p>\n<ul>\n<li> DB <code>panic</code></li>\n<li> <code>panic</code></li>\n</ul>\n<h2 id=\"AB\"><a href=\"#AB\" class=\"headerlink\" title=\"AB\"></a>AB</h2><p>B<code>message</code><code>stack trace</code> </p>\n<p>B</p>\n<ul>\n<li>AC webB<code>stack trace</code></li>\n<li>ABB <code>message</code><code>stack trace</code></li>\n</ul>\n<h2 id=\"gormormerror\"><a href=\"#gormormerror\" class=\"headerlink\" title=\"gormormerror\"></a>gormormerror</h2><p>gormormerror</p>\n<ul>\n<li>  </li>\n<li><code>err != gorm.errnotfound</code></li>\n</ul>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Dao</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetByID</span><span class=\"params\">(id <span class=\"type\">int</span>)</span></span> (*Object, <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// </span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &amp;&amp; err != gorm.ErrRecordNotFound &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, err<span class=\"comment\">//  err ErrRecordNotFound</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> err == gorm.ErrRecordNotFound &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &amp;result, <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ul>\n<li><p></p>\n</li>\n<li><p></p>\n</li>\n</ul>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li>The Go Blog<ul>\n<li><a href=\"https://blog.golang.org/error-handling-and-go\">Error handling in Go</a></li>\n<li><a href=\"https://blog.golang.org/defer-panic-and-recover\">Defer, Panic, and Recover</a></li>\n</ul>\n</li>\n<li>Dave Cheney<ul>\n<li><a href=\"https://dave.cheney.net/paste/gocon-spring-2016.pdf\">presentation on my philosophy for error handling</a></li>\n<li><a href=\"https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully\">Dont just check errors, handle them gracefully</a></li>\n<li><a href=\"https://dave.cheney.net/2016/06/12/stack-traces-and-the-errors-package\">Stack traces and the errors package</a></li>\n</ul>\n</li>\n<li>Go Packages<ul>\n<li><a href=\"https://golang.org/pkg/errors/\">errors</a></li>\n<li><a href=\"https://golang.org/pkg/runtime/\">runtime</a></li>\n</ul>\n</li>\n<li>pkg: Artisanal, hand crafted, barrel aged, Go packages<ul>\n<li><a href=\"https://godoc.org/github.com/pkg/errors\">github.com&#x2F;pkg&#x2F;errors</a></li>\n</ul>\n</li>\n<li><a href=\"https://go.googlesource.com/proposal/+/master/design/go2draft.md\">Go 2 Draft Designs</a><ul>\n<li><a href=\"https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-handling-overview.md\">go2draft-error-handling-overview.md</a></li>\n<li><a href=\"https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-handling.md\">go2draft-error-handling.md</a></li>\n<li><a href=\"https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-inspection.md\">go2draft-error-inspection.md</a></li>\n<li><a href=\"https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-printing.md\">go2draft-error-printing.md</a></li>\n<li><a href=\"https://go.googlesource.com/proposal/%2B/master/design/go2draft-error-values-overview.md\">go2draft-error-values-overview.md</a></li>\n</ul>\n</li>\n</ul>\n"}],"PostAsset":[{"_id":"source/_posts/2017-12-29-error-handling-in-go/d2a2d12e1a00f819d7fd7af4b536efa2.png","slug":"d2a2d12e1a00f819d7fd7af4b536efa2.png","post":"cm9zwlzc60008fdjh0wb5efet","modified":0,"renderable":0},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog/2016-04-21_07-12-24.png","slug":"2016-04-21_07-12-24.png","post":"cm9zwlzc60007fdjh02midzgz","modified":0,"renderable":0},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog/2016-04-21_07-12-40.png","slug":"2016-04-21_07-12-40.png","post":"cm9zwlzc60007fdjh02midzgz","modified":0,"renderable":0},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog/channel.png","slug":"channel.png","post":"cm9zwlzc60007fdjh02midzgz","modified":0,"renderable":0},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog/expvarmon_screen.png","slug":"expvarmon_screen.png","post":"cm9zwlzc60007fdjh02midzgz","modified":0,"renderable":0},{"_id":"source/_posts/2016-04-20-experiences-about-develop-dlog/use_channel.png","slug":"use_channel.png","post":"cm9zwlzc60007fdjh02midzgz","modified":0,"renderable":0}],"PostCategory":[{"post_id":"cm9zwlzc20001fdjh8l2s8eko","category_id":"cm9zwlzc50004fdjhbnwv3p2a","_id":"cm9zwlzc7000bfdjh9a8keqf2"},{"post_id":"cm9zwlzc40003fdjh7bagfwwo","category_id":"cm9zwlzc60009fdjh0j7u3jui","_id":"cm9zwlzc7000hfdjh6iclc2lz"},{"post_id":"cm9zwlzc60007fdjh02midzgz","category_id":"cm9zwlzc60009fdjh0j7u3jui","_id":"cm9zwlzc7000jfdjh0qzk5pq2"},{"post_id":"cm9zwlzc60008fdjh0wb5efet","category_id":"cm9zwlzc60009fdjh0j7u3jui","_id":"cm9zwlzc7000mfdjhflyy1b1a"}],"PostTag":[{"post_id":"cm9zwlzc20001fdjh8l2s8eko","tag_id":"cm9zwlzc50005fdjh11f160ih","_id":"cm9zwlzc7000efdjhaekwflt8"},{"post_id":"cm9zwlzc20001fdjh8l2s8eko","tag_id":"cm9zwlzc6000afdjh4qmlhk1f","_id":"cm9zwlzc7000ffdjh5715hg35"},{"post_id":"cm9zwlzc40003fdjh7bagfwwo","tag_id":"cm9zwlzc7000dfdjhfv6jh4h5","_id":"cm9zwlzc7000lfdjh6mle2ywn"},{"post_id":"cm9zwlzc40003fdjh7bagfwwo","tag_id":"cm9zwlzc7000ifdjhcakl5dj6","_id":"cm9zwlzc7000nfdjhcppcf8uq"},{"post_id":"cm9zwlzc60007fdjh02midzgz","tag_id":"cm9zwlzc7000dfdjhfv6jh4h5","_id":"cm9zwlzc7000pfdjh9cvw9db3"},{"post_id":"cm9zwlzc60008fdjh0wb5efet","tag_id":"cm9zwlzc7000dfdjhfv6jh4h5","_id":"cm9zwlzc7000qfdjhbe22ffwf"}],"Tag":[{"name":"","_id":"cm9zwlzc50005fdjh11f160ih"},{"name":"","_id":"cm9zwlzc6000afdjh4qmlhk1f"},{"name":"golang","_id":"cm9zwlzc7000dfdjhfv6jh4h5"},{"name":"json","_id":"cm9zwlzc7000ifdjhcakl5dj6"}]}}